import{_ as H,j as W,G as J,r as v,l as E,q as T,o as K,a as i,c as n,f as s,h as U,e as r,t as o,F as w,d as k,g as V,y as I,U as R,A as X,i as g,H as Y,x as Z,Q as O}from"./index-fa3403e2.js";const ee=["dir"],te={class:"flex lg:flex-row flex-col gap-10"},se={class:"flex-1 bg-white rounded-2xl shadow-lg p-6"},ae={key:0,class:"flex justify-center items-center py-4"},oe={class:"ml-2"},le={key:1},re={class:"mb-6"},ie={class:"text-lg font-semibold text-gray-800 mb-2"},ne={class:"flex flex-wrap gap-2 mb-4"},ce=["onClick"],de={class:"mb-6"},ue={class:"text-lg font-semibold text-gray-800 mb-2"},_e={value:null,disabled:""},me=["value"],ye={key:0,class:"text-center text-gray-600 py-4"},ve={key:1},he=["src","alt"],xe={class:"flex flex-col mx-4 gap-2 flex-1"},pe={class:"text-lg font-bold text-gray-800"},fe={class:"text-yellow-600 text-sm"},ge={class:"flex items-center justify-between"},be={class:"text-yellow-600 text-sm"},we={class:"border border-gray-300 p-2 rounded-md flex items-center gap-3"},ke=["onClick","disabled"],qe={class:"text-sm font-medium"},Ce=["onClick"],Fe=["onClick"],Se={class:"text-lg font-semibold text-gray-800 mb-4"},je={key:0,class:"mb-4 p-3 bg-yellow-100 text-yellow-800 rounded-md"},Ne={class:"flex flex-col gap-4"},Ae={class:"flex justify-between items-center"},$e={class:"text-yellow-600 font-semibold"},Ee={class:"text-gray-700"},Te={class:"flex justify-between items-center"},Ue={class:"text-yellow-600 font-semibold"},Ve={class:"text-gray-700"},Ie={class:"flex justify-between items-center"},Pe={class:"text-yellow-600 font-semibold"},Be={class:"text-gray-700"},Le={class:"flex justify-between items-center"},Me={class:"text-yellow-600 font-semibold"},Qe={class:"text-gray-700"},De=["disabled"],ze={class:"lg:w-1/4 w-full p-6 bg-white rounded-2xl shadow-lg"},Ge={class:"text-lg font-semibold text-gray-800 mb-4"},He={class:"flex flex-col gap-4"},We={class:"flex justify-between items-center"},Je={class:"text-yellow-600 font-semibold"},Ke={class:"text-gray-700"},Re={class:"flex justify-between items-center"},Xe={class:"text-yellow-600 font-semibold"},Ye={class:"text-gray-700"},Ze={class:"flex justify-between items-center"},Oe={class:"text-yellow-600 font-semibold"},et={class:"text-gray-700"},tt={class:"flex flex-col mt-6"},st=["placeholder"],at=["disabled"],ot={__name:"cart",setup(lt){const{t,locale:F}=W(),c=J(),q=v(!0),x=v([]),h=v([]),d=v([]),b=v([]),u=v(null),m=v(""),p=v([]),y=E(()=>d.value.length===0?[]:x.value.filter(l=>d.value.includes(l.store_id))),C=E(()=>{if(p.value.length===0)return{order_without_tax:"0.00",tax:"0.00",total:"0.00"};const l=p.value.reduce((a,e)=>({order_without_tax:a.order_without_tax+Number(e.subtotal||0),tax:a.tax+Number(e.tax||0),total:a.total+Number(e.total||0)}),{order_without_tax:0,tax:0,total:0});return{order_without_tax:l.order_without_tax.toFixed(2),tax:l.tax.toFixed(2),total:l.total.toFixed(2)}}),P=async()=>{try{const{data:l}=await g.get("/api/home/address");l.is_success&&(b.value=l.data,b.value.length>0&&(u.value=b.value[0].id))}catch{c.add({severity:"error",summary:t("error"),detail:t("cart.addressLoadError"),life:3e3})}},B=async()=>{try{q.value=!0;const{data:l}=await g.get("/api/cart");l.is_success&&(h.value=l.data.stores.map(a=>({store_id:a.store_id,store_name_ar:a.store_name_ar,store_name_en:a.store_name_en})),x.value=l.data.items.map(a=>{var N,A,$;const e=a.product,f=((A=(N=e.media)==null?void 0:N[0])==null?void 0:A.url)||e.key_default_image||"/images/placeholder-product.png",G=($=a.variant)!=null&&$.price?parseFloat(a.variant.price):parseFloat(e.base_price)||0;return{uniqueId:`${a.product_id}-${a.variant_id||"no-var"}`,product_id:a.product_id,variant_id:a.variant_id,name:F.value==="ar"?e.name_ar||e.name_en:e.name_en||e.name_ar,img:f,price:G.toFixed(2),quantity:a.quantity,store_id:e.store_id}}),h.value.length>0&&(d.value=[h.value[0].store_id]),await _())}catch{c.add({severity:"error",summary:t("error"),detail:t("cart.cartLoadError"),life:3e3})}finally{q.value=!1}},_=async()=>{if(!u.value||y.value.length===0){p.value=[];return}try{const l={address_id:u.value,items:y.value.map(e=>({product_id:e.product_id,variant_id:e.variant_id,quantity:e.quantity}))};m.value&&(l.coupon=m.value);const{data:a}=await g.post("/api/order/view",l);a.is_success&&(p.value=a.data)}catch{c.add({severity:"error",summary:t("error"),detail:t("cart.orderTotalsError"),life:3e3})}},L=l=>{const a=h.value.find(e=>e.store_id===l);return F.value==="ar"?a==null?void 0:a.store_name_ar:(a==null?void 0:a.store_name_en)||t("store.unknown")},M=l=>{d.value.includes(l)?d.value=d.value.filter(a=>a!==l):d.value.push(l),_()},Q=()=>{d.value=h.value.map(l=>l.store_id),_()},S=async(l,a)=>{const e=l==="plus"?a.quantity+1:a.quantity-1;if(!(e<1))try{await g.post("/api/cart/update",{product_id:a.product_id,variant_id:a.variant_id,quantity:e}),a.quantity=e,await _(),c.add({severity:"success",summary:t("success"),detail:t("cart.quantityUpdated"),life:2e3})}catch{c.add({severity:"error",summary:t("error"),detail:t("cart.quantityUpdateError"),life:3e3})}},D=async l=>{try{await g.post("/api/cart/remove",{product_id:l.product_id,variant_id:l.variant_id}),x.value=x.value.filter(a=>a.uniqueId!==l.uniqueId),await _(),c.add({severity:"success",summary:t("success"),detail:t("cart.removeSuccess"),life:3e3})}catch{c.add({severity:"error",summary:t("error"),detail:t("cart.removeError"),life:3e3})}},z=async()=>{await _(),c.add({severity:"info",summary:t("info"),detail:t("cart.couponApplied"),life:3e3})},j=async()=>{if(!u.value||y.value.length===0){c.add({severity:"warn",summary:t("warning"),detail:t("cart.cannotCheckout"),life:3e3});return}try{const l={address_id:u.value,items:y.value.map(e=>({product_id:e.product_id,variant_id:e.variant_id,quantity:e.quantity}))};m.value&&(l.coupon=m.value);const{data:a}=await g.post("/api/order",l);a.is_success&&(c.add({severity:"success",summary:t("success"),detail:t("cart.orderSuccess"),life:5e3}),x.value=x.value.filter(e=>!d.value.includes(e.store_id)),p.value=[],d.value=[])}catch{c.add({severity:"error",summary:t("error"),detail:t("cart.orderError"),life:4e3})}};return T(()=>u.value,_),T(()=>m.value,()=>{m.value&&_()}),K(()=>{P(),B()}),(l,a)=>(i(),n("div",{class:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 font-inter",dir:l.$i18n.locale==="ar"?"rtl":"ltr"},[s("div",te,[s("section",se,[q.value?(i(),n("div",ae,[U(r(Y),{style:{width:"40px",height:"40px"},strokeWidth:"4",class:"text-yellow-600"}),s("p",oe,o(r(t)("loading")),1)])):(i(),n("div",le,[s("div",re,[s("h3",ie,o(r(t)("cart.selectStore")),1),s("div",ne,[(i(!0),n(w,null,k(h.value,e=>(i(),n("button",{key:e.store_id,onClick:f=>M(e.store_id),class:Z(["px-4 py-2 rounded-md text-sm font-medium transition-colors",d.value.includes(e.store_id)?"bg-yellow-600 text-white":"bg-amber-50 text-yellow-600"])},o(l.$i18n.locale==="ar"?e.store_name_ar:e.store_name_en),11,ce))),128)),h.value.length>1?(i(),n("button",{key:0,onClick:Q,class:"px-4 py-2 rounded-md text-sm font-medium bg-amber-50 text-yellow-600 hover:bg-amber-100 transition-colors"},o(r(t)("cart.selectAllStores")),1)):V("",!0)])]),s("div",de,[s("h3",ue,o(r(t)("cart.selectAddress")),1),I(s("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),onChange:_,class:"w-full bg-amber-50 border border-amber-200 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-600 transition-all"},[s("option",_e,o(r(t)("cart.selectAddressPlaceholder")),1),(i(!0),n(w,null,k(b.value,e=>(i(),n("option",{key:e.id,value:e.id},o(e.address_line_1)+", "+o(e.city),9,me))),128))],544),[[R,u.value]])]),y.value.length===0?(i(),n("div",ye,o(r(t)("cart.emptyCart")),1)):(i(),n("div",ve,[(i(!0),n(w,null,k(y.value,e=>(i(),n("div",{key:e.uniqueId,class:"flex items-center mt-6 bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300"},[s("img",{src:e.img,alt:e.name,class:"w-16 h-16 md:w-20 md:h-20 lg:w-28 lg:h-28 object-cover rounded-md border border-gray-800"},null,8,he),s("div",xe,[s("h3",pe,o(e.name),1),s("p",fe,o(r(t)("cart.price"))+": "+o(e.price)+" "+o(r(t)("cart.currency")),1),s("div",ge,[s("p",be,o(r(t)("cart.quantity"))+": "+o(e.quantity),1),s("div",we,[s("button",{onClick:f=>S("minus",e),class:"text-lg font-semibold text-gray-700 hover:text-yellow-600 transition-colors",disabled:e.quantity<=1}," - ",8,ke),s("span",qe,o(e.quantity),1),s("button",{onClick:f=>S("plus",e),class:"text-lg font-semibold text-gray-700 hover:text-yellow-600 transition-colors"}," + ",8,Ce)]),s("button",{onClick:f=>D(e),class:"text-white bg-yellow-600 px-3 py-1 text-sm rounded-md hover:bg-yellow-700 transition-all"},o(r(t)("cart.remove")),9,Fe)])])]))),128)),(i(!0),n(w,null,k(p.value,e=>(i(),n("div",{key:e.store_id,class:"bg-gray-100 p-6 mt-6 rounded-lg shadow-inner"},[s("h3",Se,o(r(t)("cart.orderFrom"))+" "+o(L(e.store_id)),1),e.delivery_message?(i(),n("div",je,o(e.delivery_message),1)):V("",!0),s("div",Ne,[s("span",Ae,[s("h4",$e,o(r(t)("cart.shippingTime")),1),s("p",Ee,o(e.delivery_time||r(t)("cart.notAvailable")),1)]),s("span",Te,[s("h4",Ue,o(r(t)("cart.subtotal")),1),s("p",Ve,o(Number(e.subtotal).toFixed(2))+" "+o(r(t)("cart.currency")),1)]),s("span",Ie,[s("h4",Pe,o(r(t)("cart.tax")),1),s("p",Be,o(Number(e.tax).toFixed(2))+" "+o(r(t)("cart.currency")),1)]),s("span",Le,[s("h4",Me,o(r(t)("cart.total")),1),s("p",Qe,o(Number(e.total).toFixed(2))+" "+o(r(t)("cart.currency")),1)])]),s("button",{disabled:!u.value||y.value.length===0,onClick:j,class:"w-full mt-6 py-3 text-sm sm:text-base lg:text-lg bg-gray-800 rounded-md text-white font-semibold transition-transform duration-150 hover:shadow-lg active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed"},o(r(t)("cart.checkout")),9,De)]))),128))]))]))]),s("section",ze,[s("h3",Ge,o(r(t)("cart.orderSummary")),1),s("div",He,[s("span",We,[s("h4",Je,o(r(t)("cart.subtotal")),1),s("p",Ke,o(C.value.order_without_tax)+" "+o(r(t)("cart.currency")),1)]),s("span",Re,[s("h4",Xe,o(r(t)("cart.tax")),1),s("p",Ye,o(C.value.tax)+" "+o(r(t)("cart.currency")),1)]),s("span",Ze,[s("h4",Oe,o(r(t)("cart.total")),1),s("p",et,o(C.value.total)+" "+o(r(t)("cart.currency")),1)])]),s("div",tt,[I(s("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>m.value=e),type:"text",placeholder:r(t)("cart.couponPlaceholder"),class:"bg-amber-50 placeholder-yellow-600 border border-amber-200 rounded-md w-full px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-600 transition-all"},null,8,st),[[X,m.value]]),s("button",{onClick:z,class:"w-full mt-4 py-2 text-sm bg-amber-100 rounded-md text-yellow-600 font-semibold hover:bg-amber-200 transition-all active:scale-95"},o(r(t)("cart.applyCoupon")),1),s("button",{disabled:!u.value||y.value.length===0,onClick:j,class:"w-full mt-4 py-2 text-sm bg-gray-800 rounded-md text-white font-semibold hover:shadow-lg transition-all active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed"},o(r(t)("cart.checkout")),9,at)])])]),U(r(O))],8,ee))}},it=H(ot,[["__scopeId","data-v-1ef05343"]]);export{it as default};
