import{_ as H,l as $,k as J,u as W,G as X,j as Z,r as _,i as h,q as j,o as ee,R as te,z as se,a as p,c as v,f as d,t as u,e as o,p as m,h as y,y as b,g as f,w as ae,D as re,a2 as A,ag as I,T as oe,ah as le,U as R,Q as ie}from"./index-bd4d5038.js";import{h as de}from"./moment-fbc5633a.js";import{l as S}from"./lodash-ca333328.js";const ue=["dir"],ne={class:"text-3xl font-bold text-center mb-8 text-gray-800"},ce={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},pe={class:"space-y-2"},ve={for:"type",class:"block text-sm font-medium text-gray-700"},ye={key:0,id:"type-error",class:"text-red-500 text-xs"},_e={class:"space-y-2"},fe={for:"ids",class:"block text-sm font-medium text-gray-700"},ge={key:0,id:"ids-error",class:"text-red-500 text-xs"},me={key:0,class:"space-y-2"},be={for:"product_id",class:"block text-sm font-medium text-gray-700"},he={key:0,id:"product_id-error",class:"text-red-500 text-xs"},xe={class:"space-y-2"},we={for:"discount_type",class:"block text-sm font-medium text-gray-700"},Ve={key:0,id:"discount_type-error",class:"text-red-500 text-xs"},ke={class:"space-y-2"},De={for:"discount_value",class:"block text-sm font-medium text-gray-700"},qe={key:0,class:"text-gray-500 text-xs"},$e={key:1,id:"discount_value-error",class:"text-red-500 text-xs"},Fe={class:"space-y-2"},Le={for:"expires_at",class:"block text-sm font-medium text-gray-700"},Ee={key:0,id:"expires_at-error",class:"text-red-500 text-xs"},Ue={class:"pt-4 flex justify-center space-x-4"},Ce={key:0},Pe={key:1,class:"pi pi-spinner pi-spin"},je={__name:"update",setup(Ae){class T{constructor(e,s){this.errors=e,this.t=s}required(e,s){return!e||Array.isArray(e)&&e.length===0?(this.errors.value[s]=this.t("validation.requiredFields",{field:this.t(`discount.${s}`)}),!1):!0}numericRange(e,s,l,c){return e==null||isNaN(e)?(this.errors.value[s]=this.t("validation.requiredFields",{field:this.t(`discount.${s}`)}),!1):l!==null&&e<l?(this.errors.value[s]=this.t("validation.minValue",{field:this.t(`discount.${s}`),min:l}),!1):c!==null&&e>c?(this.errors.value[s]=this.t("validation.maxValue",{field:this.t(`discount.${s}`),max:c}),!1):!0}validDate(e,s){return!e||!(e instanceof Date)||isNaN(e.getTime())?(this.errors.value[s]=this.t("validation.invalidDate",{field:this.t(`discount.${s}`)}),!1):!0}isValid(){return Object.keys(this.errors.value).length===0}}const F=$(()=>localStorage.getItem("appLang")||"en"),L=$(()=>F.value==="en"?"name_en":"name_ar"),M=$(()=>F.value==="ar"),Y=J(),k=W(),g=X(),{t:a}=Z(),n=_(!1),x=_([]),w=_([]),E=_(""),U=_(""),C=_(Y.params.id),i=_({}),t=_({type:"",ids:[],products:[],discount_type:null,discount_value:null,expires_at:null}),B=S.debounce(D,300),Q=S.debounce(q,300),z=async()=>{var r;n.value=!0;try{const s=(r=(await h.get(`/api/discount/${C.value}`)).data)==null?void 0:r.data;if(!s)throw new Error("Invalid discount data");t.value={type:s.type||"",discount_type:s.discount_type||null,discount_value:parseFloat(s.discount_value)||null,expires_at:s.expires_at?new Date(s.expires_at):null,ids:[],products:[]},await D(),s.type==="product"&&Array.isArray(s.ids)&&s.ids.length>0?(t.value.products=s.ids,await O(s.ids)):s.type==="category"&&Array.isArray(s.ids)&&s.ids.length>0&&(t.value.ids=s.ids.filter(l=>x.value.some(c=>c.id===l)))}catch(e){console.error("Error fetching discount:",e),g.add({severity:"error",summary:a("error"),detail:a("error.discountLoad"),life:3e3}),k.push({name:"discount"})}finally{n.value=!1}},O=async r=>{try{const e=new Set,s=r.map(l=>h.get(`/api/product/${l}`).then(c=>{var P;const V=(P=c.data)==null?void 0:P.data;V!=null&&V.category_id&&e.add(V.category_id)}).catch(()=>{}));await Promise.all(s),t.value.ids=Array.from(e).filter(l=>x.value.some(c=>c.id===l)),t.value.ids.length>0&&await q()}catch(e){console.error("Error fetching product categories:",e)}};async function D(){var r,e;try{const s=await h.get("/api/category",{params:{search:E.value||void 0}});x.value=((e=(r=s.data)==null?void 0:r.data)==null?void 0:e.data)||[]}catch(s){console.error("Error fetching categories:",s),g.add({severity:"error",summary:a("error"),detail:a("error.categoryLoad"),life:3e3})}}async function q(){var r,e;try{const s=await h.get("/api/product",{params:{search:U.value||void 0,category_ids:t.value.ids.length>0?t.value.ids.join(","):void 0}});w.value=((e=(r=s.data)==null?void 0:r.data)==null?void 0:e.data)||[]}catch(s){console.error("Error fetching products:",s),g.add({severity:"error",summary:a("error"),detail:a("error.productLoad"),life:3e3})}}const G=r=>{E.value=r.value,B()},K=r=>{U.value=r.value,Q()};j(()=>t.value.type,r=>{t.value.ids=[],t.value.products=[],w.value=[],i.value={},(r==="category"||r==="product")&&D()}),j(()=>t.value.ids,r=>{t.value.type==="product"&&r.length>0?q():t.value.type==="product"&&r.length===0&&(w.value=[],t.value.products=[])},{deep:!0});const N=async()=>{var s,l;i.value={};const r=new T(i,a);if(r.required(t.value.type,"type"),r.required(t.value.ids,"select_category"),t.value.type==="product"&&r.required(t.value.products,"select_product"),r.required(t.value.discount_type,"discount_type"),r.numericRange(t.value.discount_value,"discount_value",0,t.value.discount_type===2?100:null),r.validDate(t.value.expires_at,"expiration_date"),!r.isValid()){const c=Object.keys(i.value)[0];g.add({severity:"error",summary:a("error"),detail:i.value[c],life:3e3});return}n.value=!0;const e={type:t.value.type,ids:t.value.type==="product"?t.value.products:t.value.ids,discount_type:t.value.discount_type,discount_value:t.value.discount_value,expires_at:de(t.value.expires_at).format("YYYY-MM-DD"),_method:"PUT"};try{await h.post(`/api/discount/${C.value}`,e),k.push({name:"discount"}),g.add({severity:"success",summary:a("success"),detail:a("discount.updated_successfully"),life:3e3})}catch(c){console.error("Error updating discount:",c),g.add({severity:"error",summary:a("error"),detail:((l=(s=c.response)==null?void 0:s.data)==null?void 0:l.message)||a("error.updateError"),life:3e3})}finally{n.value=!1}};return ee(()=>{z()}),(r,e)=>{const s=te("can");return se((p(),v("div",{class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg",dir:M.value?"rtl":"ltr"},[d("h1",ne,u(o(a)("discount.update_discount")),1),d("form",{onSubmit:re(N,["prevent"]),class:"space-y-6",role:"form","aria-label":"Update Discount Form"},[d("div",ce,[d("div",pe,[d("label",ve,[m(u(o(a)("discount.type"))+" ",1),e[7]||(e[7]=d("span",{class:"text-red-500"},"*",-1))]),y(o(A),{filter:"",id:"type",modelValue:t.value.type,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.type=l),options:["product","category"],placeholder:o(a)("discount.select_type"),class:b(["w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":i.value.type}]),disabled:n.value,"aria-required":"true","aria-describedby":"type-error"},null,8,["modelValue","placeholder","class","disabled"]),i.value.type?(p(),v("small",ye,u(i.value.type),1)):f("",!0)]),d("div",_e,[d("label",fe,[m(u(o(a)("discount.select_category"))+" ",1),e[8]||(e[8]=d("span",{class:"text-red-500"},"*",-1))]),y(o(I),{filter:"",id:"ids",modelValue:t.value.ids,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.ids=l),options:x.value,optionLabel:L.value,optionValue:"id",placeholder:o(a)("discount.searchCategories"),class:b(["w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":i.value.select_category}]),disabled:n.value||!t.value.type,onFilter:G,display:"chip","aria-required":"true","aria-describedby":"ids-error"},null,8,["modelValue","options","optionLabel","placeholder","class","disabled"]),i.value.select_category?(p(),v("small",ge,u(i.value.select_category),1)):f("",!0)]),t.value.type==="product"?(p(),v("div",me,[d("label",be,[m(u(o(a)("discount.select_product"))+" ",1),e[9]||(e[9]=d("span",{class:"text-red-500"},"*",-1))]),y(o(I),{filter:"",id:"product_id",modelValue:t.value.products,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.products=l),options:w.value,optionLabel:L.value,optionValue:"id",placeholder:o(a)("discount.searchProducts"),class:b(["w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":i.value.select_product}]),disabled:n.value||t.value.ids.length===0,onFilter:K,display:"chip","aria-required":"true","aria-describedby":"product_id-error"},null,8,["modelValue","options","optionLabel","placeholder","class","disabled"]),i.value.select_product?(p(),v("small",he,u(i.value.select_product),1)):f("",!0)])):f("",!0),d("div",xe,[d("label",we,[m(u(o(a)("discount.discount_type"))+" ",1),e[10]||(e[10]=d("span",{class:"text-red-500"},"*",-1))]),y(o(A),{filter:"",id:"discount_type",modelValue:t.value.discount_type,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.discount_type=l),options:[{label:o(a)("discount.fixed_amount"),value:1},{label:o(a)("discount.percentage"),value:2}],optionLabel:"label",optionValue:"value",placeholder:o(a)("discount.select_discount_type"),class:b(["w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":i.value.discount_type}]),disabled:n.value,"aria-required":"true","aria-describedby":"discount_type-error"},null,8,["modelValue","options","placeholder","class","disabled"]),i.value.discount_type?(p(),v("small",Ve,u(i.value.discount_type),1)):f("",!0)]),d("div",ke,[d("label",De,[m(u(o(a)("discount.discount_value"))+" ",1),e[11]||(e[11]=d("span",{class:"text-red-500"},"*",-1))]),y(o(oe),{id:"discount_value",modelValue:t.value.discount_value,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.discount_value=l),min:0,max:t.value.discount_type===2?100:null,placeholder:o(a)("discount.enter_discount_value"),class:b(["w-full rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":i.value.discount_value}]),disabled:n.value,"aria-required":"true","aria-describedby":"discount_value-error"},null,8,["modelValue","max","placeholder","class","disabled"]),t.value.discount_type===2?(p(),v("small",qe,u(o(a)("discount.percentage_note")),1)):f("",!0),i.value.discount_value?(p(),v("small",$e,u(i.value.discount_value),1)):f("",!0)]),d("div",Fe,[d("label",Le,[m(u(o(a)("discount.expiration_date"))+" ",1),e[12]||(e[12]=d("span",{class:"text-red-500"},"*",-1))]),y(o(le),{id:"expires_at",modelValue:t.value.expires_at,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.expires_at=l),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:o(a)("discount.select_expiration_date"),class:b(["w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":i.value.expiration_date}]),disabled:n.value,showIcon:!0,"aria-required":"true","aria-describedby":"expires_at-error"},null,8,["modelValue","minDate","placeholder","class","disabled"]),i.value.expiration_date?(p(),v("small",Ee,u(i.value.expiration_date),1)):f("",!0)])]),d("div",Ue,[y(o(R),{type:"button",label:o(a)("discount.cancel"),icon:"pi pi-times",onClick:e[6]||(e[6]=l=>o(k).go(-1)),class:"px-6 mx-2 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:n.value,"aria-label":"Cancel"},null,8,["label","disabled"]),y(o(R),{type:"submit",label:o(a)("discount.update_discount"),icon:"pi pi-check",loading:n.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:n.value,"aria-label":"Update Discount"},{default:ae(()=>[n.value?(p(),v("i",Pe)):(p(),v("span",Ce,u(o(a)("discount.update_discount")),1))]),_:1},8,["label","loading","disabled"])])],32),y(o(ie))],8,ue)),[[s,"update discounts"]])}}},Te=H(je,[["__scopeId","data-v-96cd7087"]]);export{Te as default};
