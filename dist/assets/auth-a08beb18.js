import{j as H,I as X,i as S,u as N,J as ee,r as x,K as se,n as ae,q as L,a as p,c as m,h as j,f as i,L as te,e as r,M as oe,t as w,g as v,F as q,d as M,z as A,N as K,b as z,v as E,O as ne,A as le,P as re,D as J}from"./index-9a9fec90.js";import{_ as ie}from"./loginFormImg-996307c8.js";const{t:R}=H(),ue=X("auth",{state:()=>({user:null,token:localStorage.getItem("token")||"",loading:!1,error:""}),getters:{isAuthenticated:h=>!!h.token},actions:{async loginUser(h,_=!1){this.loading=!0,this.error="";try{const u=await S.post("api/login",h);this.user={id:u.data.data.user.id,name:u.data.data.user.name,phone:u.data.data.user.phone,email_verified_at:u.data.data.user.email_verified_at,permissions:u.data.data.user.permissions||[]},this.token=u.data.data.access_token,_&&(localStorage.setItem("userPermissions",JSON.stringify(this.user.permissions)),localStorage.setItem("usertoken",this.token)),await N().push({name:"home"})}catch(u){this.handleLoginError(u)}finally{this.loading=!1}},handleLoginError(h){var _,u,P;throw((_=h.response)==null?void 0:_.status)===401?this.error=R("auth.notcorrect"):(P=(u=h.response)==null?void 0:u.data)!=null&&P.message?this.error=h.response.data.message:this.error=R("auth.noneerorr"),h},logout(){const h=N();this.user=null,this.token="",this.error="",localStorage.removeItem("token"),localStorage.removeItem("userPermissions"),h.push({name:"login"})},async registration(h){this.loading=!0,this.error="";try{await S.post("api/register",h)&&this.loginUser({phone:h.phone,password:h.password})}catch(_){this.handleLoginError(_)}finally{this.loading=!1}},clear(){this.error=""}}}),de={class:"flex flex-col bg-[#111] min-h-[110vh]"},pe={class:"min-h-[80vh] flex justify-evenly items-center"},ce={class:"bg-[#2A2A2A] p-8 rounded-md text-white lg:w-[40%] w-[80%]"},me={class:""},he={class:"font-bold"},ve={class:"text-[#9F9F9F] mb-6 text-center text-sm"},ge={key:0,class:"text-center text-red-500"},fe={class:"flex flex-col gap-1 w-full text-white"},we={key:0,class:"mb-2"},ye=["onUpdate:modelValue","type","placeholder","onBlur","id"],be=["onClick"],ke={key:2,class:"text-red-500 text-xs mx-4"},xe={key:2,class:"mb-2"},_e={key:3,class:"py-2 rounded-md px-4 flex items-center gap-2 justify-between"},Pe=["onUpdate:modelValue","onInput","onKeydown"],Te={key:4},$e={key:5,class:"font-bold cursor-pointer"},Ve={key:6,class:"flex justify-between w-full"},Oe={for:"rememberme"},Se={key:7},Ce={for:"Terms"},Fe={key:8,class:"text-xs text-[#9F9F9F]"},Be={__name:"auth",setup(h){const _=N(),u=ee(),P=ue(),{t:n}=H(),e=x("login"),y=x(!1),B=x(!0),U=x(!1),k=x([{type:"username",data:"",inputtype:"text",icon:"pi-user",placeholder:"Your Name",page:["registration"]},{type:"phone",data:"",placeholder:"07xxxxxxxx",inputtype:"text",page:["login","registration","missedPassword"]},{type:"password",data:"",icon:"pi-lock",showicon:"pi-eye-slash",inputtype:"password",page:["login","registration","newPassword"]},{type:"checkpassword",data:"",icon:"pi-lock",showicon:"pi-eye-slash",inputtype:"password",page:["registration","newPassword"]}]),C=x(60),$=se(["","","","","",""]),F=x({phone:"",newpass:"",renewpass:""}),Y=x(6),Z=(t,s)=>{const d=s.target.value;if(!/^[0-9]$/.test(d)){$[t]="";return}$[t]=d,t<$.length-1&&J(()=>{const c=document.querySelectorAll("input")[t+1];c==null||c.focus()})},G=(t,s)=>{$[t]===""&&t>0&&J(()=>{const d=document.querySelectorAll("input")[t-1];d==null||d.focus()})},l=x({}),D=t=>{const s=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/;switch(t){case"password":l.value.type=t;const d=k.value.find(T=>T.type==="password"),c=d==null?void 0:d.data.trim();c?s.test(c)?l.value.message="":l.value.message=n("auth.passworderr"):l.value.message=n("auth.passwordreq");break;case"username":l.value.type=t;const o=k.value.find(T=>T.type===t);(o==null?void 0:o.data.trim())?l.value.message="":l.value.message=n("auth.usernamereq");break;case"checkpassword":l.value.type=t;const b=k.value.find(T=>T.type==="password"),I=b==null?void 0:b.data.trim(),V=k.value.find(T=>T.type===t),O=V==null?void 0:V.data.trim();O?O!==I?l.value.message=n("auth.repassworderr"):l.value.message="":l.value.message=n("auth.repasswordreq");break;case"phone":l.value.type=t;const a=k.value.find(T=>T.type===t),f=a==null?void 0:a.data.trim();f?/^\d+$/.test(f)?l.value.message="":l.value.message=n("auth.justnum"):l.value.message=n("auth.phonereq");break}},Q=async()=>{var d,c,o,g,b,I,V,O;const t=k.value.filter(a=>a.page.includes(e.value));for(const a of t)if(D(a.type),l.value.message)break;const s=x({});if(!l.value.message&&e.value=="login"){y.value=!0;for(const a of t)s.value.phone=a.type=="phone"?a.data:s.value.phone,s.value.password=a.type=="password"?a.data:s.value.password;await P.loginUser(s.value,B.value).finally(()=>{y.value=!1})}else if(!l.value.message&&e.value=="registration"){if(!U.value)throw u.add({severity:"info",summary:n("auth.Terms"),detail:n("auth.Termserror"),life:3e3});y.value=!0;for(const a of t)s.value.password=a.type=="password"?a.data:s.value.password,s.value.name=a.type=="username"?a.data:s.value.name,s.value.phone=a.type=="phone"?a.data:s.value.phone;await P.registration(s.value).finally(()=>{y.value=!1})}else if(!l.value.message&&e.value=="missedPassword"){y.value=!0;try{const a=await S.post("api/send-otp",{phone:(d=k.value.find(f=>f.type==="phone"))==null?void 0:d.data});!l.value.message&&e.value=="missedPassword"&&(e.value="OTP",F.value.phone=(c=k.value.find(f=>f.type==="phone"))==null?void 0:c.data,C.value=60,setInterval(()=>{if(C.value>0)C.value--;else return},1e3),u.add({severity:"success",summary:"Send OTP",detail:a.data.message,life:3e3}))}catch(a){const f=(g=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:g.message;u.add({severity:"error",summary:"Send OTP",detail:f,life:3e3})}finally{y.value=!1}}else if(!l.value.message&&e.value=="OTP"){y.value=!0;try{const a=await S.post("api/verify-email",{phone:F.value.phone,otp:$.join("")});e.value="newPassword",u.add({severity:"success",summary:"Verify Email",detail:a.data.message,life:3e3})}catch(a){const f=(I=(b=a==null?void 0:a.response)==null?void 0:b.data)==null?void 0:I.message;u.add({severity:"error",summary:"Verify Email",detail:f,life:3e3})}finally{y.value=!1}}else if(!l.value.message&&e.value=="newPassword"){y.value=!0;for(const a of t)s.value.password=a.type=="password"?a.data:s.value.password,s.value.repassword=a.type=="checkpassword"?a.data:s.value.repassword;try{const a=await S.post("api/change-password",{phone:F.value.phone,otp:$.join(""),password:s.value.password,password_confirmation:s.value.repassword});e.value="login",u.add({severity:"success",summary:"Change Password",detail:a.data.message,life:3e3})}catch(a){const f=(O=(V=a==null?void 0:a.response)==null?void 0:V.data)==null?void 0:O.message;u.add({severity:"error",summary:"Change Password",detail:f,life:3e3})}finally{y.value=!1}}},W=t=>{const s=document.getElementById(t),d=k.value.find(c=>c.type===t);s.type=="text"?(s.type="password",d.showicon="pi-eye-slash"):s.type=="password"&&(s.type="text",d.showicon="pi-eye")};return ae(e,(t,s)=>{P.clear()}),(t,s)=>{const d=L("Toast"),c=L("Button");return p(),m(q,null,[j(d),i("main",de,[i("nav",null,[i("img",{src:te,alt:"",width:"80",class:"m-[2rem] cursor-pointer",onClick:s[0]||(s[0]=o=>r(_).push({name:"home"}))})]),i("div",pe,[i("div",ce,[i("div",me,[i("form",{class:"flex flex-col gap-4 items-center",onSubmit:s[5]||(s[5]=oe(o=>Q(),["prevent"]))},[i("h1",he,w(e.value=="login"?t.$t("auth.loginnow"):e.value=="registration"?t.$t("auth.registrationnow"):e.value=="missedPassword"?t.$t("auth.forgotpassword"):e.value=="OTP"?t.$t("auth.Activationcode"):t.$t("auth.newpassH")),1),i("p",ve,w(e.value=="login"||e.value=="registration"?r(n)("auth.loginnote"):e.value=="missedPassword"?r(n)("auth.forgotpasswordP"):e.value=="OTP"?r(n)("auth.donesend")+` ${F.value.phone}`:r(n)("auth.newpassP")),1),r(P).error?(p(),m("span",ge,w(r(P).error),1)):v("",!0),e.value!="OTP"?(p(!0),m(q,{key:1},M(k.value,o=>(p(),m("div",fe,[o.page.includes(e.value)?(p(),m("label",we,w(r(n)(`auth.${o.type}`)),1)):v("",!0),o.page.includes(e.value)?(p(),m("div",{key:1,class:E(["bg-[#9F9F9F26] py-2 rounded-md px-4 flex items-center gap-2",l.value.type==o.type&&l.value.message?"border-2 border-red-500":""])},[i("i",{class:E(["pi",o.icon?o.icon:""])},null,2),A(i("input",{"onUpdate:modelValue":g=>o.data=g,type:o.inputtype,placeholder:o.placeholder,class:"bg-transparent outline-none flex-1",onBlur:g=>D(o.type),id:o.type},null,40,ye),[[ne,o.data]]),i("i",{class:E(["pi",o.showicon?o.showicon:""]),onClick:g=>W(o.type)},null,10,be)],2)):v("",!0),l.value.type==o.type&&l.value.message?(p(),m("span",ke,w(l.value.message),1)):v("",!0)]))),256)):v("",!0),e.value=="OTP"?(p(),m("label",xe,w(r(n)("auth.code")),1)):v("",!0),e.value=="OTP"?(p(),m("div",_e,[(p(!0),m(q,null,M(Y.value,(o,g)=>A((p(),m("input",{key:g,"onUpdate:modelValue":b=>$[g]=b,ref_for:!0,ref:"otpInput",maxlength:"1",type:"text",inputmode:"numeric",class:"w-[50px] h-[50px] text-center rounded border bg-transparent border-gray-300 focus:outline-none focus:border-blue-500",onInput:b=>Z(g,b),onKeydown:re(b=>G(g),["backspace"])},null,40,Pe)),[[le,$[g]]])),128))])):v("",!0),e.value=="OTP"?(p(),m("label",Te,w(r(n)("auth.expen")+` ${C.value}s`),1)):v("",!0),e.value=="OTP"?(p(),m("label",$e,w(r(n)("auth.resend")),1)):v("",!0),e.value=="login"?(p(),m("div",Ve,[i("div",null,[A(i("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>B.value=o),type:"checkbox",id:"rememberme",class:"mx-2"},null,512),[[K,B.value]]),i("label",Oe,w(r(n)("auth.rememberme")),1)]),i("span",{class:"text-blue-500 cursor-pointer hover:translate-y-[-3px] transition-all",onClick:s[2]||(s[2]=o=>e.value="missedPassword")},w(r(n)("auth.forgotpassword")),1)])):v("",!0),e.value=="registration"?(p(),m("div",Se,[A(i("input",{"onUpdate:modelValue":s[3]||(s[3]=o=>U.value=o),type:"checkbox",id:"Terms",class:"mx-2 text-xs"},null,512),[[K,U.value]]),i("label",Ce,w(r(n)("auth.terms")),1)])):v("",!0),j(c,{type:"submit",loading:y.value,label:e.value=="registration"?r(n)("auth.registration"):e.value=="login"?r(n)("auth.login"):(e.value=="missedPassword",t.$t("auth.ok")),class:"outline-none w-full mt-6 focus:!shadow-none"},null,8,["loading","label"]),j(c,{onClick:s[4]||(s[4]=o=>e.value=="registration"?e.value="login":e.value="registration"),label:e.value=="login"||e.value=="missedPassword"?r(n)("auth.registration"):e.value=="registration"?r(n)("auth.login"):r(n)("auth.registration"),severity:"secondary",class:"outline-none w-full focus:!shadow-none Custombutton"},null,8,["label"]),e.value!="OTP"&&e.value!="newPassword"?(p(),m("span",Fe,w(t.$t("auth.or")),1)):v("",!0),e.value!="OTP"&&e.value!="newPassword"?(p(),z(c,{key:9,label:r(n)("auth.loginwithfacebock"),icon:"pi pi-facebook",severity:"secondary",class:"text-[#9F9F9F] !text-sm outline-none w-full focus:!shadow-none Custombutton"},null,8,["label"])):v("",!0),e.value!="OTP"&&e.value!="newPassword"?(p(),z(c,{key:10,label:r(n)("auth.loginwithgoogle"),icon:"pi pi-google",severity:"secondary",class:"text-[#9F9F9F] !text-sm outline-none w-full focus:!shadow-none Custombutton"},null,8,["label"])):v("",!0)],32)])]),s[6]||(s[6]=i("div",null,[i("img",{src:ie,alt:"",class:"lg:block hidden w-[450px] rounded-tl-[30%] rounded-br-[30%]"})],-1))])])],64)}}};export{Be as default};
