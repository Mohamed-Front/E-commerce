import{_ as Y,j as Z,G as ee,r as g,l as B,q as P,o as te,a as d,c,f as a,h as V,e as i,t as r,F as C,d as S,g as I,y as L,U as ae,A as se,H as re,x as oe,Q as ie}from"./index-12ec1bf4.js";const le=["dir"],ne={class:"flex lg:flex-row flex-col gap-10"},de={class:"flex-1 bg-white rounded-2xl shadow-lg p-6"},ce={key:0,class:"flex justify-center items-center py-4"},ue={class:"ml-2"},_e={key:1},me={class:"mb-6"},ye={class:"text-lg font-semibold text-gray-800 mb-2"},ve={class:"flex flex-wrap gap-2 mb-4"},he=["onClick"],pe={class:"mb-6"},fe={class:"text-lg font-semibold text-gray-800 mb-2"},xe={value:null,disabled:""},ge=["value"],be={key:0,class:"text-center text-gray-600 py-4"},we={key:1},ke=["src","alt"],qe={class:"flex flex-col mx-4 gap-2 flex-1"},Ce={class:"text-lg font-bold text-gray-800"},Se={class:"text-yellow-600 text-sm"},je={class:"flex items-center justify-between"},Fe={class:"text-yellow-600 text-sm"},$e={class:"border border-gray-300 p-2 rounded-md flex items-center gap-3"},Ae=["onClick","disabled"],Ne={class:"text-sm font-medium"},Me=["onClick"],De=["onClick"],Ee={class:"text-lg font-semibold text-gray-800 mb-4"},Be={key:0,class:"mb-4 p-3 bg-yellow-100 text-yellow-800 rounded-md"},Pe={class:"flex flex-col gap-4"},Ve={class:"flex justify-between items-center"},Ie={class:"text-yellow-600 font-semibold"},Le={class:"text-gray-700"},Te={class:"flex justify-between items-center"},Ue={class:"text-yellow-600 font-semibold"},Qe={class:"text-gray-700"},We={class:"flex justify-between items-center"},ze={class:"text-yellow-600 font-semibold"},Ge={class:"text-gray-700"},He={class:"flex justify-between items-center"},Re={class:"text-yellow-600 font-semibold"},Je={class:"text-gray-700"},Ke=["disabled"],Oe={class:"lg:w-1/4 w-full p-6 bg-white rounded-2xl shadow-lg"},Xe={class:"text-lg font-semibold text-gray-800 mb-4"},Ye={class:"flex flex-col gap-4"},Ze={class:"flex justify-between items-center"},et={class:"text-yellow-600 font-semibold"},tt={class:"text-gray-700"},at={class:"flex justify-between items-center"},st={class:"text-yellow-600 font-semibold"},rt={class:"text-gray-700"},ot={class:"flex justify-between items-center"},it={class:"text-yellow-600 font-semibold"},lt={class:"text-gray-700"},nt={class:"flex flex-col mt-6"},dt=["placeholder"],ct=["disabled"],ut={__name:"cart",setup(_t){const{t,locale:j}=Z(),_=ee(),F=g(!0),b=g([]),m=g([]),u=g([]),k=g([]),y=g(null),w=g(""),f=g([]),T=o=>`${o.store_id}-${o.market_id||"no-market"}`,U=o=>{const s=j.value==="ar"?o.store_name_ar:o.store_name_en,e=j.value==="ar"?o.market_name_ar:o.market_name_en;return o.market_id&&e?s&&e&&s.toLowerCase()!==e.toLowerCase()?`${s} - ${e}`:e||s:s||t("store.unknown")},p=B(()=>u.value.length===0?[]:b.value.filter(o=>u.value.includes(o.unique_store_id))),$=B(()=>{if(f.value.length===0)return{order_without_tax:"0.00",tax:"0.00",total:"0.00"};const o=f.value.reduce((s,e)=>({order_without_tax:s.order_without_tax+Number(e.subtotal||0),tax:s.tax+Number(e.tax||0),total:s.total+Number(e.total||0)}),{order_without_tax:0,tax:0,total:0});return{order_without_tax:o.order_without_tax.toFixed(2),tax:o.tax.toFixed(2),total:o.total.toFixed(2)}}),Q=async()=>{try{const s={is_success:!0,data:[{id:1,address_line_1:"123 Main St",city:"Amman"},{id:2,address_line_1:"456 Side Rd",city:"Irbid"}]};s.is_success&&(k.value=s.data,k.value.length>0&&(y.value=k.value[0].id))}catch{_.add({severity:"error",summary:t("error"),detail:t("cart.addressLoadError"),life:3e3})}},W=async()=>{try{F.value=!0;const s={is_success:!0,message:"Cart details",data:{stores:[{store_id:4,market_id:null,store_name_ar:"شفت 7 مول",store_name_en:"Shift7 Mall",market_name_en:null,market_name_ar:null,items:[{product_id:26007,variant_id:null,quantity:3,product:{id:26007,store_id:4,name_ar:"سلة غسيل بورسيف سكوير - 2",name_en:"Bursev Square Laundry Basket-2",base_price:"1.00",media:[{url:"https://shift.test.visualinnovate.net/public/storage/uploads/products/product-26007-product_image-1.jpg"}]}},{product_id:26006,variant_id:null,quantity:1,product:{id:26006,store_id:4,name_ar:"سلة بورسيف بيرل متعددة الأغراض مع غطاء 1,25 لتر",name_en:"Bursev Pearl Multipurpose Basket With Lid 1,25lt",base_price:"1.00",media:[{url:"https://shift.test.visualinnovate.net/public/storage/uploads/products/product-26006-product_image-1.jpg"}]}}]},{store_id:5,market_id:482,store_name_ar:"سوبر ماركت",store_name_en:"Super Market",market_name_en:"centro market",market_name_ar:"سينترو ماركت",items:[{product_id:32405,variant_id:null,quantity:1,product:{id:32405,store_id:5,name_ar:"قهوة تركية بن العميد وسط بدون هيل منزوعة الكافيين، 250 جرام",name_en:"Al Ameed Decaf Turkish Coffee Medium without Cardamom, 250g",base_price:"4.90",media:[]}}]},{store_id:5,market_id:1126,store_name_ar:"سوبر ماركت",store_name_en:"Super Market",market_name_en:"Shift Mart",market_name_ar:"شفت مارت",items:[{product_id:255,variant_id:null,quantity:1,product:{id:255,store_id:5,name_ar:"مياه فولفيك معدنية - 500 مل",name_en:"Volvic Mineral Water - 500 ml",base_price:"1.00",media:[{url:"https://shift.test.visualinnovate.net/public/storage/uploads/products/product-255-product_image-1_jpg.jpg"}]}}]}]}};if(s.is_success){const e=[],l=[];s.data.stores.forEach(n=>{const q=T(n),K=U(n);e.some(h=>h.unique_store_id===q)||e.push({unique_store_id:q,store_id:n.store_id,market_id:n.market_id,store_name_ar:n.store_name_ar,store_name_en:n.store_name_en,market_name_ar:n.market_name_ar,market_name_en:n.market_name_en,display_name:K}),n.items.forEach(h=>{var M,D,E;const x=h.product,O=((D=(M=x.media)==null?void 0:M[0])==null?void 0:D.url)||x.key_default_image||"/images/placeholder-product.png",X=(E=h.variant)!=null&&E.price?parseFloat(h.variant.price):parseFloat(x.base_price)||0;l.push({uniqueId:`${h.product_id}-${h.variant_id||"no-var"}-${q}`,product_id:h.product_id,variant_id:h.variant_id,name:j.value==="ar"?x.name_ar||x.name_en:x.name_en||x.name_ar,img:O,price:X.toFixed(2),quantity:h.quantity,store_id:x.store_id,market_id:n.market_id,unique_store_id:q})})}),m.value=e,b.value=l,m.value.length>0&&(u.value=[m.value[0].unique_store_id]),await v()}}catch{_.add({severity:"error",summary:t("error"),detail:t("cart.cartLoadError"),life:3e3})}finally{F.value=!1}},z=o=>{const s=m.value.find(e=>e.unique_store_id===o);return(s==null?void 0:s.display_name)||t("store.unknown")},v=async()=>{if(!y.value||p.value.length===0){f.value=[];return}const o=p.value.reduce((s,e)=>{const l=e.unique_store_id;return s[l]||(s[l]={unique_store_id:l,store_id:e.store_id,market_id:e.market_id,items:[]}),s[l].items.push({product_id:e.product_id,variant_id:e.variant_id,quantity:e.quantity}),s},{});y.value,p.value.map(s=>({product_id:s.product_id,variant_id:s.variant_id,quantity:s.quantity,unique_store_id:s.unique_store_id})),w.value&&w.value;try{const e={is_success:!0,data:Object.keys(o).map((l,n)=>({unique_store_id:l,delivery_time:`30 - ${30+n*10} min`,delivery_message:n%2===0?`Free delivery for orders over 100 ${t("cart.currency")}`:null,subtotal:(n+1)*10,tax:(n+1)*.5,total:(n+1)*10.5}))};e.is_success&&(f.value=e.data.map(l=>({...l,unique_store_id:l.unique_store_id})))}catch{_.add({severity:"error",summary:t("error"),detail:t("cart.orderTotalsError"),life:3e3}),f.value=[]}},G=o=>{u.value.includes(o)?u.value=u.value.filter(s=>s!==o):u.value.push(o),v()},H=()=>{u.value=m.value.map(o=>o.unique_store_id),v()},A=async(o,s)=>{const e=o==="plus"?s.quantity+1:s.quantity-1;if(!(e<1))try{s.quantity=e,await v(),_.add({severity:"success",summary:t("success"),detail:t("cart.quantityUpdated"),life:2e3})}catch{_.add({severity:"error",summary:t("error"),detail:t("cart.quantityUpdateError"),life:3e3})}},R=async o=>{try{b.value=b.value.filter(e=>e.uniqueId!==o.uniqueId),b.value.filter(e=>e.unique_store_id===o.unique_store_id).length===0&&(u.value=u.value.filter(e=>e!==o.unique_store_id),m.value=m.value.filter(e=>e.unique_store_id!==o.unique_store_id)),await v(),_.add({severity:"success",summary:t("success"),detail:t("cart.removeSuccess"),life:3e3})}catch{_.add({severity:"error",summary:t("error"),detail:t("cart.removeError"),life:3e3})}},J=async()=>{await v(),_.add({severity:"info",summary:t("info"),detail:t("cart.couponApplied"),life:3e3})},N=async()=>{if(!y.value||p.value.length===0){_.add({severity:"warn",summary:t("warning"),detail:t("cart.cannotCheckout"),life:3e3});return}try{const o={address_id:y.value,items:p.value.map(e=>({product_id:e.product_id,variant_id:e.variant_id,quantity:e.quantity,unique_store_id:e.unique_store_id}))};w.value&&(o.coupon=w.value),{is_success:!0}.is_success&&(_.add({severity:"success",summary:t("success"),detail:t("cart.orderSuccess"),life:5e3}),b.value=b.value.filter(e=>!u.value.includes(e.unique_store_id)),m.value=m.value.filter(e=>!u.value.includes(e.unique_store_id)),f.value=[],u.value=[])}catch{_.add({severity:"error",summary:t("error"),detail:t("cart.orderError"),life:4e3})}};return P(()=>y.value,v),P(()=>w.value,o=>{(o||f.value.length>0)&&v()}),te(()=>{Q(),W()}),(o,s)=>(d(),c("div",{class:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 font-inter",dir:o.$i18n.locale==="ar"?"rtl":"ltr"},[a("div",ne,[a("section",de,[F.value?(d(),c("div",ce,[V(i(re),{style:{width:"40px",height:"40px"},strokeWidth:"4",class:"text-yellow-600"}),a("p",ue,r(i(t)("loading")),1)])):(d(),c("div",_e,[a("div",me,[a("h3",ye,r(i(t)("cart.selectStore")),1),a("div",ve,[(d(!0),c(C,null,S(m.value,e=>(d(),c("button",{key:e.unique_store_id,onClick:l=>G(e.unique_store_id),class:oe(["px-4 py-2 rounded-md text-sm font-medium transition-colors",u.value.includes(e.unique_store_id)?"bg-yellow-600 text-white":"bg-amber-50 text-yellow-600"])},r(e.display_name),11,he))),128)),m.value.length>1?(d(),c("button",{key:0,onClick:H,class:"px-4 py-2 rounded-md text-sm font-medium bg-amber-50 text-yellow-600 hover:bg-amber-100 transition-colors"},r(i(t)("cart.selectAllStores")),1)):I("",!0)])]),a("div",pe,[a("h3",fe,r(i(t)("cart.selectAddress")),1),L(a("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>y.value=e),onChange:v,class:"w-full bg-amber-50 border border-amber-200 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-600 transition-all"},[a("option",xe,r(i(t)("cart.selectAddressPlaceholder")),1),(d(!0),c(C,null,S(k.value,e=>(d(),c("option",{key:e.id,value:e.id},r(e.address_line_1)+", "+r(e.city),9,ge))),128))],544),[[ae,y.value]])]),p.value.length===0?(d(),c("div",be,r(i(t)("cart.emptyCart")),1)):(d(),c("div",we,[(d(!0),c(C,null,S(p.value,e=>(d(),c("div",{key:e.uniqueId,class:"flex items-center mt-6 bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300"},[a("img",{src:e.img,alt:e.name,class:"w-16 h-16 md:w-20 md:h-20 lg:w-28 lg:h-28 object-cover rounded-md border border-gray-800"},null,8,ke),a("div",qe,[a("h3",Ce,r(e.name),1),a("p",Se,r(i(t)("cart.price"))+": "+r(e.price)+" "+r(i(t)("cart.currency")),1),a("div",je,[a("p",Fe,r(i(t)("cart.quantity"))+": "+r(e.quantity),1),a("div",$e,[a("button",{onClick:l=>A("minus",e),class:"text-lg font-semibold text-gray-700 hover:text-yellow-600 transition-colors",disabled:e.quantity<=1}," - ",8,Ae),a("span",Ne,r(e.quantity),1),a("button",{onClick:l=>A("plus",e),class:"text-lg font-semibold text-gray-700 hover:text-yellow-600 transition-colors"}," + ",8,Me)]),a("button",{onClick:l=>R(e),class:"text-white bg-yellow-600 px-3 py-1 text-sm rounded-md hover:bg-yellow-700 transition-all"},r(i(t)("cart.remove")),9,De)])])]))),128)),(d(!0),c(C,null,S(f.value,e=>(d(),c("div",{key:e.store_id,class:"bg-gray-100 p-6 mt-6 rounded-lg shadow-inner"},[a("h3",Ee,r(i(t)("cart.orderFrom"))+" "+r(z(e.unique_store_id)),1),e.delivery_message?(d(),c("div",Be,r(e.delivery_message),1)):I("",!0),a("div",Pe,[a("span",Ve,[a("h4",Ie,r(i(t)("cart.shippingTime")),1),a("p",Le,r(e.delivery_time||i(t)("cart.notAvailable")),1)]),a("span",Te,[a("h4",Ue,r(i(t)("cart.subtotal")),1),a("p",Qe,r(Number(e.subtotal).toFixed(2))+" "+r(i(t)("cart.currency")),1)]),a("span",We,[a("h4",ze,r(i(t)("cart.tax")),1),a("p",Ge,r(Number(e.tax).toFixed(2))+" "+r(i(t)("cart.currency")),1)]),a("span",He,[a("h4",Re,r(i(t)("cart.total")),1),a("p",Je,r(Number(e.total).toFixed(2))+" "+r(i(t)("cart.currency")),1)])]),a("button",{disabled:!y.value||p.value.length===0,onClick:N,class:"w-full mt-6 py-3 text-sm sm:text-base lg:text-lg bg-gray-800 rounded-md text-white font-semibold transition-transform duration-150 hover:shadow-lg active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed"},r(i(t)("cart.checkout")),9,Ke)]))),128))]))]))]),a("section",Oe,[a("h3",Xe,r(i(t)("cart.orderSummary")),1),a("div",Ye,[a("span",Ze,[a("h4",et,r(i(t)("cart.subtotal")),1),a("p",tt,r($.value.order_without_tax)+" "+r(i(t)("cart.currency")),1)]),a("span",at,[a("h4",st,r(i(t)("cart.tax")),1),a("p",rt,r($.value.tax)+" "+r(i(t)("cart.currency")),1)]),a("span",ot,[a("h4",it,r(i(t)("cart.total")),1),a("p",lt,r($.value.total)+" "+r(i(t)("cart.currency")),1)])]),a("div",nt,[L(a("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>w.value=e),type:"text",placeholder:i(t)("cart.couponPlaceholder"),class:"bg-amber-50 placeholder-yellow-600 border border-amber-200 rounded-md w-full px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-600 transition-all"},null,8,dt),[[se,w.value]]),a("button",{onClick:J,class:"w-full mt-4 py-2 text-sm bg-amber-100 rounded-md text-yellow-600 font-semibold hover:bg-amber-200 transition-all active:scale-95"},r(i(t)("cart.applyCoupon")),1),a("button",{disabled:!y.value||p.value.length===0,onClick:N,class:"w-full mt-4 py-2 text-sm bg-gray-800 rounded-md text-white font-semibold hover:shadow-lg transition-all active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed"},r(i(t)("cart.checkout")),9,ct)])])]),V(i(ie))],8,le))}},yt=Y(ut,[["__scopeId","data-v-beca4744"]]);export{yt as default};
