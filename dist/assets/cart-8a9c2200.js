import{_ as G,j as H,G as W,r as y,l as N,q as J,o as K,a as i,c,f as a,h as T,e as o,t as r,F as k,d as C,g as V,z as B,U as R,B as X,i as f,H as Y,y as Z,Q as O}from"./index-0f9d1d10.js";const ee=["dir"],te={class:"flex lg:flex-row flex-col gap-10"},ae={class:"flex-1 bg-white rounded-2xl shadow-lg p-6"},se={key:0,class:"flex justify-center items-center py-4"},re={class:"ml-2"},oe={key:1},le={class:"mb-6"},ie={class:"text-lg font-semibold text-gray-800 mb-2"},ce={class:"flex flex-wrap gap-2 mb-4"},ne=["onClick","aria-label"],de=["aria-label"],ue={class:"mb-6"},_e={class:"text-lg font-semibold text-gray-800 mb-2"},me=["aria-label"],ye={value:null,disabled:""},ve=["value"],he={key:0,class:"text-center text-gray-600 py-4"},pe={key:1},fe=["src","alt"],xe={class:"flex flex-col mx-4 gap-2 flex-1"},be={class:"text-lg font-bold text-gray-800"},ge={class:"text-yellow-600 text-sm"},we={class:"flex items-center justify-between"},ke={class:"text-yellow-600 text-sm"},Ce={class:"border border-gray-300 p-2 rounded-md flex items-center gap-3"},qe=["onClick","disabled","aria-label"],Ee={class:"text-sm font-medium"},Se=["onClick","aria-label"],$e=["onClick","aria-label"],Ae={class:"text-lg font-semibold text-gray-800 mb-4"},je={key:0,class:"mb-4 p-3 bg-yellow-100 text-yellow-800 rounded-md"},Fe={class:"flex flex-col gap-4"},Pe={class:"flex justify-between items-center"},Ne={class:"text-yellow-600 font-semibold"},Te={class:"text-gray-700"},Ve={class:"flex justify-between items-center"},Be={class:"text-yellow-600 font-semibold"},De={class:"text-gray-700"},Me={class:"flex justify-between items-center"},Qe={class:"text-yellow-600 font-semibold"},Le={class:"text-gray-700"},Ue={class:"flex justify-between items-center"},ze={class:"text-yellow-600 font-semibold"},Ie={class:"text-gray-700"},Ge=["disabled","aria-label"],He={class:"lg:w-1/4 w-full p-6 bg-white rounded-2xl shadow-lg"},We={class:"text-lg font-semibold text-gray-800 mb-4"},Je={class:"flex flex-col gap-4"},Ke={class:"flex justify-between items-center"},Re={class:"text-yellow-600 font-semibold"},Xe={class:"text-gray-700"},Ye={class:"flex justify-between items-center"},Ze={class:"text-yellow-600 font-semibold"},Oe={class:"text-gray-700"},et={class:"flex justify-between items-center"},tt={class:"text-yellow-600 font-semibold"},at={class:"text-gray-700"},st={class:"flex flex-col mt-6"},rt=["placeholder","aria-label"],ot=["aria-label"],lt=["disabled","aria-label"],it={__name:"cart",setup(ct){const{t:e,locale:A}=H(),n=W(),x=y(""),h=y([]),q=y(!0),g=y([]),u=y(null),E=y(!1),b=y([]),p=y([]),_=y([]),m=N(()=>_.value.length===0?[]:h.value.filter(s=>_.value.includes(s.store_id))),S=N(()=>b.value.length===0?{delivery:0,time:0,coupon:0,order_tax:0,order_without_tax:0,total:0}:b.value.reduce((s,l)=>({delivery:s.delivery+(l.delivery||0),time:Math.max(s.time,l.time||0),coupon:s.coupon+(l.coupon||0),order_tax:s.order_tax+(l.order_tax||0),order_without_tax:s.order_without_tax+(l.order_without_tax||0),total:s.total+(l.total||0)}),{delivery:0,time:0,coupon:0,order_tax:0,order_without_tax:0,total:0})),D=async()=>{try{const s=await f.get("/api/home/address");s.data.is_success&&(g.value=s.data.data,g.value.length>0&&(u.value=g.value[0].id))}catch(s){n.add({severity:"error",summary:e("error"),detail:e("cart.addressLoadError"),life:3e3}),console.error("Error fetching addresses:",s)}},M=async()=>{try{q.value=!0;const s=await f.get("/api/cart");s.data.is_success&&(h.value=s.data.data.items.map(l=>{const t=l.variant&&l.variant.price?parseFloat(l.variant.price).toFixed(2):parseFloat(l.product.base_price).toFixed(2)||"0.00",d=l.product.media&&l.product.media.length>0?l.product.media[0].url:l.product.key_default_image||"/images/placeholder-product.png";return{id:`${l.product_id}-${l.variant_id||"no-variant"}`,product_id:l.product_id,variant_id:l.variant_id,name:A.value==="ar"?l.product.name_ar:l.product.name_en||e("product.defaultName"),img:d,price:t,quantity:l.quantity,store_id:l.product.store_id}}),p.value=s.data.data.stores,p.value.length>0&&(_.value=[p.value[0].store_id]),await v())}catch(s){n.add({severity:"error",summary:e("error"),detail:e("cart.cartLoadError"),life:3e3}),console.error("Error fetching cart:",s)}finally{q.value=!1}},v=async()=>{try{if(!u.value||m.value.length===0){b.value=[];return}const s={is_expressed:E.value,address_id:u.value,view:!0,items:m.value.map(t=>({product_id:t.product_id,variant_id:t.variant_id,quantity:t.quantity}))};x.value&&(s.coupon=x.value);const l=await f.post("/api/order/view",s);l.data.is_success&&(b.value=l.data.data)}catch(s){n.add({severity:"error",summary:e("error"),detail:e("cart.orderTotalsError"),life:3e3}),console.error("Error fetching order totals:",s)}},Q=s=>{const l=p.value.find(t=>t.store_id===s);return l?A.value==="ar"?l.store_name_ar:l.store_name_en||e("store.default"):e("store.unknown")},L=async()=>{try{await v(),n.add({severity:"success",summary:e("success"),detail:e("cart.couponSuccess"),life:3e3})}catch(s){n.add({severity:"error",summary:e("error"),detail:e("cart.couponError"),life:3e3}),console.error("Error applying coupon:",s)}},j=async(s,l,t,d,P)=>{const w=h.value.find($=>$.id===l);if(w)try{s==="plus"?(await f.post("/api/cart/update",{product_id:t,variant_id:d,quantity:P+1}),w.quantity+=1,n.add({severity:"success",summary:e("success"),detail:e("cart.quantityIncreased"),life:3e3})):s==="minus"&&w.quantity>1&&(await f.post("/api/cart/update",{product_id:t,variant_id:d,quantity:P-1}),w.quantity-=1,n.add({severity:"success",summary:e("success"),detail:e("cart.quantityDecreased"),life:3e3})),await v()}catch($){n.add({severity:"error",summary:e("error"),detail:e(`cart.quantity${s==="plus"?"Increase":"Decrease"}Error`),life:3e3}),console.error(`Error ${s==="plus"?"increasing":"decreasing"} quantity:`,$)}},U=async(s,l,t)=>{try{await f.post("/api/cart/remove",{product_id:l,variant_id:t}),h.value=h.value.filter(d=>d.id!==s),await v(),n.add({severity:"success",summary:e("success"),detail:e("cart.removeSuccess"),life:3e3})}catch(d){n.add({severity:"error",summary:e("error"),detail:e("cart.removeError"),life:3e3}),console.error("Error clearing product:",d)}},F=async()=>{if(!u.value){n.add({severity:"error",summary:e("error"),detail:e("cart.noAddressSelected"),life:3e3});return}if(m.value.length===0){n.add({severity:"error",summary:e("error"),detail:e("cart.emptyCart"),life:3e3});return}try{const s={is_expressed:E.value,address_id:u.value,items:m.value.map(t=>({product_id:t.product_id,variant_id:t.variant_id,quantity:t.quantity}))};if(x.value&&(s.coupon=x.value),(await f.post("/api/order",s)).data.is_success)h.value=h.value.filter(t=>!m.value.includes(t)),b.value=[],n.add({severity:"success",summary:e("success"),detail:e("cart.orderSuccess"),life:3e3});else throw new Error(e("cart.orderError"))}catch(s){n.add({severity:"error",summary:e("error"),detail:e("cart.orderError"),life:3e3}),console.error("Error submitting order:",s)}},z=s=>{_.value.includes(s)?_.value=_.value.filter(l=>l!==s):_.value.push(s),v()},I=()=>{_.value=p.value.map(s=>s.store_id),v()};return J([u,E],()=>{v()}),K(()=>{D(),M()}),(s,l)=>(i(),c("div",{class:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 font-inter",dir:s.$i18n.locale==="ar"?"rtl":"ltr"},[a("div",te,[a("section",ae,[q.value?(i(),c("div",se,[T(o(Y),{style:{width:"40px",height:"40px"},strokeWidth:"4",class:"text-yellow-600"}),a("p",re,r(o(e)("loading")),1)])):(i(),c("div",oe,[a("div",le,[a("h3",ie,r(o(e)("cart.selectStore")),1),a("div",ce,[(i(!0),c(k,null,C(p.value,t=>(i(),c("button",{key:t.store_id,onClick:d=>z(t.store_id),class:Z(["px-4 py-2 rounded-md text-sm font-medium transition-colors",_.value.includes(t.store_id)?"bg-yellow-600 text-white":"bg-amber-50 text-yellow-600"]),"aria-label":o(e)("cart.selectStoreAria",{name:t.store_name_ar||t.store_name_en})},r(s.$i18n.locale==="ar"?t.store_name_ar:t.store_name_en||o(e)("store.default")),11,ne))),128)),p.value.length>1?(i(),c("button",{key:0,onClick:I,class:"px-4 py-2 rounded-md text-sm font-medium bg-amber-50 text-yellow-600 hover:bg-amber-100 transition-colors","aria-label":o(e)("cart.selectAllStores")},r(o(e)("cart.selectAllStores")),9,de)):V("",!0)])]),a("div",ue,[a("h3",_e,r(o(e)("cart.selectAddress")),1),B(a("select",{"onUpdate:modelValue":l[0]||(l[0]=t=>u.value=t),onChange:v,class:"w-full bg-amber-50 border border-amber-200 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-600 transition-all","aria-label":o(e)("cart.selectAddressAria")},[a("option",ye,r(o(e)("cart.selectAddressPlaceholder")),1),(i(!0),c(k,null,C(g.value,t=>(i(),c("option",{key:t.id,value:t.id},r(t.address_line_1)+", "+r(t.city),9,ve))),128))],40,me),[[R,u.value]])]),m.value.length===0?(i(),c("div",he,r(o(e)("cart.emptyCart")),1)):(i(),c("div",pe,[(i(!0),c(k,null,C(m.value,t=>(i(),c("div",{key:`${t.product_id}-${t.variant_id||"no-variant"}`,class:"flex items-center mt-6 bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300"},[a("img",{src:t.img,alt:t.name,class:"w-16 h-16 md:w-20 md:h-20 lg:w-28 lg:h-28 object-cover rounded-md border border-gray-800"},null,8,fe),a("div",xe,[a("h3",be,r(t.name),1),a("p",ge,r(o(e)("cart.price"))+": "+r(t.price)+" "+r(o(e)("cart.currency")),1),a("div",we,[a("p",ke,r(o(e)("cart.quantity"))+": "+r(t.quantity),1),a("div",Ce,[a("button",{onClick:d=>j("minus",t.id,t.product_id,t.variant_id,t.quantity),class:"text-lg font-semibold text-gray-700 hover:text-yellow-600 transition-colors",disabled:t.quantity<=1,"aria-label":o(e)("cart.decreaseQuantity")}," - ",8,qe),a("span",Ee,r(t.quantity),1),a("button",{onClick:d=>j("plus",t.id,t.product_id,t.variant_id,t.quantity),class:"text-lg font-semibold text-gray-700 hover:text-yellow-600 transition-colors","aria-label":o(e)("cart.increaseQuantity")}," + ",8,Se)]),a("button",{onClick:d=>U(t.id,t.product_id,t.variant_id),class:"text-white bg-yellow-600 px-3 py-1 text-sm rounded-md hover:bg-yellow-700 transition-all","aria-label":o(e)("cart.removeProductAria",{name:t.name})},r(o(e)("cart.remove")),9,$e)])])]))),128)),(i(!0),c(k,null,C(b.value,t=>(i(),c("div",{key:t.store_id,class:"bg-gray-100 p-6 mt-6 rounded-lg shadow-inner"},[a("h3",Ae,r(o(e)("cart.orderFrom"))+" "+r(Q(t.store_id)),1),t.delivery_message?(i(),c("div",je,r(t.delivery_message),1)):V("",!0),a("div",Fe,[a("span",Pe,[a("h4",Ne,r(o(e)("cart.shippingTime")),1),a("p",Te,r(t.delivery_time?`${t.delivery_time} `:o(e)("cart.notAvailable")),1)]),a("span",Ve,[a("h4",Be,r(o(e)("cart.subtotal")),1),a("p",De,r(t.order_without_tax)+" "+r(o(e)("cart.currency")),1)]),a("span",Me,[a("h4",Qe,r(o(e)("cart.tax")),1),a("p",Le,r(t.order_tax)+" "+r(o(e)("cart.currency")),1)]),a("span",Ue,[a("h4",ze,r(o(e)("cart.total")),1),a("p",Ie,r(t.total)+" "+r(o(e)("cart.currency")),1)])]),a("button",{disabled:!u.value||m.value.length===0,onClick:F,class:"w-full mt-6 py-3 text-sm sm:text-base lg:text-lg bg-gray-800 rounded-md text-white font-semibold transition-transform duration-150 hover:shadow-lg active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed","aria-label":o(e)("cart.checkout")},r(o(e)("cart.checkout")),9,Ge)]))),128))]))]))]),a("section",He,[a("h3",We,r(o(e)("cart.orderSummary")),1),a("div",Je,[a("span",Ke,[a("h4",Re,r(o(e)("cart.subtotal")),1),a("p",Xe,r(S.value.order_without_tax)+" "+r(o(e)("cart.currency")),1)]),a("span",Ye,[a("h4",Ze,r(o(e)("cart.tax")),1),a("p",Oe,r(S.value.order_tax)+" "+r(o(e)("cart.currency")),1)]),a("span",et,[a("h4",tt,r(o(e)("cart.total")),1),a("p",at,r(S.value.total)+" "+r(o(e)("cart.currency")),1)])]),a("div",st,[B(a("input",{"onUpdate:modelValue":l[1]||(l[1]=t=>x.value=t),type:"text",placeholder:o(e)("cart.couponPlaceholder"),class:"bg-amber-50 placeholder-yellow-600 border border-amber-200 rounded-md w-full px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-600 transition-all","aria-label":o(e)("cart.couponPlaceholder")},null,8,rt),[[X,x.value]]),a("button",{onClick:L,class:"w-full mt-4 py-2 text-sm bg-amber-100 rounded-md text-yellow-600 font-semibold hover:bg-amber-200 transition-all active:scale-95","aria-label":o(e)("cart.applyCoupon")},r(o(e)("cart.applyCoupon")),9,ot),a("button",{disabled:!u.value||m.value.length===0,onClick:F,class:"w-full mt-4 py-2 text-sm bg-gray-800 rounded-md text-white font-semibold hover:shadow-lg transition-all active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed","aria-label":o(e)("cart.checkout")},r(o(e)("cart.checkout")),9,lt)])])]),T(o(O))],8,ee))}},dt=G(it,[["__scopeId","data-v-6c408aa4"]]);export{dt as default};
