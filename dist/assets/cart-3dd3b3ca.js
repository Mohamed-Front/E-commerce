import{_ as H,j as J,A as K,r as v,l as N,n as R,o as X,a as i,c as n,f as a,h as T,e as r,t as o,F as C,d as E,g as V,C as M,U as Y,x as $,D as Z,i as x,E as O,O as ee}from"./index-d6bbaf0b.js";const te=["dir"],ae={class:"flex lg:flex-row flex-col gap-10"},se={class:"flex-1 bg-white rounded-2xl shadow-lg p-6"},re={key:0,class:"flex justify-center items-center py-4"},oe={class:"ml-2"},le={key:1},ie={class:"mb-6"},ne={class:"text-lg font-semibold text-gray-800 mb-2"},ce={class:"flex flex-wrap gap-2 mb-4"},de=["onClick","aria-label"],ue=["aria-label"],_e={class:"mb-6"},me={class:"text-lg font-semibold text-gray-800 mb-2"},ye=["aria-label"],ve={value:null,disabled:""},he=["value"],pe={class:"flex items-center gap-4 mb-6"},fe={class:"text-gray-800 font-medium"},xe=["aria-label"],be={key:0,class:"text-center text-gray-600 py-4"},ge={key:1},we=["src","alt"],ke={class:"flex flex-col mx-4 gap-2 flex-1"},Ce={class:"text-lg font-bold text-gray-800"},Ee={class:"text-yellow-600 text-sm"},qe={class:"flex items-center justify-between"},Se={class:"text-yellow-600 text-sm"},Ae={class:"border border-gray-300 p-2 rounded-md flex items-center gap-3"},$e=["onClick","disabled","aria-label"],je={class:"text-sm font-medium"},De=["onClick","aria-label"],Fe=["onClick","aria-label"],Pe={class:"text-lg font-semibold text-gray-800 mb-4"},Ne={key:0,class:"mb-4 p-3 bg-yellow-100 text-yellow-800 rounded-md"},Te={class:"flex flex-col gap-4"},Ve={class:"flex justify-between items-center"},Me={class:"text-yellow-600 font-semibold"},Be={class:"text-gray-700"},Le={class:"flex justify-between items-center"},Qe={class:"text-yellow-600 font-semibold"},Ue={class:"text-gray-700"},Ie={class:"flex justify-between items-center"},ze={class:"text-yellow-600 font-semibold"},We={class:"text-gray-700"},Ge={class:"flex justify-between items-center"},He={class:"text-yellow-600 font-semibold"},Je={class:"text-gray-700"},Ke=["disabled","aria-label"],Re={class:"lg:w-1/4 w-full p-6 bg-white rounded-2xl shadow-lg"},Xe={class:"text-lg font-semibold text-gray-800 mb-4"},Ye={class:"flex flex-col gap-4"},Ze={class:"flex justify-between items-center"},Oe={class:"text-yellow-600 font-semibold"},et={class:"text-gray-700"},tt={class:"flex justify-between items-center"},at={class:"text-yellow-600 font-semibold"},st={class:"text-gray-700"},rt={class:"flex justify-between items-center"},ot={class:"text-yellow-600 font-semibold"},lt={class:"text-gray-700"},it={class:"flex flex-col mt-6"},nt=["placeholder","aria-label"],ct=["aria-label"],dt=["disabled","aria-label"],ut={__name:"cart",setup(_t){const{t:e,locale:j}=J(),c=K(),b=v(""),p=v([]),q=v(!0),w=v([]),u=v(null),h=v(!1),g=v([]),f=v([]),_=v([]),m=N(()=>_.value.length===0?[]:p.value.filter(s=>_.value.includes(s.store_id))),S=N(()=>g.value.length===0?{delivery:0,time:0,coupon:0,order_tax:0,order_without_tax:0,total:0}:g.value.reduce((s,l)=>({delivery:s.delivery+(l.delivery||0),time:Math.max(s.time,l.time||0),coupon:s.coupon+(l.coupon||0),order_tax:s.order_tax+(l.order_tax||0),order_without_tax:s.order_without_tax+(l.order_without_tax||0),total:s.total+(l.total||0)}),{delivery:0,time:0,coupon:0,order_tax:0,order_without_tax:0,total:0})),B=async()=>{try{const s=await x.get("/api/home/address");s.data.is_success&&(w.value=s.data.data,w.value.length>0&&(u.value=w.value[0].id))}catch(s){c.add({severity:"error",summary:e("error"),detail:e("cart.addressLoadError"),life:3e3}),console.error("Error fetching addresses:",s)}},L=async()=>{try{q.value=!0;const s=await x.get("/api/cart");s.data.is_success&&(p.value=s.data.data.items.map(l=>{const t=l.variant&&l.variant.price?parseFloat(l.variant.price).toFixed(2):parseFloat(l.product.base_price).toFixed(2)||"0.00",d=l.product.media&&l.product.media.length>0?l.product.media[0].url:l.product.key_default_image||"/images/placeholder-product.png";return{id:`${l.product_id}-${l.variant_id||"no-variant"}`,product_id:l.product_id,variant_id:l.variant_id,name:j.value==="ar"?l.product.name_ar:l.product.name_en||e("product.defaultName"),img:d,price:t,quantity:l.quantity,store_id:l.product.store_id}}),f.value=s.data.data.stores,f.value.length>0&&(_.value=[f.value[0].store_id]),await y())}catch(s){c.add({severity:"error",summary:e("error"),detail:e("cart.cartLoadError"),life:3e3}),console.error("Error fetching cart:",s)}finally{q.value=!1}},y=async()=>{try{if(!u.value||m.value.length===0){g.value=[];return}const s={is_expressed:h.value,address_id:u.value,view:!0,items:m.value.map(t=>({product_id:t.product_id,variant_id:t.variant_id,quantity:t.quantity}))};b.value&&(s.coupon=b.value);const l=await x.post("/api/order/view",s);l.data.is_success&&(g.value=l.data.data)}catch(s){c.add({severity:"error",summary:e("error"),detail:e("cart.orderTotalsError"),life:3e3}),console.error("Error fetching order totals:",s)}},Q=s=>{const l=f.value.find(t=>t.store_id===s);return l?j.value==="ar"?l.store_name_ar:l.store_name_en||e("store.default"):e("store.unknown")},U=async()=>{try{await y(),c.add({severity:"success",summary:e("success"),detail:e("cart.couponSuccess"),life:3e3})}catch(s){c.add({severity:"error",summary:e("error"),detail:e("cart.couponError"),life:3e3}),console.error("Error applying coupon:",s)}},D=async(s,l,t,d,P)=>{const k=p.value.find(A=>A.id===l);if(k)try{s==="plus"?(await x.post("/api/cart/update",{product_id:t,variant_id:d,quantity:P+1}),k.quantity+=1,c.add({severity:"success",summary:e("success"),detail:e("cart.quantityIncreased"),life:3e3})):s==="minus"&&k.quantity>1&&(await x.post("/api/cart/update",{product_id:t,variant_id:d,quantity:P-1}),k.quantity-=1,c.add({severity:"success",summary:e("success"),detail:e("cart.quantityDecreased"),life:3e3})),await y()}catch(A){c.add({severity:"error",summary:e("error"),detail:e(`cart.quantity${s==="plus"?"Increase":"Decrease"}Error`),life:3e3}),console.error(`Error ${s==="plus"?"increasing":"decreasing"} quantity:`,A)}},I=async(s,l,t)=>{try{await x.delete("/api/cart/clear",{data:{product_id:l,variant_id:t}}),p.value=p.value.filter(d=>d.id!==s),await y(),c.add({severity:"success",summary:e("success"),detail:e("cart.removeSuccess"),life:3e3})}catch(d){c.add({severity:"error",summary:e("error"),detail:e("cart.removeError"),life:3e3}),console.error("Error clearing product:",d)}},F=async()=>{if(!u.value){c.add({severity:"error",summary:e("error"),detail:e("cart.noAddressSelected"),life:3e3});return}if(m.value.length===0){c.add({severity:"error",summary:e("error"),detail:e("cart.emptyCart"),life:3e3});return}try{const s={is_expressed:h.value,address_id:u.value,items:m.value.map(t=>({product_id:t.product_id,variant_id:t.variant_id,quantity:t.quantity}))};if(b.value&&(s.coupon=b.value),(await x.post("/api/order",s)).data.is_success)p.value=p.value.filter(t=>!m.value.includes(t)),g.value=[],c.add({severity:"success",summary:e("success"),detail:e("cart.orderSuccess"),life:3e3});else throw new Error(e("cart.orderError"))}catch(s){c.add({severity:"error",summary:e("error"),detail:e("cart.orderError"),life:3e3}),console.error("Error submitting order:",s)}},z=s=>{_.value.includes(s)?_.value=_.value.filter(l=>l!==s):_.value.push(s),y()},W=()=>{_.value=f.value.map(s=>s.store_id),y()},G=()=>{h.value=!h.value,y()};return R([u,h],()=>{y()}),X(()=>{B(),L()}),(s,l)=>(i(),n("div",{class:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 font-inter",dir:s.$i18n.locale==="ar"?"rtl":"ltr"},[a("div",ae,[a("section",se,[q.value?(i(),n("div",re,[T(r(O),{style:{width:"40px",height:"40px"},strokeWidth:"4",class:"text-yellow-600"}),a("p",oe,o(r(e)("loading")),1)])):(i(),n("div",le,[a("div",ie,[a("h3",ne,o(r(e)("cart.selectStore")),1),a("div",ce,[(i(!0),n(C,null,E(f.value,t=>(i(),n("button",{key:t.store_id,onClick:d=>z(t.store_id),class:$(["px-4 py-2 rounded-md text-sm font-medium transition-colors",_.value.includes(t.store_id)?"bg-yellow-600 text-white":"bg-amber-50 text-yellow-600"]),"aria-label":r(e)("cart.selectStoreAria",{name:t.store_name_ar||t.store_name_en})},o(s.$i18n.locale==="ar"?t.store_name_ar:t.store_name_en||r(e)("store.default")),11,de))),128)),f.value.length>1?(i(),n("button",{key:0,onClick:W,class:"px-4 py-2 rounded-md text-sm font-medium bg-amber-50 text-yellow-600 hover:bg-amber-100 transition-colors","aria-label":r(e)("cart.selectAllStores")},o(r(e)("cart.selectAllStores")),9,ue)):V("",!0)])]),a("div",_e,[a("h3",me,o(r(e)("cart.selectAddress")),1),M(a("select",{"onUpdate:modelValue":l[0]||(l[0]=t=>u.value=t),onChange:y,class:"w-full bg-amber-50 border border-amber-200 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-600 transition-all","aria-label":r(e)("cart.selectAddressAria")},[a("option",ve,o(r(e)("cart.selectAddressPlaceholder")),1),(i(!0),n(C,null,E(w.value,t=>(i(),n("option",{key:t.id,value:t.id},o(t.name)+" - "+o(t.street)+", "+o(t.city),9,he))),128))],40,ye),[[Y,u.value]])]),a("div",pe,[a("label",fe,o(r(e)("cart.expressDelivery")),1),a("button",{onClick:G,class:$(["relative inline-flex items-center h-6 rounded-full w-11 transition-colors duration-200",h.value?"bg-yellow-600":"bg-gray-300"]),"aria-label":r(e)("cart.toggleExpressDeliveryAria",{state:h.value?r(e)("cart.enabled"):r(e)("cart.disabled")})},[a("span",{class:$(["inline-block w-4 h-4 transform bg-white rounded-full transition-transform duration-200",h.value?"translate-x-6":"translate-x-1"])},null,2)],10,xe)]),m.value.length===0?(i(),n("div",be,o(r(e)("cart.emptyCart")),1)):(i(),n("div",ge,[(i(!0),n(C,null,E(m.value,t=>(i(),n("div",{key:`${t.product_id}-${t.variant_id||"no-variant"}`,class:"flex items-center mt-6 bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300"},[a("img",{src:t.img,alt:t.name,class:"w-16 h-16 md:w-20 md:h-20 lg:w-28 lg:h-28 object-cover rounded-md border border-gray-800"},null,8,we),a("div",ke,[a("h3",Ce,o(t.name),1),a("p",Ee,o(r(e)("cart.price"))+": "+o(t.price)+" "+o(r(e)("cart.currency")),1),a("div",qe,[a("p",Se,o(r(e)("cart.quantity"))+": "+o(t.quantity),1),a("div",Ae,[a("button",{onClick:d=>D("minus",t.id,t.product_id,t.variant_id,t.quantity),class:"text-lg font-semibold text-gray-700 hover:text-yellow-600 transition-colors",disabled:t.quantity<=1,"aria-label":r(e)("cart.decreaseQuantity")}," - ",8,$e),a("span",je,o(t.quantity),1),a("button",{onClick:d=>D("plus",t.id,t.product_id,t.variant_id,t.quantity),class:"text-lg font-semibold text-gray-700 hover:text-yellow-600 transition-colors","aria-label":r(e)("cart.increaseQuantity")}," + ",8,De)]),a("button",{onClick:d=>I(t.id,t.product_id,t.variant_id),class:"text-white bg-yellow-600 px-3 py-1 text-sm rounded-md hover:bg-yellow-700 transition-all","aria-label":r(e)("cart.removeProductAria",{name:t.name})},o(r(e)("cart.remove")),9,Fe)])])]))),128)),(i(!0),n(C,null,E(g.value,t=>(i(),n("div",{key:t.store_id,class:"bg-gray-100 p-6 mt-6 rounded-lg shadow-inner"},[a("h3",Pe,o(r(e)("cart.orderFrom",{store:Q(t.store_id)})),1),t.delivery_message?(i(),n("div",Ne,o(t.delivery_message),1)):V("",!0),a("div",Te,[a("span",Ve,[a("h4",Me,o(r(e)("cart.shippingTime")),1),a("p",Be,o(t.time?`${t.time} ${r(e)("cart.hours")}`:r(e)("cart.notAvailable")),1)]),a("span",Le,[a("h4",Qe,o(r(e)("cart.subtotal")),1),a("p",Ue,o(t.order_without_tax)+" "+o(r(e)("cart.currency")),1)]),a("span",Ie,[a("h4",ze,o(r(e)("cart.tax")),1),a("p",We,o(t.order_tax)+" "+o(r(e)("cart.currency")),1)]),a("span",Ge,[a("h4",He,o(r(e)("cart.total")),1),a("p",Je,o(t.total)+" "+o(r(e)("cart.currency")),1)])]),a("button",{disabled:!u.value||m.value.length===0,onClick:F,class:"w-full mt-6 py-3 text-sm sm:text-base lg:text-lg bg-gray-800 rounded-md text-white font-semibold transition-transform duration-150 hover:shadow-lg active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed","aria-label":r(e)("cart.checkout")},o(r(e)("cart.checkout")),9,Ke)]))),128))]))]))]),a("section",Re,[a("h3",Xe,o(r(e)("cart.orderSummary")),1),a("div",Ye,[a("span",Ze,[a("h4",Oe,o(r(e)("cart.subtotal")),1),a("p",et,o(S.value.order_without_tax)+" "+o(r(e)("cart.currency")),1)]),a("span",tt,[a("h4",at,o(r(e)("cart.tax")),1),a("p",st,o(S.value.order_tax)+" "+o(r(e)("cart.currency")),1)]),a("span",rt,[a("h4",ot,o(r(e)("cart.total")),1),a("p",lt,o(S.value.total)+" "+o(r(e)("cart.currency")),1)])]),a("div",it,[M(a("input",{"onUpdate:modelValue":l[1]||(l[1]=t=>b.value=t),type:"text",placeholder:r(e)("cart.couponPlaceholder"),class:"bg-amber-50 placeholder-yellow-600 border border-amber-200 rounded-md w-full px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-600 transition-all","aria-label":r(e)("cart.couponPlaceholder")},null,8,nt),[[Z,b.value]]),a("button",{onClick:U,class:"w-full mt-4 py-2 text-sm bg-amber-100 rounded-md text-yellow-600 font-semibold hover:bg-amber-200 transition-all active:scale-95","aria-label":r(e)("cart.applyCoupon")},o(r(e)("cart.applyCoupon")),9,ct),a("button",{disabled:!u.value||m.value.length===0,onClick:F,class:"w-full mt-4 py-2 text-sm bg-gray-800 rounded-md text-white font-semibold hover:shadow-lg transition-all active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed","aria-label":r(e)("cart.checkout")},o(r(e)("cart.checkout")),9,dt)])])]),T(r(ee))],8,te))}},yt=H(ut,[["__scopeId","data-v-4c906c28"]]);export{yt as default};
