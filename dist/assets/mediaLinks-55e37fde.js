import{_ as P,k as Q,D as S,j,r as I,o as B,a3 as U,a as g,c as b,f as i,t as w,e as r,h as x,F as A,d as N,i as $,G as R,b as G,w as O,a1 as q,ag as z,T as H,ai as J}from"./index-88d813b9.js";const K={class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg"},W={class:"text-3xl font-bold text-center mb-8 text-gray-800"},X={key:0,class:"flex justify-center items-center h-64"},Y={key:1,class:"text-center text-gray-600"},Z={key:2,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"},ee={class:"relative group"},ae=["src","alt"],se={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 flex items-center justify-center transition-all duration-300 rounded-lg"},te=["href","aria-label"],le={class:"mt-2 text-center text-sm text-gray-600"},re={class:"mt-4"},oe={class:"block text-sm font-medium text-gray-700 mb-2"},ce={class:"mt-4"},ie={class:"block text-sm font-medium text-gray-700 mb-2"},ne={__name:"mediaLinks",setup(de){const h=Q(),u=S(),{t:e}=j(),m=I([]),k=I(!1),l=I({}),L=I(localStorage.getItem("appLang")||"en"),F=async()=>{var n,a;k.value=!0;const t=h.params.type==="1"?"store":h.params.type==="2"?"category":null,o=h.params.id;if(!t||!o){u.add({severity:"error",summary:e("error"),detail:e("invalidParams"),life:3e3}),k.value=!1;return}try{const s=await $.get(`/api/product/get/product/category?type=${t}&id=${o}`);if(s.data.is_success&&s.data.data.success)m.value=s.data.data.data||[],m.value.length===0?u.add({severity:"warn",summary:e("warning"),detail:e("noMediaFound"),life:3e3}):m.value.forEach(d=>{var _,E,f;l.value[d.id]={selectedType:((E=(_=d.media_links)==null?void 0:_.type)==null?void 0:E.toString())||h.params.type||"1",selectedIds:((f=d.media_links)==null?void 0:f.ids)||[],availableIds:[],searchQuery:""}});else throw new Error(s.data.message||e("mediaFetchError"))}catch(s){console.error("Error fetching media:",s),u.add({severity:"error",summary:e("error"),detail:((a=(n=s.response)==null?void 0:n.data)==null?void 0:a.message)||s.message||e("mediaFetchError"),life:3e3})}finally{k.value=!1}},T=async(t,o)=>{var n,a;try{const s=o==="1"?"product":"category",d=await $.get(`/api/${s}`,{params:{search:l.value[t].searchQuery||void 0}});let _=[];if(d.data.is_success)_=d.data.data.data||[],l.value[t].availableIds=_.map(c=>({label:L.value==="ar"?c.name_ar||c.name||`ID ${c.id}`:c.name_en||c.name||`ID ${c.id}`,value:c.id}));else throw new Error(d.data.message||e("idFetchError"));const f=l.value[t].selectedIds.filter(c=>!l.value[t].availableIds.some(p=>p.value===c));if(f.length>0){const c=[];for(const p of f)try{const v=await $.get(`/api/${s}`,{params:{search:p}});if(v.data.is_success&&v.data.data.data.length>0){const y=v.data.data.data[0];c.push({label:L.value==="ar"?y.name_ar||y.name||`ID ${y.id}`:y.name_en||y.name||`ID ${y.id}`,value:y.id})}}catch(v){console.warn(`Failed to fetch details for ID ${p}:`,v)}c.forEach(p=>{l.value[t].availableIds.some(v=>v.value===p.value)||l.value[t].availableIds.push(p)})}}catch(s){console.error("Error fetching IDs:",s),u.add({severity:"error",summary:e("error"),detail:((a=(n=s.response)==null?void 0:n.data)==null?void 0:a.message)||s.message||e("idFetchError"),life:3e3})}},V=(t,o)=>{l.value[o].searchQuery=t.value,T(o,l.value[o].selectedType)},C=async t=>{var n,a;const o=l.value[t];if(!o.selectedIds.length||!o.selectedType){u.add({severity:"error",summary:e("error"),detail:e("selectIdsAndType"),life:3e3});return}try{const s={media_id:t,type:parseInt(o.selectedType),ids:o.selectedIds},d=await $.post("/api/medialink",s);if(d.data.is_success)u.add({severity:"success",summary:e("success"),detail:e("mediaLinkCreated"),life:3e3}),l.value[t].selectedIds=[],l.value[t].searchQuery="",await T(t,o.selectedType);else throw new Error(d.data.message||e("mediaLinkError"))}catch(s){console.error("Error creating media link:",s),u.add({severity:"error",summary:e("error"),detail:((a=(n=s.response)==null?void 0:n.data)==null?void 0:a.message)||s.message||e("mediaLinkError"),life:3e3})}},D=async t=>{l.value[t].selectedIds=[],l.value[t].availableIds=[],l.value[t].searchQuery="",await T(t,l.value[t].selectedType)};B(async()=>{var t;await F();for(const o of m.value)await T(o.id,((t=l.value[o.id])==null?void 0:t.selectedType)||"1")});const M=[{label:e("product.mediaTitle"),value:"1"},{label:e("category.mediaTitle"),value:"2"}];return(t,o)=>{const n=U("Toast");return g(),b("div",K,[i("h1",W,w(r(h).params.type==="1"?r(e)("store.mediaTitle"):r(e)("category.mediaTitle")),1),k.value?(g(),b("div",X,[x(r(R),{style:{width:"50px",height:"50px"}})])):m.value.length===0?(g(),b("div",Y,w(r(e)("noMediaFound")),1)):(g(),b("div",Z,[(g(!0),b(A,null,N(m.value,a=>(g(),G(r(J),{key:a.id,class:"shadow-md hover:shadow-lg transition-shadow duration-300"},{content:O(()=>[i("div",ee,[i("img",{src:a.url,alt:a.name||`${r(h).params.type==="1"?r(e)("store.media"):r(e)("category.media")} ${a.id}`,class:"w-full h-[50px] object-cover rounded-lg"},null,8,ae),i("div",se,[i("a",{href:a.url,target:"_blank",class:"opacity-0 group-hover:opacity-100 bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition","aria-label":r(e)("viewMedia",{name:a.name||"Media "+a.id})},o[0]||(o[0]=[i("i",{class:"pi pi-link text-sm"},null,-1)]),8,te)])]),i("p",le,w(a.name||r(e)("mediaItem")),1),i("div",re,[i("label",oe,w(r(e)("selectType")),1),x(r(q),{modelValue:l.value[a.id].selectedType,"onUpdate:modelValue":s=>l.value[a.id].selectedType=s,options:M,optionLabel:"label",optionValue:"value",class:"w-full",onChange:s=>D(a.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),i("div",ce,[i("label",ie,w(l.value[a.id].selectedType==="1"?r(e)("selectProducts"):r(e)("selectCategories")),1),x(r(z),{modelValue:l.value[a.id].selectedIds,"onUpdate:modelValue":s=>l.value[a.id].selectedIds=s,options:l.value[a.id].availableIds||[],optionLabel:"label",optionValue:"value",placeholder:l.value[a.id].selectedType==="1"?r(e)("selectProducts"):r(e)("selectCategories"),class:"w-full",maxSelectedLabels:3,filter:"",filterPlaceholder:l.value[a.id].selectedType==="1"?r(e)("searchProducts"):r(e)("searchCategories"),onFilter:s=>V(s,a.id)},null,8,["modelValue","onUpdate:modelValue","options","placeholder","filterPlaceholder","onFilter"])]),x(r(H),{label:r(e)("linkMedia"),class:"mt-4 w-full",severity:"success",onClick:s=>C(a.id),disabled:!l.value[a.id].selectedIds.length},null,8,["label","onClick","disabled"])]),_:2},1024))),128))])),x(n)])}}},pe=P(ne,[["__scopeId","data-v-515c102c"]]);export{pe as default};
