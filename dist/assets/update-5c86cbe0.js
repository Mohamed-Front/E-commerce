import{u as ie,z as ne,f as de,G as ue,r as b,A as I,o as ce,h as y,i as pe,l as _e,b as f,c as h,j as t,t as i,B as l,q as v,e as n,F as q,v as E,n as me,D as S,s as be,k as ve,a as k}from"./index-2ff8cefd.js";const ge=["dir"],ye={class:"text-3xl font-bold text-center mb-8 text-gray-800"},fe=["onSubmit"],he={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},xe={class:"space-y-2"},Ve={for:"store_id",class:"block text-sm font-medium text-gray-700"},ke=t("span",{class:"text-red-500"},"*",-1),we={class:"space-y-2"},Ue={for:"category_id",class:"block text-sm font-medium text-gray-700"},De=t("span",{class:"text-red-500"},"*",-1),Le={class:"space-y-2"},Ce={for:"brand_id",class:"block text-sm font-medium text-gray-700"},Fe=t("span",{class:"text-red-500"},"*",-1),Ie={class:"space-y-2"},Se={for:"name_en",class:"block text-sm font-medium text-gray-700"},Te=t("span",{class:"text-red-500"},"*",-1),Be={class:"space-y-2"},Ne={for:"name_ar",class:"block text-sm font-medium text-gray-700"},je=t("span",{class:"text-red-500"},"*",-1),Ae={class:"space-y-2"},Pe={for:"sub_name_en",class:"block text-sm font-medium text-gray-700"},Re={class:"space-y-2"},qe={for:"sub_name_ar",class:"block text-sm font-medium text-gray-700"},Ee={class:"md:col-span-2 space-y-2"},ze={for:"description_en",class:"block text-sm font-medium text-gray-700"},Me={class:"md:col-span-2 space-y-2"},$e={for:"description_ar",class:"block text-sm font-medium text-gray-700"},Ge={class:"space-y-2"},Oe={for:"tax",class:"block text-sm font-medium text-gray-700"},Je={class:"space-y-2"},He={for:"is_displayed",class:"block text-sm font-medium text-gray-700"},Ke={class:"space-y-2"},Qe={for:"base_price",class:"block text-sm font-medium text-gray-700"},We=t("span",{class:"text-red-500"},"*",-1),Xe={class:"space-y-2"},Ye={for:"cost_price",class:"block text-sm font-medium text-gray-700"},Ze={class:"md:col-span-2 space-y-2"},et={for:"hasVariants",class:"ml-2 text-sm font-medium text-gray-700"},tt={key:1,class:"md:col-span-2 space-y-4"},at={class:"block text-sm font-medium text-gray-700"},st={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ot={class:"space-y-2"},lt=["for"],rt=t("span",{class:"text-red-500"},"*",-1),it={class:"space-y-2"},nt=["for"],dt=t("span",{class:"text-red-500"},"*",-1),ut={class:"space-y-2"},ct=["for"],pt=t("span",{class:"text-red-500"},"*",-1),_t={class:"space-y-2"},mt=["for"],bt={class:"space-y-2"},vt=["for"],gt=t("span",{class:"text-red-500"},"*",-1),yt={class:"md:col-span-2 space-y-2"},ft={class:"block text-sm font-medium text-gray-700"},ht={class:"flex justify-center"},xt=["onDragover","onDrop"],Vt={key:0,class:"p-4"},kt={class:"relative group"},wt=["src"],Ut={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 flex items-center justify-center transition-all duration-300 rounded-lg"},Dt={class:"opacity-0 group-hover:opacity-100 space-x-3 transition-all duration-300 transform translate-y-4 group-hover:translate-y-0"},Lt=["onClick","title"],Ct=t("i",{class:"pi pi-trash text-sm"},null,-1),Ft=[Ct],It=["title"],St=t("i",{class:"pi pi-pencil text-sm"},null,-1),Tt=[St],Bt={class:"mt-2 text-center text-sm text-gray-500"},Nt={key:1,class:"p-8 flex flex-col items-center justify-center"},jt=t("div",{class:"bg-blue-100 p-4 rounded-full mb-4"},[t("i",{class:"pi pi-image text-blue-500 text-2xl"})],-1),At={class:"text-sm text-center text-gray-600 mb-1"},Pt={class:"text-blue-500 font-medium"},Rt={class:"text-xs text-gray-400"},qt={class:"pt-4 flex justify-center space-x-4"},Et={key:0},zt={key:1,class:"pi pi-spinner pi-spin"},Gt={setup(Mt){const T=ie(),B=ne(),p=de(),{t:a}=ue();b();const V=b(!1),L=b(null),w=b(null),U=b(!1),N=b([]),j=b([]),A=b([]),P=b([]),m=b(!1),C=I(()=>localStorage.getItem("appLang")||"en"),D=I(()=>C.value==="en"?"name_en":"name_ar"),z=I(()=>C.value==="ar"),s=b({store_id:null,category_id:null,brand_id:null,name_en:"",name_ar:"",sub_name_en:"",sub_name_ar:"",description_en:"",description_ar:"",base_price:null,cost_price:null,tax:0,is_displayed:!0,variants:[]}),M=I(()=>P.value.map(r=>({label:C.value==="en"?r.name_en:r.name_ar,items:r.values.map(e=>({id:e.id,[D.value]:C.value==="en"?e.value_en:e.value_ar}))}))),$=async()=>{try{const e=(await k.get(`/api/product/${B.params.id}`)).data.data;s.value={store_id:e.store_id,category_id:e.category_id,brand_id:e.brand_id,name_en:e.name_en,name_ar:e.name_ar,sub_name_en:e.sub_name_en||"",sub_name_ar:e.sub_name_ar||"",description_en:e.description_en||"",description_ar:e.description_ar||"",base_price:e.base_price||null,cost_price:e.cost_price||null,tax:e.tax||0,is_displayed:e.is_displayed===1,variants:e.variants.map(d=>({id:d.id,sku_en:d.sku_en,sku_ar:d.sku_ar,price:d.price,cost_price:d.cost_price||null,attribute_value_ids:d.attribute_values.map(u=>u.id)}))||[]},m.value=e.has_variants,e.media&&e.media.length>0&&(w.value=e.media[0].url)}catch{p.add({severity:"error",summary:a("error"),detail:a("error.productLoad"),life:3e3})}},G=async()=>{try{const r=await k.get("/api/store");N.value=r.data.data.data}catch{p.add({severity:"error",summary:a("error"),detail:a("error.storeLoad"),life:3e3})}},O=async()=>{try{const r=await k.get("/api/category");j.value=r.data.data.data}catch{p.add({severity:"error",summary:a("error"),detail:a("error.categoryLoad"),life:3e3})}},J=async()=>{try{const r=await k.get("/api/brand");A.value=r.data.data.data}catch{p.add({severity:"error",summary:a("error"),detail:a("error.brandLoad"),life:3e3})}},H=async()=>{try{const r=await k.get("/api/product/create/data");P.value=r.data.data}catch{p.add({severity:"error",summary:a("error"),detail:a("error.attributeLoad"),life:3e3})}};ce(()=>{G(),O(),J(),H(),$()});const K=r=>{r.preventDefault(),U.value=!0},Q=()=>{U.value=!1},W=r=>{if(r.size>2*1024*1024){p.add({severity:"error",summary:a("error"),detail:a("validation.imageSize"),life:3e3});return}if(!r.type.match("image.*")){p.add({severity:"error",summary:a("error"),detail:a("validation.imageInvalid"),life:3e3});return}L.value=r;const e=new FileReader;e.onload=d=>{w.value=d.target.result},e.readAsDataURL(r),U.value=!1},R=r=>{var d,u,c;const e=((d=r.target.files)==null?void 0:d[0])||((c=(u=r.dataTransfer)==null?void 0:u.files)==null?void 0:c[0]);e&&W(e)},X=()=>{L.value=null,w.value=null},Y=()=>{m.value=!m.value,m.value&&!s.value.variants.length?s.value.variants.push({sku_ar:"",sku_en:"",price:"",cost_price:null,attribute_value_ids:[]}):m.value||(s.value.variants=[])},Z=()=>{s.value.variants.push({sku_ar:"",sku_en:"",price:"",cost_price:null,attribute_value_ids:[]})},ee=r=>{s.value.variants.length>1?s.value.variants.splice(r,1):p.add({severity:"warn",summary:a("error"),detail:a("validation.atLeastOneVariant"),life:3e3})},te=async()=>{var d,u;if(["store_id","category_id","brand_id","name_en","name_ar"].some(c=>!s.value[c])){p.add({severity:"error",summary:a("error"),detail:a("validation.requiredFields"),life:3e3});return}if(m.value){if(s.value.variants.some(c=>{var x;return!c.sku_en||!c.sku_ar||!c.price||!((x=c.attribute_value_ids)!=null&&x.length)})){p.add({severity:"error",summary:a("error"),detail:a("validation.variantRequiredFields"),life:3e3});return}}else if(!s.value.base_price){p.add({severity:"error",summary:a("error"),detail:a("validation.basePriceRequired"),life:3e3});return}V.value=!0;const e=new FormData;e.append("store_id",s.value.store_id),e.append("category_id",s.value.category_id),e.append("brand_id",s.value.brand_id),e.append("name_en",s.value.name_en),e.append("name_ar",s.value.name_ar),e.append("sub_name_en",s.value.sub_name_en||""),e.append("sub_name_ar",s.value.sub_name_ar||""),e.append("description_en",s.value.description_en||""),e.append("description_ar",s.value.description_ar||""),e.append("tax",s.value.tax),e.append("is_displayed",s.value.is_displayed?1:0),m.value?e.append("variants",JSON.stringify(s.value.variants)):(e.append("base_price",s.value.base_price),e.append("cost_price",s.value.cost_price||0)),L.value&&e.append("image",L.value);try{await k.post(`/api/product/${B.params.id}`,e),T.push({name:"product"}),p.add({severity:"success",summary:a("success"),detail:a("product.updateSuccess"),life:3e3})}catch(c){p.add({severity:"error",summary:a("error"),detail:((u=(d=c.response)==null?void 0:d.data)==null?void 0:u.message)||a("error.updateError"),life:3e3})}finally{V.value=!1}};return(r,e)=>{const d=y("Dropdown"),u=y("InputText"),c=y("Textarea"),x=y("InputNumber"),ae=y("InputSwitch"),se=y("Checkbox"),oe=y("MultiSelect"),F=y("Button"),le=y("Toast"),re=pe("can");return _e((f(),h("div",{class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg",dir:l(z)?"rtl":"ltr"},[t("h1",ye,i(l(a)("product.updateTitle")),1),t("form",{onSubmit:S(te,["prevent"]),class:"space-y-6"},[t("div",he,[t("div",xe,[t("label",Ve,[v(i(l(a)("product.store"))+" ",1),ke]),n(d,{id:"store_id",modelValue:s.value.store_id,"onUpdate:modelValue":e[0]||(e[0]=o=>s.value.store_id=o),options:N.value,optionLabel:l(D),optionValue:"id",class:"w-full"},null,8,["modelValue","options","optionLabel"])]),t("div",we,[t("label",Ue,[v(i(l(a)("product.category"))+" ",1),De]),n(d,{id:"category_id",modelValue:s.value.category_id,"onUpdate:modelValue":e[1]||(e[1]=o=>s.value.category_id=o),options:j.value,optionLabel:l(D),optionValue:"id",class:"w-full"},null,8,["modelValue","options","optionLabel"])]),t("div",Le,[t("label",Ce,[v(i(l(a)("product.brand"))+" ",1),Fe]),n(d,{id:"brand_id",modelValue:s.value.brand_id,"onUpdate:modelValue":e[2]||(e[2]=o=>s.value.brand_id=o),options:A.value,optionLabel:l(D),optionValue:"id",class:"w-full"},null,8,["modelValue","options","optionLabel"])]),t("div",Ie,[t("label",Se,[v(i(l(a)("product.nameEn"))+" ",1),Te]),n(u,{id:"name_en",modelValue:s.value.name_en,"onUpdate:modelValue":e[3]||(e[3]=o=>s.value.name_en=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"},null,8,["modelValue"])]),t("div",Be,[t("label",Ne,[v(i(l(a)("product.nameAr"))+" ",1),je]),n(u,{id:"name_ar",modelValue:s.value.name_ar,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.name_ar=o),dir:"rtl",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"},null,8,["modelValue"])]),t("div",Ae,[t("label",Pe,i(l(a)("product.subNameEn")),1),n(u,{id:"sub_name_en",modelValue:s.value.sub_name_en,"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.sub_name_en=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"},null,8,["modelValue"])]),t("div",Re,[t("label",qe,i(l(a)("product.subNameAr")),1),n(u,{id:"sub_name_ar",modelValue:s.value.sub_name_ar,"onUpdate:modelValue":e[6]||(e[6]=o=>s.value.sub_name_ar=o),dir:"rtl",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"},null,8,["modelValue"])]),t("div",Ee,[t("label",ze,i(l(a)("product.descriptionEn")),1),n(c,{id:"description_en",modelValue:s.value.description_en,"onUpdate:modelValue":e[7]||(e[7]=o=>s.value.description_en=o),rows:"4",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"},null,8,["modelValue"])]),t("div",Me,[t("label",$e,i(l(a)("product.descriptionAr")),1),n(c,{id:"description_ar",modelValue:s.value.description_ar,"onUpdate:modelValue":e[8]||(e[8]=o=>s.value.description_ar=o),rows:"4",dir:"rtl",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"},null,8,["modelValue"])]),t("div",Ge,[t("label",Oe,i(l(a)("product.tax"))+" (%) ",1),n(x,{id:"tax",modelValue:s.value.tax,"onUpdate:modelValue":e[9]||(e[9]=o=>s.value.tax=o),mode:"decimal",min:0,max:100,minFractionDigits:2,class:"w-full"},null,8,["modelValue"])]),t("div",Je,[t("label",He,i(l(a)("product.displayStatus")),1),n(ae,{id:"is_displayed",modelValue:s.value.is_displayed,"onUpdate:modelValue":e[10]||(e[10]=o=>s.value.is_displayed=o)},null,8,["modelValue"])]),m.value?E("",!0):(f(),h(q,{key:0},[t("div",Ke,[t("label",Qe,[v(i(l(a)("product.basePrice"))+" ",1),We]),n(x,{id:"base_price",modelValue:s.value.base_price,"onUpdate:modelValue":e[11]||(e[11]=o=>s.value.base_price=o),mode:"decimal",minFractionDigits:2,class:"w-full"},null,8,["modelValue"])]),t("div",Xe,[t("label",Ye,i(l(a)("product.costPrice")),1),n(x,{id:"cost_price",modelValue:s.value.cost_price,"onUpdate:modelValue":e[12]||(e[12]=o=>s.value.cost_price=o),mode:"decimal",minFractionDigits:2,class:"w-full"},null,8,["modelValue"])])],64)),t("div",Ze,[n(se,{modelValue:m.value,"onUpdate:modelValue":e[13]||(e[13]=o=>m.value=o),inputId:"hasVariants",binary:!0,onClick:Y},null,8,["modelValue"]),t("label",et,i(l(a)("product.hasVariants")),1)]),m.value?(f(),h("div",tt,[t("label",at,i(l(a)("product.variants")),1),(f(!0),h(q,null,me(s.value.variants,(o,_)=>(f(),h("div",{key:_,class:"p-4 border rounded-lg space-y-4"},[t("div",st,[t("div",ot,[t("label",{for:"sku_en_"+_,class:"block text-sm font-medium text-gray-700"},[v(i(l(a)("product.skuEn"))+" ",1),rt],8,lt),n(u,{id:"sku_en_"+_,modelValue:o.sku_en,"onUpdate:modelValue":g=>o.sku_en=g,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"},null,8,["id","modelValue","onUpdate:modelValue"])]),t("div",it,[t("label",{for:"sku_ar_"+_,class:"block text-sm font-medium text-gray-700"},[v(i(l(a)("product.skuAr"))+" ",1),dt],8,nt),n(u,{id:"sku_ar_"+_,modelValue:o.sku_ar,"onUpdate:modelValue":g=>o.sku_ar=g,dir:"rtl",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"},null,8,["id","modelValue","onUpdate:modelValue"])]),t("div",ut,[t("label",{for:"price_"+_,class:"block text-sm font-medium text-gray-700"},[v(i(l(a)("product.price"))+" ",1),pt],8,ct),n(x,{id:"price_"+_,modelValue:o.price,"onUpdate:modelValue":g=>o.price=g,mode:"decimal",minFractionDigits:2,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])]),t("div",_t,[t("label",{for:"cost_price_"+_,class:"block text-sm font-medium text-gray-700"},i(l(a)("product.costPrice")),9,mt),n(x,{id:"cost_price_"+_,modelValue:o.cost_price,"onUpdate:modelValue":g=>o.cost_price=g,mode:"decimal",minFractionDigits:2,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])]),t("div",bt,[t("label",{for:"attributes_"+_,class:"block text-sm font-medium text-gray-700"},[v(i(l(a)("product.attributes"))+" ",1),gt],8,vt),n(oe,{id:"attributes_"+_,modelValue:o.attribute_value_ids,"onUpdate:modelValue":g=>o.attribute_value_ids=g,options:l(M),optionGroupLabel:"label",optionGroupChildren:"items",optionLabel:l(D),optionValue:"id",class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue","options","optionLabel"])])]),n(F,{type:"button",icon:"pi pi-trash",class:"p-button-danger",onClick:g=>ee(_),disabled:s.value.variants.length===1},null,8,["onClick","disabled"])]))),128)),n(F,{type:"button",label:l(a)("product.addVariant"),icon:"pi pi-plus",class:"p-button-secondary",onClick:Z},null,8,["label"])])):E("",!0),t("div",yt,[t("label",ft,i(l(a)("product.image")),1),t("div",ht,[t("label",{onDragover:S(K,["prevent"]),onDragleave:Q,onDrop:S(R,["prevent"]),class:be([{"border-blue-500 bg-blue-50":U.value,"border-gray-300":!U.value},"cursor-pointer w-full max-w-md rounded-xl border-2 border-dashed transition-colors duration-300"])},[t("input",{type:"file",onChange:R,accept:"image/*",class:"hidden"},null,32),w.value?(f(),h("div",Vt,[t("div",kt,[t("img",{src:w.value,alt:"Preview",class:"w-full h-64 object-contain rounded-lg shadow-md transition-transform duration-300 group-hover:scale-105"},null,8,wt),t("div",Ut,[t("div",Dt,[t("button",{type:"button",onClick:S(X,["stop"]),class:"bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition",title:l(a)("product.deleteImage")},Ft,8,Lt),t("button",{type:"button",class:"bg-white text-gray-700 p-2 rounded-full hover:bg-gray-100 transition",title:l(a)("product.editImage")},Tt,8,It)])])]),t("p",Bt,i(l(a)("product.changeImage")),1)])):(f(),h("div",Nt,[jt,t("p",At,[t("span",Pt,i(l(a)("product.uploadClick")),1),v(" "+i(l(a)("product.uploadDrag")),1)]),t("p",Rt,i(l(a)("product.imageFormat")),1)]))],42,xt)])])]),t("div",qt,[n(F,{type:"button",label:l(a)("product.cancelButton"),icon:"pi pi-times",onClick:e[14]||(e[14]=o=>l(T).go(-1)),class:"px-6 py-3 mx-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:V.value},null,8,["label","disabled"]),n(F,{type:"submit",label:l(a)("product.updateButton"),icon:"pi pi-check",loading:V.value,class:"px-8 mx-2 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:V.value},{default:ve(()=>[V.value?(f(),h("i",zt)):(f(),h("span",Et,i(l(a)("product.updateButton")),1))]),_:1},8,["label","loading","disabled"])])],40,fe),n(le)],8,ge)),[[re,"update product inventories"]])}}};export{Gt as default};
