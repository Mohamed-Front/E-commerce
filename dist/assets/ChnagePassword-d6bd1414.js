import{j as M,u as A,k as U,q as z,r as v,n as E,o as F,a as i,c as d,f as a,p as K,t as r,e,x as m,F as _,d as R,g as k,B as V,C as P,D as $,V as L}from"./index-46c13c1b.js";const N={class:"bg-gray-900 min-h-screen flex items-start justify-center p-4 overflow-hidden"},q={class:"bg-white rounded-3xl shadow-2xl p-6 w-full max-w-sm sm:max-w-lg my-8 text-center"},Z={class:"space-y-6"},H={key:0},G={class:"text-2xl font-bold text-gray-800"},J={class:"text-sm text-gray-500 my-3"},Q=["onUpdate:modelValue","onInput","onKeydown","aria-label"],W=["disabled","aria-label"],X={class:"text-center text-sm text-gray-500 mt-4"},Y=["disabled","aria-label"],ee={key:1,class:"text-green-500 text-sm text-center mt-2"},se={key:1},te={class:"text-2xl font-bold text-gray-800"},ae={class:"text-sm text-gray-500"},oe={class:"space-y-4"},le=["placeholder","aria-label"],re=["placeholder","aria-label"],ne=["disabled","aria-label"],ie={class:"text-center text-sm text-gray-500 mt-4"},de=["aria-label"],pe={__name:"ChnagePassword",props:{email:String,phone:String,otp_type:String},setup(S){const{t,locale:ue}=M(),C=A();U();const u=z(),c=v(["","","","","",""]),b=v([]),y=v(!1),f=v(""),x=v(""),p=v([]),g=v([]),n=S;E(y,s=>{s&&(console.log("OTP verification successful, isOtpVerified is now true"),p.value=[],c.value=["","","","","",""])}),F(()=>{if(!n.email&&!n.phone){g.value=[t("passwordReset.invalidInfo")],C.push({name:"authlog"});return}console.log("Change Password Page Props:",{email:n.email,phone:n.phone,otp_type:n.otp_type}),b.value.length>0&&b.value[0].focus()});const I=(s,o)=>{const l=o.target.value.replace(/[^0-9]/g,"");c.value[s]=l.slice(0,1),l&&s<c.value.length-1&&b.value[s+1].focus()},j=s=>{s>0&&c.value[s]===""&&b.value[s-1].focus()},D=async()=>{p.value=[];const s=c.value.join("");if(s.length!==6||!/^\d{6}$/.test(s)){p.value=[t("passwordReset.invalidOtp")];return}const o=await u.verifyOtp({email:n.email,phone:n.phone,otp:s});o.is_success?y.value=!0:p.value=o.errors},O=async()=>{p.value=[];const s=await u.resendOtp({email:n.email,phone:n.phone,otp_type:n.otp_type});s.is_success||(p.value=s.errors)},T=async()=>{g.value=[];const s=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;if(!f.value||!s.test(f.value)){g.value=[t("passwordReset.passwordRequirements")];return}if(f.value!==x.value){g.value=[t("passwordReset.passwordMismatch")];return}const o=await u.completePasswordReset({email:n.email,phone:n.phone,otp:c.value.join(""),password:f.value});o.is_success||(g.value=o.errors)},B=()=>{C.push({name:"authlog"})};return(s,o)=>(i(),d("div",N,[a("div",q,[o[2]||(o[2]=a("div",{class:"flex flex-col items-center mb-8"},[a("img",{src:K,alt:"SHIFT7 Logo",class:"h-16 w-16 object-contain"})],-1)),a("div",Z,[y.value?(i(),d("div",se,[a("h2",te,r(e(t)("passwordReset.resetTitle")),1),a("p",ae,r(e(t)("passwordReset.resetDescription")),1),a("div",oe,[P(a("input",{type:"password","onUpdate:modelValue":o[0]||(o[0]=l=>f.value=l),placeholder:e(t)("passwordReset.newPasswordPlaceholder"),"aria-label":e(t)("passwordReset.newPassword"),"aria-describedby":"password-error",class:m(["w-full px-4 py-3 rounded-xl bg-gray-100 placeholder-gray-400 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow",{"text-right":s.$i18n.locale==="ar","text-left":s.$i18n.locale!=="ar"}])},null,10,le),[[$,f.value]]),P(a("input",{type:"password","onUpdate:modelValue":o[1]||(o[1]=l=>x.value=l),placeholder:e(t)("passwordReset.confirmPasswordPlaceholder"),"aria-label":e(t)("passwordReset.confirmPassword"),"aria-describedby":"password-error",class:m(["w-full px-4 py-3 rounded-xl bg-gray-100 placeholder-gray-400 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow",{"text-right":s.$i18n.locale==="ar","text-left":s.$i18n.locale!=="ar"}])},null,10,re),[[$,x.value]]),g.value.length?(i(),d("div",{key:0,id:"password-error",class:m(["text-red-500 text-sm",{"text-right":s.$i18n.locale==="ar","text-left":s.$i18n.locale!=="ar"}])},[(i(!0),d(_,null,R(g.value,l=>(i(),d("p",{key:l},r(l),1))),128))],2)):k("",!0)]),a("button",{onClick:T,disabled:e(u).loading,class:"w-full mt-6 py-3 bg-blue-700 text-white font-bold rounded-xl shadow-lg hover:bg-blue-800 transition-colors duration-300 disabled:bg-gray-400","aria-label":e(t)("passwordReset.submit")},r(e(u).loading?e(t)("passwordReset.resetting"):e(t)("passwordReset.submit")),9,ne)])):(i(),d("div",H,[a("h2",G,r(e(t)("passwordReset.title")),1),a("p",J,r(e(t)("passwordReset.otpSent")),1),a("div",{class:m(["flex justify-center space-x-2",{"space-x-reverse":s.$i18n.locale==="ar"}])},[(i(!0),d(_,null,R(c.value,(l,h)=>P((i(),d("input",{key:h,type:"text",maxlength:"1",pattern:"[0-9]",class:"w-12 h-12 text-center text-xl font-bold rounded-xl bg-gray-100 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow","onUpdate:modelValue":w=>c.value[h]=w,onInput:w=>I(h,w),onKeydown:L(w=>j(h),["backspace"]),ref_for:!0,ref:w=>{w&&(b.value[h]=w)},"aria-label":e(t)("passwordReset.otpDigit",{number:h+1})},null,40,Q)),[[$,c.value[h]]])),128))],2),p.value.length?(i(),d("div",{key:0,class:m(["text-red-500 text-sm",{"text-right":s.$i18n.locale==="ar","text-left":s.$i18n.locale!=="ar"}])},[(i(!0),d(_,null,R(p.value,l=>(i(),d("p",{key:l},r(l),1))),128))],2)):k("",!0),a("button",{onClick:D,disabled:e(u).loading,class:"w-full mt-6 py-3 bg-blue-700 text-white font-bold rounded-xl shadow-lg hover:bg-blue-800 transition-colors duration-300 disabled:bg-gray-400","aria-label":e(t)("passwordReset.verify")},r(e(u).loading?e(t)("passwordReset.verifying"):e(t)("passwordReset.verify")),9,W),a("div",X,[V(r(e(t)("passwordReset.noCode"))+" ",1),a("button",{onClick:O,disabled:e(u).loading,class:"text-blue-600 font-semibold hover:underline","aria-label":e(t)("passwordReset.resend")},r(e(u).loading?e(t)("passwordReset.resending"):e(t)("passwordReset.resend")),9,Y)]),e(u).successMsg?(i(),d("div",ee,r(e(u).successMsg),1)):k("",!0)])),a("div",ie,[V(r(e(t)("passwordReset.hasAccount"))+" ",1),a("a",{onClick:B,class:"text-blue-600 cursor-pointer font-semibold hover:underline","aria-label":e(t)("passwordReset.login")},r(e(t)("passwordReset.login")),9,de)])])])]))}};export{pe as default};
