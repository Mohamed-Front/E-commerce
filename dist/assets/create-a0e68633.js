import{_ as S,l as g,u as Y,G as C,j as z,r as n,o as A,q as E,R as N,z as b,a as m,c as y,f as r,t as d,e as l,B as L,p as V,h as c,y as w,g as k,D as O,i as T,a2 as G,T as Q,ag as H,U as q,Q as J}from"./index-03d5a370.js";import{h as K}from"./moment-fbc5633a.js";const W=["dir"],X={class:"text-3xl font-bold text-center mb-8 text-gray-800"},Z={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ee={class:"space-y-2"},te={for:"product_id",class:"block text-sm font-medium text-gray-700"},se={key:0,class:"p-error"},ae={class:"space-y-2"},le={for:"discount_value",class:"block text-sm font-medium text-gray-700"},oe={key:0,class:"p-error"},re={class:"space-y-2"},ie={for:"expires_at",class:"block text-sm font-medium text-gray-700"},ue={key:0,class:"p-error"},de={class:"pt-4 flex justify-center space-x-4"},ne={__name:"create",setup(ce){const f=g(()=>localStorage.getItem("appLang")||"en"),P=g(()=>f.value==="en"?"name_en":"name_ar"),U=g(()=>f.value==="ar"),D=Y(),v=C(),{t}=z(),_=n(!1),u=n({}),a=n({type:"product",products:null,discount_type:1,discount_value:null,expires_at:null}),F=n([]),x=n(""),h=n(!1),j=(i,e)=>{let o;return(...s)=>{clearTimeout(o),o=setTimeout(()=>i(...s),e)}},$=async()=>{h.value=!0;try{const{data:i}=await T.get("/api/product",{params:{...x.value?{search:x.value}:{}}});F.value=i.data.data??[]}catch(i){console.error(i),v.add({severity:"error",summary:t("error"),detail:t("error.productLoad"),life:3e3})}finally{h.value=!1}},M=j($,300),R=i=>{x.value=i.value??"",M()};A(()=>{$()}),E(f,()=>{});class B{constructor(e,o){this.errors=e,this.t=o}required(e,o){return e==null||Array.isArray(e)&&e.length===0?(this.errors.value[o]=this.t("validation.requiredFields",{field:this.t(`discount.${o}`)}),!1):!0}numericRange(e,o,s,p){return e==null||isNaN(e)?(this.errors.value[o]=this.t("validation.requiredFields",{field:this.t(`discount.${o}`)}),!1):s!==null&&e<s?(this.errors.value[o]=this.t("validation.minValue",{field:this.t(`discount.${o}`),min:s}),!1):!0}isValid(){return Object.keys(this.errors.value).length===0}}const I=async()=>{var o,s;u.value={};const i=new B(u,t);if(i.required(a.value.products,"select_product"),i.numericRange(a.value.discount_value,"discount_value",0,null),i.required(a.value.expires_at,"expiration_date"),!i.isValid()){const p=Object.values(u.value).join(", ");v.add({severity:"error",summary:t("error"),detail:p,life:3e3});return}_.value=!0;const e={type:a.value.type,ids:[a.value.products],discount_type:a.value.discount_type,discount_value:a.value.discount_value,expires_at:K(a.value.expires_at).format("YYYY-MM-DD")};try{await T.post("/api/discount",e),v.add({severity:"success",summary:t("success"),detail:t("discount.created_successfully"),life:3e3}),D.push({name:"discount"})}catch(p){console.error(p),v.add({severity:"error",summary:t("error"),detail:((s=(o=p.response)==null?void 0:o.data)==null?void 0:s.message)||t("error.createError"),life:3e3})}finally{_.value=!1}};return(i,e)=>{const o=N("can");return b((m(),y("div",{class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg",dir:U.value?"rtl":"ltr"},[r("h1",X,d(l(t)("discount.create_new_discount")),1),r("form",{onSubmit:O(I,["prevent"]),class:"space-y-6"},[b(r("input",{type:"hidden","onUpdate:modelValue":e[0]||(e[0]=s=>a.value.type=s)},null,512),[[L,a.value.type]]),b(r("input",{type:"hidden","onUpdate:modelValue":e[1]||(e[1]=s=>a.value.discount_type=s)},null,512),[[L,a.value.discount_type]]),r("div",Z,[r("div",ee,[r("label",te,[V(d(l(t)("discount.select_product"))+" ",1),e[6]||(e[6]=r("span",{class:"text-red-500"},"*",-1))]),c(l(G),{id:"product_id",modelValue:a.value.products,"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.products=s),options:F.value,optionLabel:P.value,optionValue:"id",filter:"",filterPlaceholder:l(t)("discount.searchProducts"),placeholder:l(t)("discount.searchProducts"),loading:h.value,class:w(["w-full",{"p-invalid":u.value.select_product}]),onFilter:R},null,8,["modelValue","options","optionLabel","filterPlaceholder","placeholder","loading","class"]),u.value.select_product?(m(),y("small",se,d(u.value.select_product),1)):k("",!0)]),r("div",ae,[r("label",le,[V(d(l(t)("discount.discount_value"))+" ("+d(l(t)("discount.fixed_amount"))+") ",1),e[7]||(e[7]=r("span",{class:"text-red-500"},"*",-1))]),c(l(Q),{id:"discount_value",modelValue:a.value.discount_value,"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.discount_value=s),min:0,mode:"decimal",placeholder:l(t)("discount.enter_discount_value"),class:w(["w-full",{"p-invalid":u.value.discount_value}])},null,8,["modelValue","placeholder","class"]),u.value.discount_value?(m(),y("small",oe,d(u.value.discount_value),1)):k("",!0)]),r("div",re,[r("label",ie,[V(d(l(t)("discount.expiration_date"))+" ",1),e[8]||(e[8]=r("span",{class:"text-red-500"},"*",-1))]),c(l(H),{id:"expires_at",modelValue:a.value.expires_at,"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.expires_at=s),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:l(t)("discount.select_expiration_date"),class:w(["w-full",{"p-invalid":u.value.expiration_date}]),showIcon:""},null,8,["modelValue","minDate","placeholder","class"]),u.value.expiration_date?(m(),y("small",ue,d(u.value.expiration_date),1)):k("",!0)])]),r("div",de,[c(l(q),{type:"button",label:l(t)("discount.cancel"),icon:"pi pi-times",onClick:e[5]||(e[5]=s=>l(D).go(-1)),class:"px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg shadow-md",disabled:_.value},null,8,["label","disabled"]),c(l(q),{type:"submit",label:l(t)("discount.create_discount"),icon:"pi pi-plus",loading:_.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md"},null,8,["label","loading"])])],32),c(l(J))],8,W)),[[o,"create discounts"]])}}},_e=S(ne,[["__scopeId","data-v-46870c3e"]]);export{_e as default};
