import{_ as M,j as z,r as y,H as A,o as D,a as c,c as u,f as t,I as C,R as I,F,d as q,v as j,t as o,J as O,h as T,e as H,i as m,K as N}from"./index-17abdb7f.js";const S="/assets/prand 1-7db5856b.png";const U={class:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 font-inter"},J={class:"flex lg:flex-row flex-col gap-10"},K={class:"flex-1 bg-white rounded-2xl shadow-lg p-6"},L={key:0,class:"flex justify-center items-center py-4"},P={key:1},Q={class:"mb-6"},R=["value"],G={class:"flex items-center gap-4 mb-6"},W={key:0,class:"text-center text-gray-600 py-4"},X=["src","alt"],Y={class:"flex flex-col mx-4 gap-2 flex-1"},Z={class:"text-lg font-bold text-gray-800"},ee={class:"text-yellow-600 text-sm"},te={class:"flex items-center justify-between"},se={class:"text-yellow-600 text-sm"},ae={class:"border border-gray-300 p-2 rounded-md flex items-center gap-3"},oe=["onClick"],le={class:"text-sm font-medium"},re=["onClick"],ie=["onClick"],ne={class:"bg-gray-100 p-6 mt-6 rounded-lg shadow-inner"},de={class:"flex flex-col gap-4"},ce={class:"flex justify-between items-center"},ue={class:"text-gray-700"},ye={class:"flex justify-between items-center"},me={class:"text-gray-700"},_e={class:"flex justify-between items-center"},pe={class:"text-gray-700"},ve={class:"flex justify-between items-center"},fe={class:"text-gray-700"},xe=["disabled"],ge={class:"lg:w-1/4 w-full p-6 bg-white rounded-2xl shadow-lg"},we={class:"flex flex-col gap-4"},be={class:"flex justify-between items-center"},he={class:"text-gray-700"},ke={class:"flex justify-between items-center"},Ce={class:"text-gray-700"},Fe={class:"flex justify-between items-center"},qe={class:"text-gray-700"},je={class:"flex flex-col mt-6"},Ee=["disabled"],$e={__name:"cart",setup(Ve){z();const _=y(""),r=y([]),g=y(!0),l=A(),v=y([]),d=y(null),p=y(!1),i=y({delivery:0,time:0,coupon:0,order_tax:0,order_without_tax:0,total:0}),E=async()=>{try{const a=await m.get("/api/address");a.data.is_success&&(v.value=a.data.data.data,v.value.length>0&&(d.value=v.value[0].id))}catch(a){l.add({severity:"error",summary:"خطأ",detail:"فشل تحميل العناوين",life:3e3}),console.error("Error fetching addresses:",a)}},$=async()=>{try{g.value=!0;const a=await m.get("/api/cart");a.data.is_success&&(r.value=a.data.data.items.map(e=>({id:e.id,product_id:e.product_id,variant_id:e.variant_id,name:e.product.name_ar||e.product.name_en,img:e.product.media&&e.product.media.length>0?e.product.media[0].url:e.product.key_default_image||S,price:e.variant&&e.variant.price?parseFloat(e.variant.price).toFixed(2):parseFloat(e.product.base_price).toFixed(2)||0,quantity:e.quantity})),await f())}catch(a){l.add({severity:"error",summary:"خطأ",detail:"فشل تحميل بيانات سلة التسوق",life:3e3}),console.error("Error fetching cart:",a)}finally{g.value=!1}},f=async()=>{try{const a={is_expressed:p.value,address_id:d.value,view:!0,items:r.value.map(s=>({product_id:s.product_id,variant_id:s.variant_id,quantity:s.quantity}))};_.value&&(a.coupon=_.value);const e=await m.post("/api/order/view",a);e.data.is_success&&(i.value={delivery:parseFloat(e.data.data.delivery||0).toFixed(2),time:e.data.data.time||0,coupon:parseFloat(e.data.data.coupon||0).toFixed(2),order_tax:parseFloat(e.data.data.order_tax||0).toFixed(2),order_without_tax:parseFloat(e.data.data.order_without_tax||0).toFixed(2),total:parseFloat(e.data.data.total||0).toFixed(2)})}catch(a){l.add({severity:"error",summary:"خطأ",detail:"فشل تحميل إجمالي الطلب",life:3e3}),console.error("Error fetching order totals:",a)}},V=async()=>{try{await f(),l.add({severity:"success",summary:"نجاح",detail:"تم تطبيق كود الخصم",life:3e3})}catch(a){l.add({severity:"error",summary:"خطأ",detail:"فشل تطبيق كود الخصم",life:3e3}),console.error("Error applying coupon:",a)}},b=async(a,e,s,n,k)=>{const x=r.value.find(w=>w.id===e);if(x)try{a==="plus"?(await m.post("/api/cart/update",{product_id:s,variant_id:n,quantity:k+1}),x.quantity+=1):a==="minus"&&x.quantity>1&&(await m.post("/api/cart/update",{product_id:s,variant_id:n,quantity:k-1}),x.quantity-=1),await f()}catch(w){l.add({severity:"error",summary:"خطأ",detail:`فشل ${a==="plus"?"زيادة":"تقليل"} الكمية`,life:3e3}),console.error(`Error ${a==="plus"?"increasing":"decreasing"} quantity:`,w)}},B=async(a,e,s)=>{try{await m.delete("/api/cart/clear",{data:{product_id:e,variant_id:s}}),r.value=r.value.filter(n=>n.id!==a),await f(),l.add({severity:"success",summary:"نجاح",detail:"تم إزالة المنتج من السلة",life:3e3})}catch(n){l.add({severity:"error",summary:"خطأ",detail:"فشل إزالة المنتج من السلة",life:3e3}),console.error("Error clearing product:",n)}},h=async()=>{if(!d.value){l.add({severity:"error",summary:"خطأ",detail:"يرجى اختيار عنوان للتوصيل",life:3e3});return}try{const a={is_expressed:p.value,address_id:d.value,items:r.value.map(s=>({product_id:s.product_id,variant_id:s.variant_id,quantity:s.quantity}))};if(_.value&&(a.coupon=_.value),(await m.post("/api/order",a)).data.is_success)r.value=[],i.value={delivery:0,time:0,coupon:0,order_tax:0,order_without_tax:0,total:0},l.add({severity:"success",summary:"نجاح",detail:"تم إرسال الطلب بنجاح",life:3e3});else throw new Error("Order submission failed")}catch(a){l.add({severity:"error",summary:"خطأ",detail:"فشل إرسال الطلب",life:3e3}),console.error("Error submitting order:",a)}};return D(()=>{E(),$()}),(a,e)=>(c(),u("div",U,[t("div",J,[t("section",K,[g.value?(c(),u("div",L,e[3]||(e[3]=[t("svg",{class:"animate-spin h-8 w-8 text-yellow-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):(c(),u("div",P,[t("div",Q,[e[5]||(e[5]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-2"},"اختر عنوان التوصيل",-1)),C(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s),class:"w-full bg-amber-50 border border-amber-200 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-600 transition-all"},[e[4]||(e[4]=t("option",{value:null,disabled:""},"اختر عنوان",-1)),(c(!0),u(F,null,q(v.value,s=>(c(),u("option",{key:s.id,value:s.id},o(s.name)+" - "+o(s.street)+", "+o(s.city),9,R))),128))],512),[[I,d.value]])]),t("div",G,[e[6]||(e[6]=t("label",{class:"text-gray-800 font-medium"},"توصيل سريع",-1)),t("button",{onClick:e[1]||(e[1]=s=>p.value=!p.value),class:j(["relative inline-flex items-center h-6 rounded-full w-11 transition-colors duration-200",p.value?"bg-yellow-600":"bg-gray-300"]),style:{direction:"ltr"}},[t("span",{class:j(["inline-block w-4 h-4 transform bg-white rounded-full transition-transform duration-200",p.value?"translate-x-6":"translate-x-1"])},null,2)],2)]),r.value.length===0?(c(),u("div",W," سلة التسوق فارغة ")):(c(!0),u(F,{key:1},q(r.value,s=>(c(),u("div",{key:s.id,class:"flex items-center mt-6 bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300"},[t("img",{src:s.img,alt:s.name,class:"w-16 h-16 md:w-20 md:h-20 lg:w-28 lg:h-28 object-cover rounded-md border border-gray-800"},null,8,X),t("div",Y,[t("h3",Z,o(s.name),1),t("p",ee,"السعر: "+o(s.price)+" د.أ",1),t("div",te,[t("p",se,"الكمية: "+o(s.quantity),1),t("div",ae,[t("button",{onClick:n=>b("minus",s.id,s.product_id,s.variant_id,s.quantity),class:"text-lg font-semibold text-gray-700 hover:text-yellow-600 transition-colors"},"-",8,oe),t("span",le,o(s.quantity),1),t("button",{onClick:n=>b("plus",s.id,s.product_id,s.variant_id,s.quantity),class:"text-lg font-semibold text-gray-700 hover:text-yellow-600 transition-colors"},"+",8,re)]),t("button",{onClick:n=>B(s.id,s.product_id,s.variant_id),class:"text-white bg-yellow-600 px-3 py-1 text-sm rounded-md hover:bg-yellow-700 transition-all"},o(a.$t("remove")),9,ie)])])]))),128)),t("div",ne,[t("div",de,[t("span",ce,[e[7]||(e[7]=t("h4",{class:"text-yellow-600 font-semibold"},"مدة الشحن",-1)),t("p",ue,o(i.value.time)+" ساعات",1)]),t("span",ye,[e[8]||(e[8]=t("h4",{class:"text-yellow-600 font-semibold"},"المجموع الفرعي",-1)),t("p",me,o(i.value.order_without_tax)+" د.أ",1)]),t("span",_e,[e[9]||(e[9]=t("h4",{class:"text-yellow-600 font-semibold"},"الضريبة",-1)),t("p",pe,o(i.value.order_tax)+" د.أ",1)]),t("span",ve,[e[10]||(e[10]=t("h4",{class:"text-yellow-600 font-semibold"},"الإجمالي",-1)),t("p",fe,o(i.value.total)+" د.أ",1)])]),t("button",{disabled:!d.value,onClick:h,class:"w-full mt-6 py-3 text-sm sm:text-base lg:text-lg bg-gray-800 rounded-md text-white font-semibold transition-transform duration-150 hover:shadow-lg active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed"}," إتمام الشراء ",8,xe)])]))]),t("section",ge,[t("div",we,[t("span",be,[e[11]||(e[11]=t("h4",{class:"text-yellow-600 font-semibold"},"المجموع الفرعي",-1)),t("p",he,o(i.value.order_without_tax)+" د.أ",1)]),t("span",ke,[e[12]||(e[12]=t("h4",{class:"text-yellow-600 font-semibold"},"الضريبة",-1)),t("p",Ce,o(i.value.order_tax)+" د.أ",1)]),t("span",Fe,[e[13]||(e[13]=t("h4",{class:"text-yellow-600 font-semibold"},"الإجمالي",-1)),t("p",qe,o(i.value.total)+" د.أ",1)])]),t("div",je,[C(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>_.value=s),type:"text",placeholder:"كود الخصم",class:"bg-amber-50 placeholder-yellow-600 border border-amber-200 rounded-md w-full px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-600 transition-all"},null,512),[[O,_.value]]),t("button",{onClick:V,class:"w-full mt-4 py-2 text-sm bg-amber-100 rounded-md text-yellow-600 font-semibold hover:bg-amber-200 transition-all active:scale-95"}," تطبيق "),t("button",{disabled:!d.value,onClick:h,class:"w-full mt-4 py-2 text-sm bg-gray-800 rounded-md text-white font-semibold hover:shadow-lg transition-all active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed"}," إتمام الشراء الكلي ",8,Ee)])])]),T(H(N))]))}},Me=M($e,[["__scopeId","data-v-c519f877"]]);export{Me as default};
