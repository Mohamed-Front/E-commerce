import{_ as ae,I as D,n as le,b as de,L as re,u as ue,r as y,w as I,d as ie,y as v,o as i,e as n,f as s,t as a,g as p,i as z,P as ne,F as ce,a as g,s as f,B as _,j as C,p as pe,m as _e}from"./index-b794012a.js";import{h as me}from"./moment-fbc5633a.js";const b=w=>(pe("data-v-2482b882"),w=w(),_e(),w),ye={class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg"},ve={class:"text-3xl font-bold text-center mb-8 text-gray-800"},ge={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},fe={class:"space-y-2"},be={for:"model_type",class:"block text-sm font-medium text-gray-700"},he=b(()=>s("span",{class:"text-red-500"},"*",-1)),xe={key:0,class:"text-red-500 text-xs"},we={class:"space-y-2"},Ve={for:"model_ids",class:"block text-sm font-medium text-gray-700"},$e=b(()=>s("span",{class:"text-red-500"},"*",-1)),ke={key:0,class:"text-red-500 text-xs"},De={key:0,class:"space-y-2"},Ie={for:"product_id",class:"block text-sm font-medium text-gray-700"},Ce=b(()=>s("span",{class:"text-red-500"},"*",-1)),Se={key:0,class:"text-red-500 text-xs"},Fe={class:"space-y-2"},Ue={for:"discount_type",class:"block text-sm font-medium text-gray-700"},Ee=b(()=>s("span",{class:"text-red-500"},"*",-1)),Le={key:0,class:"text-red-500 text-xs"},qe={class:"space-y-2"},Be={for:"discount_value",class:"block text-sm font-medium text-gray-700"},Me=b(()=>s("span",{class:"text-red-500"},"*",-1)),Ne={key:0,class:"text-gray-500 text-xs"},je={key:1,class:"text-red-500 text-xs"},Ae={class:"space-y-2"},Pe={for:"expires_at",class:"block text-sm font-medium text-gray-700"},Te=b(()=>s("span",{class:"text-red-500"},"*",-1)),Ye={key:0,class:"text-red-500 text-xs"},Re={class:"pt-4 flex justify-center space-x-4"},Oe={key:0},ze={key:1,class:"pi pi-spinner pi-spin"},Ge={setup(w){const G=D(()=>localStorage.getItem("appLang")||"en"),S=D(()=>G.value==="en"?"name_en":"name_ar"),H=le(),$=de(),h=re(),{t:c}=ue(),l=y(),d=y(!1),J=y([]),x=y([]),V=y([]),F=y(H.params.id),o=y({products:[],model_ids:[],model_type:"",discount_type:null,discount_value:"",expires_at:null}),K=D(()=>x.value.map(e=>({id:e.id,name:e[S.value]||e.name_en||e.name_ar||"Unnamed Category"}))),Q=async()=>{try{const t=(await g.get(`/api/discount/${F.value}`)).data.data;o.value={model_ids:Array.isArray(t.model_ids)?t.model_ids:[],model_type:t.model_type||"",discount_type:t.discount_type||null,discount_value:parseFloat(t.discount_value)||"",expires_at:t.expires_at?new Date(t.expires_at):null,products:t.model_type==="product"?Array.isArray(t.model_ids)?t.model_ids:[]:[]},t.model_type==="product"&&t.model_ids.length>0?(await k(),await W(t.model_ids[0])):t.model_type==="category"&&(await k(),o.value.model_ids=t.model_ids.filter(u=>x.value.some(m=>m.id===u)))}catch(e){console.error("Error fetching discount:",e),h.add({severity:"error",summary:c("error"),detail:c("error_fetching_discount"),life:3e3}),$.push({name:"discount"})}},W=async e=>{try{const u=(await g.get(`/api/product/${e}`)).data.data;u.category_id&&(o.value.model_ids=[u.category_id],await U([u.category_id]))}catch(t){console.error("Error fetching product category:",t)}},k=async()=>{try{const e=await g.get("api/category");x.value=e.data.data.data||[]}catch(e){console.error("Error fetching categories:",e),h.add({severity:"error",summary:c("error"),detail:c("error_fetching_categories"),life:3e3})}},U=async e=>{try{const t=await g.post("api/category/products",{ids:e});V.value=t.data.data||[]}catch(t){console.error("Error fetching products:",t)}};I(()=>o.value.model_type,e=>{o.value.model_ids=[],o.value.products=[],V.value=[],(e==="category"||e==="product")&&k()}),I(()=>o.value.model_ids,e=>{o.value.model_type==="product"&&e.length>0?U(e):V.value=[]},{deep:!0}),I(x,()=>{o.value.model_type==="category"&&o.value.model_ids.length>0&&(o.value.model_ids=o.value.model_ids.filter(e=>x.value.some(t=>t.id===e)))},{deep:!0});const X=async()=>{try{const e=await g.get("api/model");J.value=e.data.data.data||[]}catch(e){console.error("Error fetching models:",e),h.add({severity:"error",summary:c("error"),detail:c("error_fetching_models"),life:3e3})}},Z=async()=>{var t,u;d.value=!0;const e={expires_at:o.value.expires_at?me(o.value.expires_at).format("YYYY-MM-DD"):null,discount_value:o.value.discount_value,discount_type:o.value.discount_type,model_type:o.value.model_type,model_ids:o.value.model_type==="product"?o.value.products:o.value.model_ids,_method:"PUT"};try{await g.post(`/api/discount/${F.value}`,e),$.push({name:"discount"}),h.add({severity:"success",summary:c("success"),detail:c("discount.updated_successfully"),life:3e3})}catch(m){console.error("Error:",m),h.add({severity:"error",summary:c("error"),detail:((u=(t=m.response)==null?void 0:t.data)==null?void 0:u.message)||c("error_occurred"),life:3e3})}finally{d.value=!1}};return ie(()=>{X(),Q()}),(e,t)=>{const u=v("Dropdown"),m=v("MultiSelect"),ee=v("InputNumber"),te=v("Calendar"),E=v("Button"),oe=v("Form"),se=v("Toast");return i(),n(ce,null,[s("div",ye,[s("h1",ve,a(e.$t("discount.update_discount")),1),p(oe,{onSubmit:ne(Z,["prevent"]),class:"space-y-6"},{default:z(()=>{var L,q,B,M,N,j,A,P,T,Y,R,O;return[s("div",ge,[s("div",fe,[s("label",be,[f(a(e.$t("discount.model_type"))+" ",1),he]),p(u,{filter:"",id:"model_type",modelValue:o.value.model_type,"onUpdate:modelValue":t[0]||(t[0]=r=>o.value.model_type=r),options:["product","category"],placeholder:e.$t("discount.select_model_type"),class:"w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:"",disabled:d.value},null,8,["modelValue","placeholder","disabled"]),(q=(L=l.value)==null?void 0:L.errors)!=null&&q.model_type?(i(),n("small",xe,a(l.value.errors.model_type[0]),1)):_("",!0)]),s("div",we,[s("label",Ve,[f(a(e.$t(o.value.model_type==="product"?"discount.select_category":"discount.select_model"))+" ",1),$e]),p(m,{filter:"",id:"model_ids",modelValue:o.value.model_ids,"onUpdate:modelValue":t[1]||(t[1]=r=>o.value.model_ids=r),options:C(K),optionLabel:"name",optionValue:"id",placeholder:e.$t(o.value.model_type==="product"?"discount.select_category":"discount.select_model"),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:"",disabled:d.value||!o.value.model_type},null,8,["modelValue","options","placeholder","disabled"]),(M=(B=l.value)==null?void 0:B.errors)!=null&&M.model_ids?(i(),n("small",ke,a(l.value.errors.model_ids[0]),1)):_("",!0)]),o.value.model_type==="product"?(i(),n("div",De,[s("label",Ie,[f(a(e.$t("discount.select_product"))+" ",1),Ce]),p(m,{filter:"",id:"product_id",modelValue:o.value.products,"onUpdate:modelValue":t[2]||(t[2]=r=>o.value.products=r),options:V.value,optionLabel:C(S),optionValue:"id",placeholder:e.$t("discount.select_product"),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:"",disabled:d.value||o.value.model_ids.length===0},null,8,["modelValue","options","optionLabel","placeholder","disabled"]),(j=(N=l.value)==null?void 0:N.errors)!=null&&j.products?(i(),n("small",Se,a(l.value.errors.products[0]),1)):_("",!0)])):_("",!0),s("div",Fe,[s("label",Ue,[f(a(e.$t("discount.discount_type"))+" ",1),Ee]),p(u,{filter:"",id:"discount_type",modelValue:o.value.discount_type,"onUpdate:modelValue":t[3]||(t[3]=r=>o.value.discount_type=r),options:[{label:e.$t("discount.fixed_amount"),value:1},{label:e.$t("discount.percentage"),value:2}],optionLabel:"label",optionValue:"value",placeholder:e.$t("discount.select_discount_type"),class:"w-full border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:"",disabled:d.value},null,8,["modelValue","options","placeholder","disabled"]),(P=(A=l.value)==null?void 0:A.errors)!=null&&P.discount_type?(i(),n("small",Le,a(l.value.errors.discount_type[0]),1)):_("",!0)]),s("div",qe,[s("label",Be,[f(a(e.$t("discount.discount_value"))+" ",1),Me]),p(ee,{id:"discount_value",modelValue:o.value.discount_value,"onUpdate:modelValue":t[4]||(t[4]=r=>o.value.discount_value=r),min:0,max:o.value.discount_type===2?100:null,placeholder:e.$t("discount.enter_discount_value"),class:"w-full px-4 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:"",disabled:d.value},null,8,["modelValue","max","placeholder","disabled"]),o.value.discount_type===2?(i(),n("small",Ne,a(e.$t("discount.percentage_note")),1)):_("",!0),(Y=(T=l.value)==null?void 0:T.errors)!=null&&Y.discount_value?(i(),n("small",je,a(l.value.errors.discount_value[0]),1)):_("",!0)]),s("div",Ae,[s("label",Pe,[f(a(e.$t("discount.expiration_date"))+" ",1),Te]),p(te,{id:"expires_at",modelValue:o.value.expires_at,"onUpdate:modelValue":t[5]||(t[5]=r=>o.value.expires_at=r),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:e.$t("discount.select_expiration_date"),class:"w-full border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:"",disabled:d.value,showIcon:!0,inputId:"expires_at_input"},null,8,["modelValue","minDate","placeholder","disabled"]),(O=(R=l.value)==null?void 0:R.errors)!=null&&O.expires_at?(i(),n("small",Ye,a(l.value.errors.expires_at[0]),1)):_("",!0)])]),s("div",Re,[p(E,{type:"button",label:e.$t("discount.cancel"),icon:"pi pi-times",onClick:t[6]||(t[6]=r=>C($).go(-1)),class:"px-6 mx-2 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:d.value},null,8,["label","disabled"]),p(E,{type:"submit",label:e.$t("discount.update_discount"),icon:"pi pi-check",loading:d.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:d.value},{default:z(()=>[d.value?(i(),n("i",ze)):(i(),n("span",Oe,a(e.$t("discount.update_discount")),1))]),_:1},8,["label","loading","disabled"])])]}),_:1},8,["onSubmit"])]),p(se)],64)}}},Ke=ae(Ge,[["__scopeId","data-v-2482b882"]]);export{Ke as default};
