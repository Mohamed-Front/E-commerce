import{_ as Y,j as Z,G as Q,r as f,l as N,q as G,o as ee,a as d,c,f as a,h as M,e as l,t as r,F as S,d as C,g as I,y as U,U as te,A as ae,i as w,H as se,x as re,p as oe,Q as le}from"./index-321838b3.js";const ie={class:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 font-inter"},ne={class:"flex lg:flex-row flex-col gap-10"},de={class:"flex-1 bg-white rounded-2xl shadow-lg p-6"},ce={key:0,class:"flex justify-center items-center py-12 gap-4"},ue={class:"text-lg text-gray-700"},_e={key:1},me={class:"mb-8"},ve={class:"text-lg font-semibold text-gray-800 mb-4"},ye={class:"flex flex-wrap gap-3"},pe=["onClick"],he={key:0,class:"text-xs block opacity-80"},fe={class:"mb-8"},ge={class:"text-lg font-semibold text-gray-800 mb-3"},be={value:null,disabled:""},xe=["value"],we={key:0,class:"text-center py-16 text-gray-500 text-lg"},ke={key:1},qe=["src","alt"],Se={class:"flex-1"},Ce={class:"font-semibold text-gray-900 text-lg"},$e={class:"text-yellow-700 text-sm mt-1"},Ae={class:"flex flex-wrap items-center gap-6 mt-4"},Fe={class:"flex items-center border border-gray-300 rounded-lg overflow-hidden"},Ne=["onClick","disabled"],Ie={class:"w-16 text-center font-medium py-2"},je=["onClick"],Ee=["onClick"],Te={class:"text-xl font-bold text-gray-800 mb-4"},Oe={key:0,class:"mb-4 p-4 bg-yellow-100 text-yellow-900 rounded-lg text-sm"},Pe={class:"space-y-3 text-sm"},Ve={class:"flex justify-between"},De={class:"text-gray-600"},Me={class:"font-medium"},Ue={class:"flex justify-between"},Be={class:"text-gray-600"},Le={class:"flex justify-between"},ze={class:"text-gray-600"},He={class:"flex justify-between text-lg font-bold text-gray-900 pt-4 border-t border-amber-300"},We=["onClick","disabled"],Je={class:"lg:w-96 w-full bg-white rounded-2xl shadow-lg p-6 h-fit sticky top-6"},Ke={class:"text-xl font-bold text-gray-800 mb-6"},Re={class:"space-y-4 text-sm border-b pb-6"},Xe={class:"flex justify-between"},Ye={class:"text-gray-600"},Ze={class:"flex justify-between"},Qe={class:"text-gray-600"},Ge={class:"flex justify-between text-xl font-bold pt-4 text-gray-900"},et={class:"text-yellow-700"},tt={class:"mt-8"},at=["placeholder"],st=["disabled"],rt=["disabled"],ot={__name:"cart",setup(lt){const{t,locale:$}=Z(),m=Q(),A=f(!0),q=f([]),v=f(null),y=f(""),h=f([]),g=f([]),u=f([]),b=f([]),j=s=>`${s.store_id}-${s.market_id||"default"}`,B=async()=>{try{const{data:s}=await w.get("/api/home/address");s.is_success&&(q.value=s.data,q.value.length>0&&(v.value=q.value[0].id))}catch{m.add({severity:"error",summary:t("error"),detail:t("cart.addressLoadError"),life:4e3})}},L=async()=>{try{A.value=!0;const{data:s}=await w.get("/api/cart");if(!s.is_success)return;const o=[],e=new Map;s.data.stores.forEach(i=>{const n=j(i);e.has(n)||e.set(n,{unique_store_id:n,store_id:i.store_id,display_name:$.value==="ar"?i.store_name_ar:i.store_name_en,market_name:$.value==="ar"?i.market_name_ar:i.market_name_en}),i.items.forEach(_=>{var P,V,D;const p=((P=_.variant)==null?void 0:P.price)||_.product.base_price||0,X=((D=(V=_.product.media)==null?void 0:V[0])==null?void 0:D.url)||_.product.key_default_image||"/images/placeholder-product.png";o.push({uniqueId:`${_.product_id}-${_.variant_id||"novar"}-${n}-${Date.now()}`,product_id:_.product_id,variant_id:_.variant_id||null,name:$.value==="ar"?_.product.name_ar:_.product.name_en,img:X,price:Number(p).toFixed(2),quantity:_.quantity,store_id:i.store_id,unique_store_id:n})})}),g.value=Array.from(e.values()),h.value=o,g.value.length>0&&(u.value=g.value.map(i=>i.unique_store_id)),await k()}catch{m.add({severity:"error",summary:t("error"),detail:t("cart.cartLoadError"),life:4e3})}finally{A.value=!1}},x=N(()=>u.value.length===0?[]:h.value.filter(s=>u.value.includes(s.unique_store_id))),F=N(()=>b.value.length===0?{subtotal:0,tax:0,total:0}:b.value.reduce((s,o)=>({subtotal:s.subtotal+Number(o.subtotal||0),tax:s.tax+Number(o.tax||0),total:s.total+Number(o.total||0)}),{subtotal:0,tax:0,total:0})),E=N(()=>v.value&&x.value.length>0),k=async()=>{if(!v.value||x.value.length===0){b.value=[];return}try{const s={address_id:v.value,view:!0,items:x.value.map(e=>({product_id:e.product_id,variant_id:e.variant_id,quantity:e.quantity}))};y.value.trim()&&(s.coupon=y.value.trim());const{data:o}=await w.post("/api/order/view",s);o.is_success&&(b.value=o.data.map(e=>({...e,unique_store_id:j({store_id:e.store_id,market_id:e.market_id})})))}catch(s){console.error("Failed to fetch order totals:",s),b.value=[]}},T=s=>{const o=g.value.find(e=>e.unique_store_id===s);return o?`${o.display_name}${o.market_name?` (${o.market_name})`:""}`:t("cart.unknownStore")},z=s=>{u.value=u.value.includes(s)?u.value.filter(o=>o!==s):[...u.value,s]},H=()=>{u.value=g.value.map(s=>s.unique_store_id)},O=async(s,o)=>{if(!(o<1))try{await w.post("/api/cart/update",{product_id:s.product_id,variant_id:s.variant_id,quantity:o}),s.quantity=o,await k(),m.add({severity:"success",summary:t("success"),detail:o>s.quantity?t("cart.quantityIncreased"):t("cart.quantityDecreased"),life:2e3})}catch{m.add({severity:"error",summary:t("error"),detail:t("cart.quantityUpdateError"),life:4e3})}},W=async s=>{try{await w.post("/api/cart/remove",{product_id:s.product_id,variant_id:s.variant_id}),h.value=h.value.filter(o=>o.uniqueId!==s.uniqueId),await k(),m.add({severity:"success",summary:t("success"),detail:t("cart.removeSuccess"),life:3e3})}catch{m.add({severity:"error",summary:t("error"),detail:t("cart.removeError"),life:4e3})}},J=async()=>{await k(),m.add({severity:"success",summary:t("success"),detail:t("cart.couponApplied"),life:3e3})},K=async s=>{var e,i;if(!v.value){m.add({severity:"warn",summary:t("warning"),detail:t("cart.selectAddressFirst"),life:4e3});return}const o=x.value.filter(n=>n.unique_store_id===s);if(o.length===0){m.add({severity:"info",summary:t("info"),detail:t("cart.noItemsInStore"),life:3e3});return}try{const n={address_id:v.value,items:o.map(p=>({product_id:p.product_id,variant_id:p.variant_id,quantity:p.quantity}))};y.value.trim()&&(n.coupon=y.value.trim());const{data:_}=await w.post("/api/order",n);_.is_success&&(m.add({severity:"success",summary:t("success"),detail:t("cart.orderSuccessStore",{store:T(s)}),life:5e3}),h.value=h.value.filter(p=>p.unique_store_id!==s),u.value=u.value.filter(p=>p!==s),await k())}catch(n){const _=((i=(e=n.response)==null?void 0:e.data)==null?void 0:i.message)||t("cart.orderError");m.add({severity:"error",summary:t("error"),detail:_,life:5e3})}},R=async()=>{var s,o;if(!E.value){m.add({severity:"warn",summary:t("warning"),detail:t("cart.cannotCheckout"),life:4e3});return}try{const e={address_id:v.value,items:x.value.map(n=>({product_id:n.product_id,variant_id:n.variant_id,quantity:n.quantity}))};y.value.trim()&&(e.coupon=y.value.trim());const{data:i}=await w.post("/api/order",e);i.is_success&&(m.add({severity:"success",summary:t("success"),detail:t("cart.orderSuccess"),life:5e3}),h.value=h.value.filter(n=>!u.value.includes(n.unique_store_id)),b.value=[],u.value=[])}catch(e){const i=((o=(s=e.response)==null?void 0:s.data)==null?void 0:o.message)||t("cart.orderError");m.add({severity:"error",summary:t("error"),detail:i,life:5e3})}};return G(()=>[v.value,u.value,y.value],k,{deep:!0}),ee(()=>{B(),L()}),(s,o)=>(d(),c("div",ie,[a("div",ne,[a("section",de,[A.value?(d(),c("div",ce,[M(l(se),{style:{width:"50px",height:"50px"},strokeWidth:"4",class:"text-yellow-600"}),a("p",ue,r(l(t)("loading")),1)])):(d(),c("div",_e,[a("div",me,[a("h3",ve,r(l(t)("cart.selectStore")),1),a("div",ye,[(d(!0),c(S,null,C(g.value,e=>(d(),c("button",{key:e.unique_store_id,onClick:i=>z(e.unique_store_id),class:re(["px-5 py-3 rounded-lg text-sm font-medium transition-all",u.value.includes(e.unique_store_id)?"bg-yellow-600 text-white shadow-md":"bg-amber-50 text-yellow-700 hover:bg-amber-100"])},[oe(r(e.display_name)+" ",1),e.market_name?(d(),c("span",he," ("+r(e.market_name)+") ",1)):I("",!0)],10,pe))),128)),g.value.length>1?(d(),c("button",{key:0,onClick:H,class:"px-5 py-3 rounded-lg text-sm font-medium bg-amber-50 text-yellow-700 hover:bg-amber-100 transition-all"},r(l(t)("cart.selectAllStores")),1)):I("",!0)])]),a("div",fe,[a("h3",ge,r(l(t)("cart.selectAddress")),1),U(a("select",{"onUpdate:modelValue":o[0]||(o[0]=e=>v.value=e),class:"w-full bg-amber-50 border border-amber-300 rounded-lg px-4 py-3 text-gray-800 focus:outline-none focus:ring-2 focus:ring-yellow-600"},[a("option",be,r(l(t)("cart.selectAddressPlaceholder")),1),(d(!0),c(S,null,C(q.value,e=>(d(),c("option",{key:e.id,value:e.id},r(e.address_line_1)+", "+r(e.city),9,xe))),128))],512),[[te,v.value]])]),x.value.length===0?(d(),c("div",we,r(u.value.length===0?l(t)("cart.selectStorePrompt"):l(t)("cart.emptyCart")),1)):(d(),c("div",ke,[(d(!0),c(S,null,C(x.value,e=>(d(),c("div",{key:e.uniqueId,class:"flex flex-col sm:flex-row items-start sm:items-center gap-4 p-5 bg-gray-50 rounded-xl mb-4 shadow-sm hover:shadow-md transition-shadow"},[a("img",{src:e.img||"/images/placeholder-product.png",alt:e.name,class:"w-24 h-24 object-cover rounded-lg border border-gray-200",loading:"lazy"},null,8,qe),a("div",Se,[a("h4",Ce,r(e.name),1),a("p",$e,r(l(t)("cart.price"))+": "+r(e.price)+" "+r(l(t)("cart.currency")),1),a("div",Ae,[a("div",Fe,[a("button",{onClick:i=>O(e,e.quantity-1),disabled:e.quantity<=1,class:"w-12 h-10 text-gray-600 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition"}," − ",8,Ne),a("span",Ie,r(e.quantity),1),a("button",{onClick:i=>O(e,e.quantity+1),class:"w-12 h-10 text-gray-600 hover:bg-gray-100 transition"}," + ",8,je)]),a("button",{onClick:i=>W(e),class:"text-red-600 hover:text-red-800 text-sm font-medium transition"},r(l(t)("cart.remove")),9,Ee)])])]))),128)),(d(!0),c(S,null,C(b.value,e=>(d(),c("div",{key:e.unique_store_id,class:"bg-gradient-to-r from-amber-50 to-yellow-50 p-6 mt-8 rounded-xl border border-amber-200"},[a("h3",Te,r(l(t)("cart.orderFrom"))+" "+r(T(e.unique_store_id)),1),e.delivery_message?(d(),c("div",Oe,r(e.delivery_message),1)):I("",!0),a("div",Pe,[a("div",Ve,[a("span",De,r(l(t)("cart.shippingTime")),1),a("span",Me,r(e.delivery_time||l(t)("cart.notAvailable")),1)]),a("div",Ue,[a("span",Be,r(l(t)("cart.subtotal")),1),a("span",null,r(Number(e.subtotal).toFixed(2))+" "+r(l(t)("cart.currency")),1)]),a("div",Le,[a("span",ze,r(l(t)("cart.tax")),1),a("span",null,r(Number(e.tax).toFixed(2))+" "+r(l(t)("cart.currency")),1)]),a("div",He,[a("span",null,r(l(t)("cart.total")),1),a("span",null,r(Number(e.total).toFixed(2))+" "+r(l(t)("cart.currency")),1)])]),a("button",{onClick:i=>K(e.unique_store_id),disabled:!v.value,class:"w-full mt-6 py-3 bg-yellow-600 text-white font-bold rounded-lg hover:bg-yellow-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition duration-200 shadow-md"},r(l(t)("cart.checkoutThisStoreOnly")||"اطلب من هذا المتجر فقط"),9,We)]))),128))]))]))]),a("aside",Je,[a("h3",Ke,r(l(t)("cart.orderSummary")),1),a("div",Re,[a("div",Xe,[a("span",Ye,r(l(t)("cart.subtotal")),1),a("span",null,r(F.value.subtotal.toFixed(2))+" "+r(l(t)("cart.currency")),1)]),a("div",Ze,[a("span",Qe,r(l(t)("cart.tax")),1),a("span",null,r(F.value.tax.toFixed(2))+" "+r(l(t)("cart.currency")),1)]),a("div",Ge,[a("span",null,r(l(t)("cart.total")),1),a("span",et,r(F.value.total.toFixed(2))+" "+r(l(t)("cart.currency")),1)])]),a("div",tt,[U(a("input",{"onUpdate:modelValue":o[1]||(o[1]=e=>y.value=e),type:"text",placeholder:l(t)("cart.couponPlaceholder"),class:"w-full px-4 py-3 border border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-600 transition"},null,8,at),[[ae,y.value]]),a("button",{onClick:J,disabled:!y.value.trim(),class:"w-full mt-3 py-3 bg-amber-100 text-yellow-700 font-semibold rounded-lg hover:bg-amber-200 disabled:opacity-60 disabled:cursor-not-allowed transition"},r(l(t)("cart.applyCoupon")),9,st)]),a("button",{onClick:R,disabled:!E.value,class:"w-full mt-8 py-4 bg-gray-900 text-white font-bold text-lg rounded-lg hover:bg-gray-800 disabled:bg-gray-400 disabled:cursor-not-allowed transition duration-200"},r(l(t)("cart.checkoutAll")||"إتمام الطلب (الكل)"),9,rt)])]),M(l(le))]))}},nt=Y(ot,[["__scopeId","data-v-9f8064e4"]]);export{nt as default};
