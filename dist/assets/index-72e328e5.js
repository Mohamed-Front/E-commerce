import{u as xe,G as Ce,j as Se,r as s,q as oe,o as $e,n as B,R as re,a as v,c as _,f as i,h as n,w as c,e as l,z as E,b as Pe,t as d,F as se,d as De,i as b,S as Ve,a2 as T,$ as Ee,Q as Ue,a0 as g,p as U,a4 as Fe,y as Le,g as ne,ac as Re}from"./index-e9816b7f.js";const Be={class:"grid"},Te={class:"col-12"},Ne={class:"card p-4 shadow-2 border-round"},je={class:"text-2xl font-bold"},Ie={class:"flex gap-2 align-items-center"},Me={class:"p-input-icon-left"},ze={class:"card shadow-1 surface-0"},Qe={class:"text-center py-4"},Ae={class:"text-xl"},Oe={class:"flex justify-content-center align-items-center py-4"},qe={class:"p-paginator p-component p-unselectable-text p-paginator-bottom"},Ge={class:"p-paginator-left-content"},Ke={class:"p-paginator-current"},We={class:"p-paginator-right-content"},He=["disabled"],Je=["disabled"],Xe=["onClick"],Ye={key:1,class:"p-paginator-dots"},Ze=["disabled"],et=["disabled"],tt={class:"flex align-items-center justify-content-center"},at={class:"flex flex-column gap-3"},lt={key:0,class:"mt-2"},ot={class:"font-semibold"},it={__name:"index",setup(rt){const Q=xe(),u=Ce(),{t}=Se(),F=s(!0),A=s([]),w=s(!1),O=s(null),ie=s(null),de=s({}),k=s("");s(null);const x=s(!1),m=s(null),N=s(!1),q=s([]),G=s([]),K=s([]),C=s(null),S=s(null),$=s(null),W=s(""),H=s(""),L=s(localStorage.getItem("appLang")||"en"),p=s(1),j=s(0),f=s(10),R=s(0),ce=s(""),ue=s(""),J=s(""),X=s(""),Y=s(0),Z=s(0),ee=s([]),I=async()=>{try{const a=await b.get("/api/category",{params:{search:W.value||void 0}}),e=L.value;q.value=a.data.data.data.map(r=>({label:e==="en"?`${r.name_en} `:`${r.name_ar} `,value:r.id}))}catch(a){u.add({severity:"error",summary:t("error"),detail:t("category.loadError"),life:3e3}),console.error("Error fetching categories:",a)}},te=async()=>{try{const a=await b.get("/api/store"),e=L.value;G.value=a.data.data.data.map(r=>({label:e==="en"?`${r.name_en} `:`${r.name_ar} `,value:r.id}))}catch(a){u.add({severity:"error",summary:t("error"),detail:t("store.loadError"),life:3e3}),console.error("Error fetching stores:",a)}},M=async()=>{try{const a=await b.get("/api/market",{params:{search:H.value||void 0}}),e=L.value;K.value=a.data.data.data.map(r=>({label:e==="en"?`${r.name_en} `:`${r.name_ar} `,value:r.id}))}catch(a){u.add({severity:"error",summary:t("error"),detail:t("market.loadError"),life:3e3}),console.error("Error fetching markets:",a)}},h=()=>{F.value=!0,b.get("/api/product",{params:{page:p.value,limit:f.value,search:k.value||void 0,category_id:C.value||void 0,store_id:S.value||void 0,market_id:$.value||void 0}}).then(a=>{A.value=a.data.data.data,j.value=a.data.data.total,R.value=a.data.data.last_page,ce.value=a.data.data.first_page_url,ue.value=a.data.data.last_page_url,J.value=a.data.data.next_page_url,X.value=a.data.data.prev_page_url,Y.value=a.data.data.from,Z.value=a.data.data.to,ee.value=a.data.data.links,F.value=!1}).catch(a=>{u.add({severity:"error",summary:t("error"),detail:t("product.loadError"),life:3e3}),F.value=!1,console.error("Error fetching products:",a)})};oe([k,f,C,S,$],()=>{p.value=1,h()}),oe(L,()=>{I(),te(),M()});const pe=a=>{W.value=a.value,I()},me=a=>{H.value=a.value,M()},P=a=>{a>=1&&a<=R.value&&(p.value=a,h())},ve=a=>{f.value=a.value,p.value=1,h()},be=a=>{O.value=a,w.value=!0},ge=()=>{b.delete(`/api/product/${O.value}`).then(()=>{u.add({severity:"success",summary:t("success"),detail:t("product.deleteSuccess"),life:3e3}),h(),w.value=!1}).catch(a=>{u.add({severity:"error",summary:t("error"),detail:t("product.deleteError"),life:3e3}),console.error("Error deleting product:",a)})},fe=()=>{const e=`/api/export/products?${new URLSearchParams({search:k.value||"",category_id:C.value||"",store_id:S.value||"",market_id:$.value||""}).toString()}`;b.get(e,{responseType:"blob"}).then(r=>{const D=new Blob([r.data],{type:"text/csv"}),y=document.createElement("a");y.href=URL.createObjectURL(D),y.download="products_export.csv",y.click(),URL.revokeObjectURL(y.href),u.add({severity:"success",summary:t("success"),detail:t("product.exportSuccess"),life:3e3})}).catch(r=>{u.add({severity:"error",summary:t("error"),detail:t("product.exportError"),life:3e3}),console.error("Error exporting products:",r)})},he=()=>{const a=`store_id,category_id,market_id,name_en,name_ar,sku,brand_id,sub_name_en,sub_name_ar,description_en,description_ar,base_price,cost_price,tax
1,1,1,Demo Product 1,منتج تجريبي 1,SKU001,1,Sub Demo 1,تجريبي فرعي 1,Description of Demo Product 1,وصف المنتج التجريبي 1,15.50,10.00,0.05
2,2,2,Demo Product 2,منتج تجريبي 2,SKU002,2,Sub Demo 2,تجريبي فرعي 2,Description of Demo Product 2,وصف المنتج التجريبي 2,22.00,15.00,0.05`,e=new Blob([a],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");if(r.download!==void 0){const D=URL.createObjectURL(e);r.setAttribute("href",D),r.setAttribute("download","product_import_example.csv"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}},ye=a=>{m.value=a.files[0]},_e=()=>{if(!m.value){u.add({severity:"error",summary:t("error"),detail:t("validation.fileRequired"),life:3e3});return}N.value=!0;const a=new FormData;a.append("file",m.value),b.post("/api/import/products",a).then(()=>{u.add({severity:"success",summary:t("success"),detail:t("product.importSuccess"),life:3e3}),h(),x.value=!1,m.value=null}).catch(e=>{u.add({severity:"error",summary:t("error"),detail:t("product.importError"),life:3e3}),console.error("Error importing products:",e)}).finally(()=>{N.value=!1})},we=()=>{Q.push({name:"product-create"})},ke=a=>{Q.push({name:"product-update",params:{id:a}})};return $e(()=>{Promise.all([I(),te(),M(),h()])}),(a,e)=>{const r=B("Button"),D=B("ProgressSpinner"),y=B("DataTable"),ae=B("Dialog"),V=re("can"),le=re("tooltip");return v(),_("div",Be,[i("div",Te,[i("div",Ne,[n(l(Ee),{class:"mb-4"},{start:c(()=>[i("h2",je,d(l(t)("product.managementTitle")),1)]),end:c(()=>[i("div",Ie,[i("span",Me,[e[14]||(e[14]=i("i",{class:"pi pi-search"},null,-1)),n(l(Ve),{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=o=>k.value=o),placeholder:l(t)("product.search")},null,8,["modelValue","placeholder"])]),n(l(T),{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=o=>C.value=o),options:q.value,optionLabel:"label",optionValue:"value",placeholder:l(t)("product.categoryFilter"),class:"w-12rem",showClear:!0,filter:"",filterPlaceholder:"Search categories",onFilter:pe},null,8,["modelValue","options","placeholder"]),n(l(T),{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=o=>S.value=o),options:G.value,optionLabel:"label",optionValue:"value",placeholder:l(t)("product.storeFilter"),class:"w-12rem",showClear:!0},null,8,["modelValue","options","placeholder"]),n(l(T),{modelValue:$.value,"onUpdate:modelValue":e[3]||(e[3]=o=>$.value=o),options:K.value,optionLabel:"label",optionValue:"value",placeholder:l(t)("product.marketFilter"),class:"w-12rem",showClear:!0,filter:"",filterPlaceholder:"Search markets",onFilter:me},null,8,["modelValue","options","placeholder"]),n(r,{label:l(t)("product.import"),icon:"pi pi-download",class:"p-import",onClick:e[4]||(e[4]=o=>x.value=!0)},null,8,["label"]),E(n(r,{label:l(t)("product.export"),icon:"pi pi-upload",class:"p-export",onClick:fe},null,8,["label"]),[[V,"list products"]]),E(n(r,{label:l(t)("product.new"),icon:"pi pi-plus",class:"p-button-success",onClick:we},null,8,["label"]),[[V,"create products"]])])]),_:1}),n(l(Ue)),i("div",ze,[E((v(),Pe(y,{ref_key:"dt",ref:ie,value:A.value,loading:F.value,"data-key":"id",paginator:!1,rows:f.value,filters:de.value,totalRecords:j.value,"responsive-layout":"scroll",stripedRows:"",showGridlines:"",class:"p-datatable-sm"},{empty:c(()=>[i("div",Qe,[e[15]||(e[15]=i("i",{class:"pi pi-exclamation-circle text-2xl mb-2"},null,-1)),i("p",Ae,d(l(t)("product.noData")),1)])]),loading:c(()=>[i("div",Oe,[n(D,{style:{width:"50px",height:"50px"},strokeWidth:"4"})])]),default:c(()=>[n(l(g),{"selection-mode":"multiple","header-style":"width: 3rem"}),e[16]||(e[16]=U(" ` ` ")),n(l(g),{field:"id",header:l(t)("id"),sortable:!0,"header-style":"width:14%; min-width:10rem;"},{body:c(o=>[U(d(o.data.id),1)]),_:1},8,["header"]),n(l(g),{field:"name_ar",header:l(t)("product.nameAr"),sortable:!0,"header-style":"width:14%; min-width:13rem;"},{body:c(o=>[U(d(o.data.name_ar),1)]),_:1},8,["header"]),n(l(g),{field:"name_en",header:l(t)("product.nameEn"),sortable:!0,"header-style":"width:14%; min-width:13rem;"},{body:c(o=>[U(d(o.data.name_en),1)]),_:1},8,["header"]),n(l(g),{field:"base_price",header:l(t)("product.basePrice"),sortable:!0,"header-style":"width:14%; min-width:10rem;"},{body:c(o=>[U(d(o.data.base_price),1)]),_:1},8,["header"]),n(l(g),{field:"is_displayed",header:l(t)("product.isDisplayed"),sortable:!0,"header-style":"width:14%; min-width:10rem;"},{body:c(o=>[n(l(Fe),{value:o.data.is_displayed?l(t)("yes"):l(t)("no"),severity:o.data.is_displayed?"success":"info"},null,8,["value","severity"])]),_:1},8,["header"]),n(l(g),{header:l(t)("actions"),"header-style":"width: 12rem"},{body:c(o=>[E(n(r,{icon:"pi pi-pencil",class:"p-detail",onClick:z=>ke(o.data.id)},null,8,["onClick"]),[[V,"edit products"],[le,l(t)("edit"),void 0,{top:!0}]]),E(n(r,{icon:"pi pi-trash mx-2",class:"p-delete",onClick:z=>be(o.data.id)},null,8,["onClick"]),[[V,"delete products"],[le,l(t)("delete"),void 0,{top:!0}]])]),_:1},8,["header"])]),_:1,__:[16]},8,["value","loading","rows","filters","totalRecords"])),[[V,"list products"]]),i("div",qe,[i("div",Ge,[i("span",Ke,d(l(t)("show"))+" "+d(Y.value)+" "+d(l(t)("to"))+" "+d(Z.value)+" "+d(l(t)("from"))+" "+d(j.value),1)]),i("div",We,[i("button",{class:"p-paginator-first p-paginator-element p-link",disabled:p.value===1,onClick:e[5]||(e[5]=o=>P(1))},e[17]||(e[17]=[i("span",{class:"p-paginator-icon pi pi-angle-double-left"},null,-1)]),8,He),i("button",{class:"p-paginator-prev p-paginator-element p-link",disabled:!X.value,onClick:e[6]||(e[6]=o=>P(p.value-1))},e[18]||(e[18]=[i("span",{class:"p-paginator-icon pi pi-angle-left"},null,-1)]),8,Je),(v(!0),_(se,null,De(ee.value,(o,z)=>(v(),_(se,{key:z},[o.label&&!isNaN(parseInt(o.label))?(v(),_("button",{key:0,class:Le(["p-paginator-page p-paginator-element p-link",{"p-highlight":o.active}]),onClick:st=>P(parseInt(o.label))},d(o.label),11,Xe)):o.label==="..."?(v(),_("span",Ye,"...")):ne("",!0)],64))),128)),i("button",{class:"p-paginator-next p-paginator-element p-link",disabled:!J.value,onClick:e[7]||(e[7]=o=>P(p.value+1))},e[19]||(e[19]=[i("span",{class:"p-paginator-icon pi pi-angle-right"},null,-1)]),8,Ze),i("button",{class:"p-paginator-last p-paginator-element p-link",disabled:p.value===R.value,onClick:e[8]||(e[8]=o=>P(R.value))},e[20]||(e[20]=[i("span",{class:"p-paginator-icon pi pi-angle-double-right"},null,-1)]),8,et),n(l(T),{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=o=>f.value=o),options:[5,10,20,30],onChange:ve,class:"ml-2",style:{width:"80px"}},null,8,["modelValue"])])])]),n(ae,{visible:w.value,"onUpdate:visible":e[11]||(e[11]=o=>w.value=o),style:{width:"450px"},header:l(t)("product.deleteConfirmTitle"),modal:!0},{footer:c(()=>[n(r,{label:l(t)("no"),icon:"pi pi-times",class:"p-button-text",onClick:e[10]||(e[10]=o=>w.value=!1)},null,8,["label"]),n(r,{label:l(t)("yes"),icon:"pi pi-check",class:"p-button-text p-button-danger",onClick:ge},null,8,["label"])]),default:c(()=>[i("div",tt,[e[21]||(e[21]=i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem",color:"var(--red-500)"}},null,-1)),i("span",null,d(l(t)("product.deleteConfirmMessage")),1)])]),_:1},8,["visible","header"]),n(ae,{visible:x.value,"onUpdate:visible":e[13]||(e[13]=o=>x.value=o),style:{width:"450px"},header:l(t)("product.importTitle"),modal:!0},{footer:c(()=>[n(r,{label:l(t)("cancel"),icon:"pi pi-times",class:"p-button-text",onClick:e[12]||(e[12]=o=>x.value=!1)},null,8,["label"]),n(r,{label:l(t)("product.importButton"),icon:"pi pi-check",loading:N.value,disabled:!m.value,onClick:_e},null,8,["label","loading","disabled"])]),default:c(()=>[i("div",at,[n(r,{label:l(t)("product.downloadExample"),icon:"pi pi-download",class:"p-button-outlined",onClick:he},null,8,["label"]),n(l(Re),{mode:"basic","custom-upload":!0,onSelect:ye,maxFileSize:1e7,chooseLabel:"Select File"}),m.value?(v(),_("div",lt,[i("p",ot,d(l(t)("selectedFile"))+": "+d(m.value.name),1)])):ne("",!0)])]),_:1},8,["visible","header"])])])])}}};export{it as default};
