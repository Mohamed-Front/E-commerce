import{J as W,K as j,r as x,b as H,a as E,L as X,u as ee,M as se,y as M,o as c,e as m,g as B,f as d,O as ae,j as u,P as te,t as b,B as v,F as q,h as D,z as F,Q as N,c as K,x as I,R as oe,A as re,S as ne,q as z}from"./index-b794012a.js";const le="/assets/loginFormImg-54a808b3.png",ie=W("Auth",{state:()=>({webUser:j("webUser",{}),userToken:j("userToken",null),authenticatedweb:j("authenticatedweb",!1),authErrors:[],role:"",msg:"",loading:x(!1),router:H()}),getters:{user:i=>i.webUser,token:i=>i.userToken,errors:i=>i.authErrors,successMsg:i=>i.msg},actions:{async getUser(){this.authenticatedweb==!0&&this.webUser&&await E.get("api/get-user")},async handleLogin(i){var g;this.authErrors=["Invalid credentials. Please try again."],this.loading=!0,this.resetAuthStore();try{const n=await E.post("/api/login",{email:i.email,phone:i.phone,password:i.password});(g=n.data.data)!=null&&g.access_token?(this.authenticatedweb=!0,this.userToken=n.data.data.access_token,this.webUser=n.data.data.user,this.router.push({name:"/"})):this.authErrors=["Invalid credentials. Please try again."]}catch(n){n.response?n.response.status===422?this.authErrors=n.response.data.errors?Object.values(n.response.data.errors).flat():["Validation failed. Please check your inputs."]:n.response.status===401?this.authErrors="Invalid email or password.":this.authErrors=[n.response.data.message||"An error occurred during login."]:n.request?this.authErrors=["Network error. Please check your connection."]:this.router.push({name:"/"})}finally{this.loading=!1}},async handleRegister(i){var g,n,f;if(!this.loading){this.resetAuthStore(),this.loading=!0;try{const e=await E.post("/api/register",{name:i.name,email:i.email,phone:i.phone,password:i.password,password_confirmation:i.password_confirmation});this.authenticatedweb=!0,this.userToken=e.data.token,this.webUser=e.data.user,this.router.push({name:"Home"})}catch(e){((g=e.response)==null?void 0:g.status)===422?this.authErrors=e.response.data.errors?Object.values(e.response.data.errors).flat():["Validation failed. Please check your inputs."]:this.authErrors=[((f=(n=e.response)==null?void 0:n.data)==null?void 0:f.message)||"Registration failed. Please try again."]}finally{this.loading=!1}}},async handleLogout(){try{await E.post("/api/logout")}catch(i){console.error("Logout error:",i)}finally{this.authenticatedweb=!1,this.userPermissions=[],this.authErrors=[],this.msg="",this.loading=!1,this.router.push({name:"Login"})}},async forgotPassword(i){var g,n,f;try{this.resetAuthStore();const e=await E.post("/api/forgot-password",{email:i.email});this.msg=e.data.status,this.router.push({name:"ResetPassword"})}catch(e){((g=e.response)==null?void 0:g.status)===422?this.authErrors=Object.values(e.response.data.errors).flat():this.authErrors=[((f=(n=e.response)==null?void 0:n.data)==null?void 0:f.message)||"Password reset request failed."]}},async resetPassword(i){var g,n,f;try{await E.post("/api/reset-password",i),this.router.push({name:"Login"})}catch(e){((g=e.response)==null?void 0:g.status)===422?this.authErrors=Object.values(e.response.data.errors).flat():this.authErrors=[((f=(n=e.response)==null?void 0:n.data)==null?void 0:f.message)||"Password reset failed."]}},resetAuthStore(){this.authenticatedweb=!1,this.userPermissions=[],this.authErrors=[],this.msg="",this.loading=!1},clearAllData(){this.webUser={},this.userToken=null,this.authenticatedweb=!1,this.userPermissions=[],this.authErrors=[],this.msg="",this.loading=!1}}}),ue={class:"flex flex-col bg-[#111] min-h-[110vh]"},de={class:"min-h-[80vh] flex justify-evenly items-center"},pe={class:"bg-[#2A2A2A] p-8 rounded-md text-white lg:w-[40%] w-[80%]"},ce={class:""},he={class:"font-bold"},me={class:"text-[#9F9F9F] mb-6 text-center text-sm"},ve={key:0,class:"text-center text-red-500"},ge={class:"flex flex-col gap-1 w-full text-white"},fe={key:0,class:"mb-2"},we=["onUpdate:modelValue","type","placeholder","onBlur","id"],ye=["onClick"],be={key:2,class:"text-red-500 text-xs mx-4"},ke={key:2,class:"mb-2"},Pe={key:3,class:"py-2 rounded-md px-4 flex items-center gap-2 justify-between"},xe=["onUpdate:modelValue","onInput","onKeydown"],_e={key:4},Te={key:5,class:"font-bold cursor-pointer"},Ee={key:6,class:"flex justify-between w-full"},$e={for:"rememberme"},Oe={key:7},Ve={for:"Terms"},Ae={key:8,class:"text-xs text-[#9F9F9F]"},Se=d("div",null,[d("img",{src:le,alt:"",class:"lg:block hidden w-[450px] rounded-tl-[30%] rounded-br-[30%]"})],-1),Fe={setup(i){const g=H(),n=X(),f=ie(),{t:e}=ee(),s=x("login"),k=x(!1),L=x(!0),U=x(!1),_=x([{type:"username",data:"",inputtype:"text",icon:"pi-user",placeholder:"Your Name",page:["registration"]},{type:"phone",data:"",placeholder:"07xxxxxxxx",inputtype:"text",page:["login","registration","missedPassword"]},{type:"password",data:"",icon:"pi-lock",showicon:"pi-eye-slash",inputtype:"password",page:["login","registration","newPassword"]},{type:"checkpassword",data:"",icon:"pi-lock",showicon:"pi-eye-slash",inputtype:"password",page:["registration","newPassword"]}]),A=x(60),$=se(["","","","","",""]),S=x({phone:"",newpass:"",renewpass:""}),J=x(6),Q=(o,t)=>{const p=t.target.value;if(!/^[0-9]$/.test(p)){$[o]="";return}$[o]=p,o<$.length-1&&z(()=>{const h=document.querySelectorAll("input")[o+1];h==null||h.focus()})},Y=(o,t)=>{$[o]===""&&o>0&&z(()=>{const p=document.querySelectorAll("input")[o-1];p==null||p.focus()})},l=x({}),R=o=>{const t=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/;switch(o){case"password":l.value.type=o;const p=_.value.find(T=>T.type==="password"),h=p==null?void 0:p.data.trim();h?t.test(h)?l.value.message="":l.value.message=e("auth.passworderr"):l.value.message=e("auth.passwordreq");break;case"username":l.value.type=o;const r=_.value.find(T=>T.type===o);(r==null?void 0:r.data.trim())?l.value.message="":l.value.message=e("auth.usernamereq");break;case"checkpassword":l.value.type=o;const P=_.value.find(T=>T.type==="password"),C=P==null?void 0:P.data.trim(),O=_.value.find(T=>T.type===o),V=O==null?void 0:O.data.trim();V?V!==C?l.value.message=e("auth.repassworderr"):l.value.message="":l.value.message=e("auth.repasswordreq");break;case"phone":l.value.type=o;const a=_.value.find(T=>T.type===o),y=a==null?void 0:a.data.trim();y?/^\d+$/.test(y)?l.value.message="":l.value.message=e("auth.justnum"):l.value.message=e("auth.phonereq");break}},Z=async()=>{var p,h,r,w,P,C,O,V;const o=_.value.filter(a=>a.page.includes(s.value));for(const a of o)if(R(a.type),l.value.message)break;const t=x({});if(!l.value.message&&s.value=="login"){k.value=!0;for(const a of o)t.value.phone=a.type=="phone"?a.data:t.value.phone,t.value.password=a.type=="password"?a.data:t.value.password;await f.handleLogin(t.value).finally(()=>{k.value=!1})}else if(!l.value.message&&s.value=="registration"){if(!U.value)throw n.add({severity:"info",summary:e("auth.Terms"),detail:e("auth.Termserror"),life:3e3});k.value=!0;for(const a of o)t.value.password=a.type=="password"?a.data:t.value.password,t.value.name=a.type=="username"?a.data:t.value.name,t.value.phone=a.type=="phone"?a.data:t.value.phone;await f.handleRegister(t.value).finally(()=>{k.value=!1})}else if(!l.value.message&&s.value=="missedPassword"){k.value=!0;try{const a=await E.post("api/send-otp",{phone:(p=_.value.find(y=>y.type==="phone"))==null?void 0:p.data});!l.value.message&&s.value=="missedPassword"&&(s.value="OTP",S.value.phone=(h=_.value.find(y=>y.type==="phone"))==null?void 0:h.data,A.value=60,setInterval(()=>{if(A.value>0)A.value--;else return},1e3),n.add({severity:"success",summary:"Send OTP",detail:a.data.message,life:3e3}))}catch(a){const y=(w=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:w.message;n.add({severity:"error",summary:"Send OTP",detail:y,life:3e3})}finally{k.value=!1}}else if(!l.value.message&&s.value=="OTP"){k.value=!0;try{const a=await E.post("api/verify-email",{phone:S.value.phone,otp:$.join("")});s.value="newPassword",n.add({severity:"success",summary:"Verify Email",detail:a.data.message,life:3e3})}catch(a){const y=(C=(P=a==null?void 0:a.response)==null?void 0:P.data)==null?void 0:C.message;n.add({severity:"error",summary:"Verify Email",detail:y,life:3e3})}finally{k.value=!1}}else if(!l.value.message&&s.value=="newPassword"){k.value=!0;for(const a of o)t.value.password=a.type=="password"?a.data:t.value.password,t.value.repassword=a.type=="checkpassword"?a.data:t.value.repassword;try{const a=await E.post("api/change-password",{phone:S.value.phone,otp:$.join(""),password:t.value.password,password_confirmation:t.value.repassword});s.value="login",n.add({severity:"success",summary:"Change Password",detail:a.data.message,life:3e3})}catch(a){const y=(V=(O=a==null?void 0:a.response)==null?void 0:O.data)==null?void 0:V.message;n.add({severity:"error",summary:"Change Password",detail:y,life:3e3})}finally{k.value=!1}}},G=o=>{const t=document.getElementById(o),p=_.value.find(h=>h.type===o);t.type=="text"?(t.type="password",p.showicon="pi-eye-slash"):t.type=="password"&&(t.type="text",p.showicon="pi-eye")};return(o,t)=>{const p=M("Toast"),h=M("Button");return c(),m(q,null,[B(p),d("main",ue,[d("nav",null,[d("img",{src:ae,alt:"",width:"80",class:"m-[2rem] cursor-pointer",onClick:t[0]||(t[0]=r=>u(g).push({name:"home"}))})]),d("div",de,[d("div",pe,[d("div",ce,[d("form",{class:"flex flex-col gap-4 items-center",onSubmit:t[5]||(t[5]=te(r=>Z(),["prevent"]))},[d("h1",he,b(s.value=="login"?o.$t("auth.loginnow"):s.value=="registration"?o.$t("auth.registrationnow"):s.value=="missedPassword"?o.$t("auth.forgotpassword"):s.value=="OTP"?o.$t("auth.Activationcode"):o.$t("auth.newpassH")),1),d("p",me,b(s.value=="login"||s.value=="registration"?u(e)("auth.loginnote"):s.value=="missedPassword"?u(e)("auth.forgotpasswordP"):s.value=="OTP"?u(e)("auth.donesend")+` ${S.value.phone}`:u(e)("auth.newpassP")),1),u(f).authErrors?(c(),m("span",ve,b(u(f).authErrors[0]),1)):v("",!0),s.value!="OTP"?(c(!0),m(q,{key:1},D(_.value,r=>(c(),m("div",ge,[r.page.includes(s.value)?(c(),m("label",fe,b(u(e)(`auth.${r.type}`)),1)):v("",!0),r.page.includes(s.value)?(c(),m("div",{key:1,class:I(["bg-[#9F9F9F26] py-2 rounded-md px-4 flex items-center gap-2",l.value.type==r.type&&l.value.message?"border-2 border-red-500":""])},[d("i",{class:I(["pi",r.icon?r.icon:""])},null,2),F(d("input",{"onUpdate:modelValue":w=>r.data=w,type:r.inputtype,placeholder:r.placeholder,class:"bg-transparent outline-none flex-1",onBlur:w=>R(r.type),id:r.type},null,40,we),[[oe,r.data]]),d("i",{class:I(["pi",r.showicon?r.showicon:""]),onClick:w=>G(r.type)},null,10,ye)],2)):v("",!0),l.value.type==r.type&&l.value.message?(c(),m("span",be,b(l.value.message),1)):v("",!0)]))),256)):v("",!0),s.value=="OTP"?(c(),m("label",ke,b(u(e)("auth.code")),1)):v("",!0),s.value=="OTP"?(c(),m("div",Pe,[(c(!0),m(q,null,D(J.value,(r,w)=>F((c(),m("input",{key:w,"onUpdate:modelValue":P=>u($)[w]=P,ref_for:!0,ref:"otpInput",maxlength:"1",type:"text",inputmode:"numeric",class:"w-[50px] h-[50px] text-center rounded border bg-transparent border-gray-300 focus:outline-none focus:border-blue-500",onInput:P=>Q(w,P),onKeydown:ne(P=>Y(w),["backspace"])},null,40,xe)),[[re,u($)[w]]])),128))])):v("",!0),s.value=="OTP"?(c(),m("label",_e,b(u(e)("auth.expen")+` ${A.value}s`),1)):v("",!0),s.value=="OTP"?(c(),m("label",Te,b(u(e)("auth.resend")),1)):v("",!0),s.value=="login"?(c(),m("div",Ee,[d("div",null,[F(d("input",{"onUpdate:modelValue":t[1]||(t[1]=r=>L.value=r),type:"checkbox",id:"rememberme",class:"mx-2"},null,512),[[N,L.value]]),d("label",$e,b(u(e)("auth.rememberme")),1)]),d("span",{class:"text-blue-500 cursor-pointer hover:translate-y-[-3px] transition-all",onClick:t[2]||(t[2]=r=>s.value="missedPassword")},b(u(e)("auth.forgotpassword")),1)])):v("",!0),s.value=="registration"?(c(),m("div",Oe,[F(d("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>U.value=r),type:"checkbox",id:"Terms",class:"mx-2 text-xs"},null,512),[[N,U.value]]),d("label",Ve,b(u(e)("auth.terms")),1)])):v("",!0),B(h,{type:"submit",loading:k.value,label:s.value=="registration"?u(e)("auth.registration"):s.value=="login"?u(e)("auth.login"):(s.value=="missedPassword",o.$t("auth.ok")),class:"outline-none w-full mt-6 focus:!shadow-none"},null,8,["loading","label"]),B(h,{onClick:t[4]||(t[4]=r=>s.value=="registration"?s.value="login":s.value="registration"),label:s.value=="login"||s.value=="missedPassword"?u(e)("auth.registration"):s.value=="registration"?u(e)("auth.login"):u(e)("auth.registration"),severity:"secondary",class:"outline-none w-full focus:!shadow-none Custombutton"},null,8,["label"]),s.value!="OTP"&&s.value!="newPassword"?(c(),m("span",Ae,b(o.$t("auth.or")),1)):v("",!0),s.value!="OTP"&&s.value!="newPassword"?(c(),K(h,{key:9,label:u(e)("auth.loginwithfacebock"),icon:"pi pi-facebook",severity:"secondary",class:"text-[#9F9F9F] !text-sm outline-none w-full focus:!shadow-none Custombutton"},null,8,["label"])):v("",!0),s.value!="OTP"&&s.value!="newPassword"?(c(),K(h,{key:10,label:u(e)("auth.loginwithgoogle"),icon:"pi pi-google",severity:"secondary",class:"text-[#9F9F9F] !text-sm outline-none w-full focus:!shadow-none Custombutton"},null,8,["label"])):v("",!0)],32)])]),Se])])],64)}}};export{Fe as default};
