import{_ as Q,l as L,k as z,u as G,A as H,j as J,r as _,n as D,o as K,P as N,C as W,a as p,c as v,f as d,t as u,e as o,B as m,h as y,x as b,g as f,w as X,v as Z,i as h,a1 as E,af as I,S as ee,ag as te,T as S,O as se}from"./index-c589d290.js";import{h as ae}from"./moment-fbc5633a.js";const oe=["dir"],re={class:"text-3xl font-bold text-center mb-8 text-gray-800"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},de={class:"space-y-2"},ie={for:"type",class:"block text-sm font-medium text-gray-700"},ue={key:0,class:"text-red-500 text-xs"},ne={class:"space-y-2"},ce={for:"ids",class:"block text-sm font-medium text-gray-700"},pe={key:0,class:"text-red-500 text-xs"},ve={key:0,class:"space-y-2"},ye={for:"product_id",class:"block text-sm font-medium text-gray-700"},_e={key:0,class:"text-red-500 text-xs"},fe={class:"space-y-2"},ge={for:"discount_type",class:"block text-sm font-medium text-gray-700"},me={key:0,class:"text-red-500 text-xs"},be={class:"space-y-2"},xe={for:"discount_value",class:"block text-sm font-medium text-gray-700"},he={key:0,class:"text-gray-500 text-xs"},we={key:1,class:"text-red-500 text-xs"},Ve={class:"space-y-2"},ke={for:"expires_at",class:"block text-sm font-medium text-gray-700"},$e={key:0,class:"text-red-500 text-xs"},Le={class:"pt-4 flex justify-center space-x-4"},De={key:0},Fe={key:1,class:"pi pi-spinner pi-spin"},Ce={__name:"update",setup(je){class U{constructor(e,i){this.errors=e,this.t=i}required(e,i){return!e||Array.isArray(e)&&e.length===0?(this.errors.value[i]=this.t("validation.requiredFields",{field:this.t(`discount.${i}`)}),!1):!0}numericRange(e,i,l,c){return e==null||isNaN(e)?(this.errors.value[i]=this.t("validation.requiredFields",{field:this.t(`discount.${i}`)}),!1):l!==null&&e<l?(this.errors.value[i]=this.t("validation.minValue",{field:this.t(`discount.${i}`),min:l}),!1):c!==null&&e>c?(this.errors.value[i]=this.t("validation.maxValue",{field:this.t(`discount.${i}`),max:c}),!1):!0}isValid(){return Object.keys(this.errors.value).length===0}}const F=L(()=>localStorage.getItem("appLang")||"en"),C=L(()=>F.value==="en"?"name_en":"name_ar"),P=L(()=>F.value==="ar"),M=z(),k=G(),g=H(),{t:s}=J(),n=_(!1),x=_([]),w=_([]),j=_(""),q=_(""),A=_(M.params.id),r=_({}),t=_({type:"",ids:[],products:[],discount_type:null,discount_value:null,expires_at:null}),R=async()=>{try{const e=(await h.get(`/api/discount/${A.value}`)).data.data;t.value={type:e.type||"",ids:Array.isArray(e.ids)?e.ids:[],products:e.type==="product"?Array.isArray(e.ids)?e.ids:[]:[],discount_type:e.discount_type||null,discount_value:parseFloat(e.discount_value)||null,expires_at:e.expires_at?new Date(e.expires_at):null},e.type==="product"&&e.ids.length>0?(await V(),await B(e.ids)):e.type==="category"&&(await V(),t.value.ids=e.ids.filter(i=>x.value.some(l=>l.id===i)))}catch(a){console.error("Error fetching discount:",a),g.add({severity:"error",summary:s("error"),detail:s("error.discountLoad"),life:3e3}),k.push({name:"discount"})}},B=async a=>{try{const e=new Set;for(const i of a){const c=(await h.get(`/api/product/${i}`)).data.data;c.category_id&&e.add(c.category_id)}t.value.ids=Array.from(e),t.value.ids.length>0&&await $()}catch(e){console.error("Error fetching product categories:",e),g.add({severity:"error",summary:s("error"),detail:s("error.productLoad"),life:3e3})}},V=async()=>{try{const a=await h.get("/api/category",{params:{search:j.value||void 0}});x.value=a.data.data.data||[]}catch(a){console.error("Error fetching categories:",a),g.add({severity:"error",summary:s("error"),detail:s("error.categoryLoad"),life:3e3})}},$=async()=>{try{const a=await h.get("/api/product",{params:{search:q.value||void 0,category_ids:t.value.ids.length>0?t.value.ids.join(","):void 0}});w.value=a.data.data.data||[]}catch(a){console.error("Error fetching products:",a),g.add({severity:"error",summary:s("error"),detail:s("error.productLoad"),life:3e3})}},T=a=>{j.value=a.value,V()},Y=a=>{q.value=a.value,$()};D(()=>t.value.type,a=>{t.value.ids=[],t.value.products=[],w.value=[],r.value={},(a==="category"||a==="product")&&V()}),D(()=>t.value.ids,a=>{t.value.type==="product"&&a.length>0?$():(w.value=[],t.value.products=[])},{deep:!0}),D(x,()=>{t.value.type==="category"&&t.value.ids.length>0&&(t.value.ids=t.value.ids.filter(a=>x.value.some(e=>e.id===a)))},{deep:!0});const O=async()=>{var i,l;r.value={};const a=new U(r,s);if(a.required(t.value.type,"type"),a.required(t.value.ids,"select_category"),t.value.type==="product"&&a.required(t.value.products,"select_product"),a.required(t.value.discount_type,"discount_type"),a.numericRange(t.value.discount_value,"discount_value",0,t.value.discount_type===2?100:null),a.required(t.value.expires_at,"expiration_date"),!a.isValid()){const c=Object.values(r.value).join(", ");g.add({severity:"error",summary:s("error"),detail:c,life:3e3});return}n.value=!0;const e={type:t.value.type,ids:t.value.type==="product"?t.value.products:t.value.ids,discount_type:t.value.discount_type,discount_value:t.value.discount_value,expires_at:ae(t.value.expires_at).format("YYYY-MM-DD"),_method:"PUT"};try{await h.post(`/api/discount/${A.value}`,e),k.push({name:"discount"}),g.add({severity:"success",summary:s("success"),detail:s("discount.updated_successfully"),life:3e3})}catch(c){console.error("Error:",c),g.add({severity:"error",summary:s("error"),detail:((l=(i=c.response)==null?void 0:i.data)==null?void 0:l.message)||s("error.updateError"),life:3e3})}finally{n.value=!1}};return K(()=>{R()}),(a,e)=>{const i=N("can");return W((p(),v("div",{class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg",dir:P.value?"rtl":"ltr"},[d("h1",re,u(o(s)("discount.update_discount")),1),d("form",{onSubmit:Z(O,["prevent"]),class:"space-y-6"},[d("div",le,[d("div",de,[d("label",ie,[m(u(o(s)("discount.type"))+" ",1),e[7]||(e[7]=d("span",{class:"text-red-500"},"*",-1))]),y(o(E),{filter:"",id:"type",modelValue:t.value.type,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.type=l),options:["product","category"],placeholder:o(s)("discount.select_type"),class:b(["w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":r.value.type}]),disabled:n.value},null,8,["modelValue","placeholder","class","disabled"]),r.value.type?(p(),v("small",ue,u(r.value.type),1)):f("",!0)]),d("div",ne,[d("label",ce,[m(u(o(s)("discount.select_category"))+" ",1),e[8]||(e[8]=d("span",{class:"text-red-500"},"*",-1))]),y(o(I),{filter:"",id:"ids",modelValue:t.value.ids,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.ids=l),options:x.value,optionLabel:C.value,optionValue:"id",placeholder:o(s)("discount.searchCategories"),class:b(["w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":r.value.select_category}]),disabled:n.value||!t.value.type,onFilter:T,display:"chip"},null,8,["modelValue","options","optionLabel","placeholder","class","disabled"]),r.value.select_category?(p(),v("small",pe,u(r.value.select_category),1)):f("",!0)]),t.value.type==="product"?(p(),v("div",ve,[d("label",ye,[m(u(o(s)("discount.select_product"))+" ",1),e[9]||(e[9]=d("span",{class:"text-red-500"},"*",-1))]),y(o(I),{filter:"",id:"product_id",modelValue:t.value.products,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.products=l),options:w.value,optionLabel:C.value,optionValue:"id",placeholder:o(s)("discount.searchProducts"),class:b(["w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":r.value.select_product}]),disabled:n.value||t.value.ids.length===0,onFilter:Y,display:"chip"},null,8,["modelValue","options","optionLabel","placeholder","class","disabled"]),r.value.select_product?(p(),v("small",_e,u(r.value.select_product),1)):f("",!0)])):f("",!0),d("div",fe,[d("label",ge,[m(u(o(s)("discount.discount_type"))+" ",1),e[10]||(e[10]=d("span",{class:"text-red-500"},"*",-1))]),y(o(E),{filter:"",id:"discount_type",modelValue:t.value.discount_type,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.discount_type=l),options:[{label:o(s)("discount.fixed_amount"),value:1},{label:o(s)("discount.percentage"),value:2}],optionLabel:"label",optionValue:"value",placeholder:o(s)("discount.select_discount_type"),class:b(["w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":r.value.discount_type}]),disabled:n.value},null,8,["modelValue","options","placeholder","class","disabled"]),r.value.discount_type?(p(),v("small",me,u(r.value.discount_type),1)):f("",!0)]),d("div",be,[d("label",xe,[m(u(o(s)("discount.discount_value"))+" ",1),e[11]||(e[11]=d("span",{class:"text-red-500"},"*",-1))]),y(o(ee),{id:"discount_value",modelValue:t.value.discount_value,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.discount_value=l),min:0,max:t.value.discount_type===2?100:null,placeholder:o(s)("discount.enter_discount_value"),class:b(["w-full rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":r.value.discount_value}]),disabled:n.value},null,8,["modelValue","max","placeholder","class","disabled"]),t.value.discount_type===2?(p(),v("small",he,u(o(s)("discount.percentage_note")),1)):f("",!0),r.value.discount_value?(p(),v("small",we,u(r.value.discount_value),1)):f("",!0)]),d("div",Ve,[d("label",ke,[m(u(o(s)("discount.expiration_date"))+" ",1),e[12]||(e[12]=d("span",{class:"text-red-500"},"*",-1))]),y(o(te),{id:"expires_at",modelValue:t.value.expires_at,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.expires_at=l),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:o(s)("discount.select_expiration_date"),class:b(["w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":r.value.expiration_date}]),disabled:n.value,showIcon:!0},null,8,["modelValue","minDate","placeholder","class","disabled"]),r.value.expiration_date?(p(),v("small",$e,u(r.value.expiration_date),1)):f("",!0)])]),d("div",Le,[y(o(S),{type:"button",label:o(s)("discount.cancel"),icon:"pi pi-times",onClick:e[6]||(e[6]=l=>o(k).go(-1)),class:"px-6 mx-2 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:n.value},null,8,["label","disabled"]),y(o(S),{type:"submit",label:o(s)("discount.update_discount"),icon:"pi pi-check",loading:n.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:n.value},{default:X(()=>[n.value?(p(),v("i",Fe)):(p(),v("span",De,u(o(s)("discount.update_discount")),1))]),_:1},8,["label","loading","disabled"])])],32),y(o(se))],8,oe)),[[i,"update discounts"]])}}},Ee=Q(Ce,[["__scopeId","data-v-aaa6f921"]]);export{Ee as default};
