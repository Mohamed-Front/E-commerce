import{_ as Y,l as x,u as I,D as Q,j as T,r as p,n as q,o as A,Q as O,x as z,a as m,c as b,f as r,t as c,e as a,E as y,h as d,v as _,g as G,w as H,B as J,i as V,a1 as C,ag as E,S as K,ah as N,T as S,P as W}from"./index-1f952ef3.js";import{h as X}from"./moment-fbc5633a.js";const Z=["dir"],ee={class:"text-3xl font-bold text-center mb-8 text-gray-800"},te={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},se={class:"space-y-2"},ae={for:"type",class:"block text-sm font-medium text-gray-700"},oe={class:"space-y-2"},re={for:"ids",class:"block text-sm font-medium text-gray-700"},le={key:0,class:"space-y-2"},ie={for:"product_id",class:"block text-sm font-medium text-gray-700"},ue={class:"space-y-2"},de={for:"discount_type",class:"block text-sm font-medium text-gray-700"},ne={class:"space-y-2"},ce={for:"discount_value",class:"block text-sm font-medium text-gray-700"},pe={class:"space-y-2"},ve={for:"expires_at",class:"block text-sm font-medium text-gray-700"},ye={class:"pt-4 flex justify-center space-x-4"},_e={key:0},fe={key:1,class:"pi pi-spinner pi-spin"},ge={__name:"create",setup(me){class U{constructor(e,i){this.errors=e,this.t=i}required(e,i){return!e||Array.isArray(e)&&e.length===0?(this.errors.value[i]=this.t("validation.requiredFields",{field:this.t(`discount.${i}`)}),!1):!0}numericRange(e,i,l,n){return e==null||isNaN(e)?(this.errors.value[i]=this.t("validation.requiredFields",{field:this.t(`discount.${i}`)}),!1):l!==null&&e<l?(this.errors.value[i]=this.t("validation.minValue",{field:this.t(`discount.${i}`),min:l}),!1):n!==null&&e>n?(this.errors.value[i]=this.t("validation.maxValue",{field:this.t(`discount.${i}`),max:n}),!1):!0}isValid(){return Object.keys(this.errors.value).length===0}}const w=x(()=>localStorage.getItem("appLang")||"en"),k=x(()=>w.value==="en"?"name_en":"name_ar"),M=x(()=>w.value==="ar"),D=I(),f=Q(),{t:s}=T(),v=p(!1),L=p([]),g=p([]),$=p(""),F=p(""),u=p({}),t=p({type:"",ids:[],products:[],discount_type:null,discount_value:null,expires_at:null}),h=async()=>{try{const o=await V.get("/api/category",{params:{search:$.value||void 0}});L.value=o.data.data.data}catch(o){console.error("Error fetching categories:",o),f.add({severity:"error",summary:s("error"),detail:s("error.categoryLoad"),life:3e3})}},j=async()=>{try{const o=await V.get("/api/product",{params:{search:F.value||void 0,category_ids:t.value.ids.length>0?t.value.ids.join(","):void 0}});g.value=o.data.data.data}catch(o){console.error("Error fetching products:",o),f.add({severity:"error",summary:s("error"),detail:s("error.productLoad"),life:3e3})}},B=o=>{$.value=o.value,h()},P=o=>{F.value=o.value,j()};q(()=>t.value.type,o=>{t.value.ids=[],t.value.products=[],g.value=[],u.value={},(o==="category"||o==="product")&&h()}),q(()=>t.value.ids,o=>{t.value.type==="product"&&o.length>0?j():(g.value=[],t.value.products=[])},{deep:!0});const R=async()=>{var i,l;u.value={};const o=new U(u,s);if(o.required(t.value.type,"type"),o.required(t.value.ids,"select_category"),t.value.type==="product"&&o.required(t.value.products,"select_product"),o.required(t.value.discount_type,"discount_type"),o.numericRange(t.value.discount_value,"discount_value",0,t.value.discount_type===2?100:null),o.required(t.value.expires_at,"expiration_date"),!o.isValid()){const n=Object.values(u.value).join(", ");f.add({severity:"error",summary:s("error"),detail:n,life:3e3});return}v.value=!0;const e={type:t.value.type,ids:t.value.type==="product"?t.value.products:t.value.ids,discount_type:t.value.discount_type,discount_value:t.value.discount_value,expires_at:X(t.value.expires_at).format("YYYY-MM-DD")};try{await V.post("/api/discount",e),D.push({name:"discount"}),f.add({severity:"success",summary:s("success"),detail:s("discount.created_successfully"),life:3e3})}catch(n){console.error("Error:",n),f.add({severity:"error",summary:s("error"),detail:((l=(i=n.response)==null?void 0:i.data)==null?void 0:l.message)||s("error.createError"),life:3e3})}finally{v.value=!1}};return A(()=>{h()}),(o,e)=>{const i=O("can");return z((m(),b("div",{class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg",dir:M.value?"rtl":"ltr"},[r("h1",ee,c(a(s)("discount.create_new_discount")),1),r("form",{onSubmit:J(R,["prevent"]),class:"space-y-6"},[r("div",te,[r("div",se,[r("label",ae,[y(c(a(s)("discount.type"))+" ",1),e[7]||(e[7]=r("span",{class:"text-red-500"},"*",-1))]),d(a(C),{filter:"",id:"type",modelValue:t.value.type,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.type=l),options:["product","category"],placeholder:a(s)("discount.select_type"),class:_(["w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":u.value.type}])},null,8,["modelValue","placeholder","class"])]),r("div",oe,[r("label",re,[y(c(a(s)("discount.select_category"))+" ",1),e[8]||(e[8]=r("span",{class:"text-red-500"},"*",-1))]),d(a(E),{filter:"",id:"ids",modelValue:t.value.ids,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.ids=l),options:L.value,optionLabel:k.value,optionValue:"id",placeholder:a(s)("discount.searchCategories"),class:_(["w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":u.value.select_category}]),onFilter:B,display:"chip"},null,8,["modelValue","options","optionLabel","placeholder","class"])]),t.value.type==="product"?(m(),b("div",le,[r("label",ie,[y(c(a(s)("discount.select_product"))+" ",1),e[9]||(e[9]=r("span",{class:"text-red-500"},"*",-1))]),d(a(E),{filter:"",id:"product_id",modelValue:t.value.products,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.products=l),options:g.value,optionLabel:k.value,optionValue:"id",placeholder:a(s)("discount.searchProducts"),class:_(["w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":u.value.select_product}]),onFilter:P,display:"chip"},null,8,["modelValue","options","optionLabel","placeholder","class"])])):G("",!0),r("div",ue,[r("label",de,[y(c(a(s)("discount.discount_type"))+" ",1),e[10]||(e[10]=r("span",{class:"text-red-500"},"*",-1))]),d(a(C),{filter:"",id:"discount_type",modelValue:t.value.discount_type,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.discount_type=l),options:[{label:a(s)("discount.fixed_amount"),value:1},{label:a(s)("discount.percentage"),value:2}],optionLabel:"label",optionValue:"value",placeholder:a(s)("discount.select_discount_type"),class:_(["w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":u.value.discount_type}])},null,8,["modelValue","options","placeholder","class"])]),r("div",ne,[r("label",ce,[y(c(a(s)("discount.discount_value"))+" ",1),e[11]||(e[11]=r("span",{class:"text-red-500"},"*",-1))]),d(a(K),{id:"discount_value",modelValue:t.value.discount_value,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.discount_value=l),min:0,max:t.value.discount_type===2?100:null,placeholder:a(s)("discount.enter_discount_value"),class:_(["w-full rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":u.value.discount_value}])},null,8,["modelValue","max","placeholder","class"])]),r("div",pe,[r("label",ve,[y(c(a(s)("discount.expiration_date"))+" ",1),e[12]||(e[12]=r("span",{class:"text-red-500"},"*",-1))]),d(a(N),{id:"expires_at",modelValue:t.value.expires_at,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.expires_at=l),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:a(s)("discount.select_expiration_date"),class:_(["w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"p-invalid":u.value.expiration_date}])},null,8,["modelValue","minDate","placeholder","class"])])]),r("div",ye,[d(a(S),{type:"button",label:a(s)("discount.cancel"),icon:"pi pi-times",onClick:e[6]||(e[6]=l=>a(D).go(-1)),class:"px-6 mx-2 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:v.value},null,8,["label","disabled"]),d(a(S),{type:"submit",label:a(s)("discount.create_discount"),icon:"pi pi-plus",loading:v.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:v.value},{default:H(()=>[v.value?(m(),b("i",fe)):(m(),b("span",_e,c(a(s)("discount.create_discount")),1))]),_:1},8,["label","loading","disabled"])])],32),d(a(W))],8,Z)),[[i,"create discounts"]])}}},xe=Y(ge,[["__scopeId","data-v-8b14c477"]]);export{xe as default};
