import{_ as M,j as z,r as y,H as A,o as D,a as c,c as u,f as e,I as C,R as I,F as q,d as F,q as j,t as o,J as O,h as T,e as H,i as m,K as N}from"./index-4abc91ca.js";const S="/assets/prand 1-7db5856b.png";const U={class:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 font-inter"},J={class:"flex lg:flex-row flex-col gap-10"},K={class:"flex-1 bg-white rounded-2xl shadow-lg p-6"},L={key:0,class:"flex justify-center items-center py-4"},P={key:1},Q={class:"mb-6"},R=["value"],G={class:"flex items-center gap-4 mb-6"},W={key:0,class:"text-center text-gray-600 py-4"},X=["src","alt"],Y={class:"flex flex-col mx-4 gap-2 flex-1"},Z={class:"text-lg font-bold text-gray-800"},ee={class:"text-yellow-600 text-sm"},te={class:"flex items-center justify-between"},se={class:"text-yellow-600 text-sm"},ae={class:"border border-gray-300 p-2 rounded-md flex items-center gap-3"},oe=["onClick"],le={class:"text-sm font-medium"},re=["onClick"],ie=["onClick"],ne={class:"bg-gray-100 p-6 mt-6 rounded-lg shadow-inner"},de={class:"flex flex-col gap-4"},ce={class:"flex justify-between items-center"},ue={class:"text-gray-700"},ye={class:"flex justify-between items-center"},me={class:"text-gray-700"},_e={class:"flex justify-between items-center"},pe={class:"text-gray-700"},ve={class:"flex justify-between items-center"},fe={class:"text-gray-700"},xe=["disabled"],ge={class:"lg:w-1/4 w-full p-6 bg-white rounded-2xl shadow-lg"},we={class:"flex flex-col gap-4"},be={class:"flex justify-between items-center"},he={class:"text-gray-700"},ke={class:"flex justify-between items-center"},Ce={class:"text-gray-700"},qe={class:"flex justify-between items-center"},Fe={class:"text-gray-700"},je={class:"flex flex-col mt-6"},Ee=["disabled"],$e={__name:"cart",setup(Ve){z();const _=y(""),r=y([]),g=y(!0),l=A(),v=y([]),d=y(null),p=y(!1),i=y({delivery:0,time:0,coupon:0,order_tax:0,order_without_tax:0,total:0}),E=async()=>{try{const a=await m.get("/api/address");a.data.is_success&&(v.value=a.data.data.data,v.value.length>0&&(d.value=v.value[0].id))}catch(a){l.add({severity:"error",summary:"خطأ",detail:"فشل تحميل العناوين",life:3e3}),console.error("Error fetching addresses:",a)}},$=async()=>{try{g.value=!0;const a=await m.get("/api/cart");a.data.is_success&&(r.value=a.data.data.items.map(t=>({id:t.id,product_id:t.product.id,variant_id:t.variant.id,name:t.product.name_ar||t.product.name_en,img:t.product.key_default_image||S,price:parseFloat(t.variant.price)||parseFloat(t.product.base_price)||0,quantity:t.quantity})),await f())}catch(a){l.add({severity:"error",summary:"خطأ",detail:"فشل تحميل بيانات سلة التسوق",life:3e3}),console.error("Error fetching cart:",a)}finally{g.value=!1}},f=async()=>{try{const a={is_expressed:p.value,address_id:d.value,view:!0,items:r.value.map(s=>({product_id:s.product_id,variant_id:s.variant_id,quantity:s.quantity}))};_.value&&(a.coupon=_.value);const t=await m.post("/api/order/view",a);t.data.is_success&&(i.value={delivery:parseFloat(t.data.data.delivery||0).toFixed(2),time:t.data.data.time||0,coupon:parseFloat(t.data.data.coupon||0).toFixed(2),order_tax:parseFloat(t.data.data.order_tax||0).toFixed(2),order_without_tax:parseFloat(t.data.data.order_without_tax||0).toFixed(2),total:parseFloat(t.data.data.total||0).toFixed(2)})}catch(a){l.add({severity:"error",summary:"خطأ",detail:"فشل تحميل إجمالي الطلب",life:3e3}),console.error("Error fetching order totals:",a)}},V=async()=>{try{await f(),l.add({severity:"success",summary:"نجاح",detail:"تم تطبيق كود الخصم",life:3e3})}catch(a){l.add({severity:"error",summary:"خطأ",detail:"فشل تطبيق كود الخصم",life:3e3}),console.error("Error applying coupon:",a)}},b=async(a,t,s,n,k)=>{const x=r.value.find(w=>w.id===t);if(x)try{a==="plus"?(await m.post("/api/cart/update",{product_id:s,variant_id:n,quantity:k+1}),x.quantity+=1):a==="minus"&&x.quantity>1&&(await m.post("/api/cart/update",{product_id:s,variant_id:n,quantity:k-1}),x.quantity-=1),await f()}catch(w){l.add({severity:"error",summary:"خطأ",detail:`فشل ${a==="plus"?"زيادة":"تقليل"} الكمية`,life:3e3}),console.error(`Error ${a==="plus"?"increasing":"decreasing"} quantity:`,w)}},B=async(a,t,s)=>{try{await m.delete("/api/cart/clear",{data:{product_id:t,variant_id:s}}),r.value=r.value.filter(n=>n.id!==a),await f(),l.add({severity:"success",summary:"نجاح",detail:"تم إزالة المنتج من السلة",life:3e3})}catch(n){l.add({severity:"error",summary:"خطأ",detail:"فشل إزالة المنتج من السلة",life:3e3}),console.error("Error clearing product:",n)}},h=async()=>{if(!d.value){l.add({severity:"error",summary:"خطأ",detail:"يرجى اختيار عنوان للتوصيل",life:3e3});return}try{const a={is_expressed:p.value,address_id:d.value,items:r.value.map(s=>({product_id:s.product_id,variant_id:s.variant_id,quantity:s.quantity}))};if(_.value&&(a.coupon=_.value),(await m.post("/api/order",a)).data.is_success)r.value=[],i.value={delivery:0,time:0,coupon:0,order_tax:0,order_without_tax:0,total:0},l.add({severity:"success",summary:"نجاح",detail:"تم إرسال الطلب بنجاح",life:3e3});else throw new Error("Order submission failed")}catch(a){l.add({severity:"error",summary:"خطأ",detail:"فشل إرسال الطلب",life:3e3}),console.error("Error submitting order:",a)}};return D(()=>{E(),$()}),(a,t)=>(c(),u("div",U,[e("div",J,[e("section",K,[g.value?(c(),u("div",L,t[3]||(t[3]=[e("svg",{class:"animate-spin h-8 w-8 text-yellow-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):(c(),u("div",P,[e("div",Q,[t[5]||(t[5]=e("h3",{class:"text-lg font-semibold text-gray-800 mb-2"},"اختر عنوان التوصيل",-1)),C(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>d.value=s),class:"w-full bg-amber-50 border border-amber-200 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-600 transition-all"},[t[4]||(t[4]=e("option",{value:null,disabled:""},"اختر عنوان",-1)),(c(!0),u(q,null,F(v.value,s=>(c(),u("option",{key:s.id,value:s.id},o(s.name)+" - "+o(s.street)+", "+o(s.city),9,R))),128))],512),[[I,d.value]])]),e("div",G,[t[6]||(t[6]=e("label",{class:"text-gray-800 font-medium"},"توصيل سريع",-1)),e("button",{onClick:t[1]||(t[1]=s=>p.value=!p.value),class:j(["relative inline-flex items-center h-6 rounded-full w-11 transition-colors duration-200",p.value?"bg-yellow-600":"bg-gray-300"]),style:{direction:"ltr"}},[e("span",{class:j(["inline-block w-4 h-4 transform bg-white rounded-full transition-transform duration-200",p.value?"translate-x-6":"translate-x-1"])},null,2)],2)]),r.value.length===0?(c(),u("div",W," سلة التسوق فارغة ")):(c(!0),u(q,{key:1},F(r.value,s=>(c(),u("div",{key:s.id,class:"flex items-center mt-6 bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300"},[e("img",{src:s.img,alt:s.name,class:"w-16 h-16 md:w-20 md:h-20 lg:w-28 lg:h-28 object-cover rounded-md border border-gray-800"},null,8,X),e("div",Y,[e("h3",Z,o(s.name),1),e("p",ee,"السعر: "+o(s.price)+" د.أ",1),e("div",te,[e("p",se,"الكمية: "+o(s.quantity),1),e("div",ae,[e("button",{onClick:n=>b("minus",s.id,s.product_id,s.variant_id,s.quantity),class:"text-lg font-semibold text-gray-700 hover:text-yellow-600 transition-colors"},"-",8,oe),e("span",le,o(s.quantity),1),e("button",{onClick:n=>b("plus",s.id,s.product_id,s.variant_id,s.quantity),class:"text-lg font-semibold text-gray-700 hover:text-yellow-600 transition-colors"},"+",8,re)]),e("button",{onClick:n=>B(s.id,s.product_id,s.variant_id),class:"text-white bg-yellow-600 px-3 py-1 text-sm rounded-md hover:bg-yellow-700 transition-all"},o(a.$t("remove")),9,ie)])])]))),128)),e("div",ne,[e("div",de,[e("span",ce,[t[7]||(t[7]=e("h4",{class:"text-yellow-600 font-semibold"},"مدة الشحن",-1)),e("p",ue,o(i.value.time)+" ساعات",1)]),e("span",ye,[t[8]||(t[8]=e("h4",{class:"text-yellow-600 font-semibold"},"المجموع الفرعي",-1)),e("p",me,o(i.value.order_without_tax)+" د.أ",1)]),e("span",_e,[t[9]||(t[9]=e("h4",{class:"text-yellow-600 font-semibold"},"الضريبة",-1)),e("p",pe,o(i.value.order_tax)+" د.أ",1)]),e("span",ve,[t[10]||(t[10]=e("h4",{class:"text-yellow-600 font-semibold"},"الإجمالي",-1)),e("p",fe,o(i.value.total)+" د.أ",1)])]),e("button",{disabled:!d.value,onClick:h,class:"w-full mt-6 py-3 text-sm sm:text-base lg:text-lg bg-gray-800 rounded-md text-white font-semibold transition-transform duration-150 hover:shadow-lg active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed"}," إتمام الشراء ",8,xe)])]))]),e("section",ge,[e("div",we,[e("span",be,[t[11]||(t[11]=e("h4",{class:"text-yellow-600 font-semibold"},"المجموع الفرعي",-1)),e("p",he,o(i.value.order_without_tax)+" د.أ",1)]),e("span",ke,[t[12]||(t[12]=e("h4",{class:"text-yellow-600 font-semibold"},"الضريبة",-1)),e("p",Ce,o(i.value.order_tax)+" د.أ",1)]),e("span",qe,[t[13]||(t[13]=e("h4",{class:"text-yellow-600 font-semibold"},"الإجمالي",-1)),e("p",Fe,o(i.value.total)+" د.أ",1)])]),e("div",je,[C(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>_.value=s),type:"text",placeholder:"كود الخصم",class:"bg-amber-50 placeholder-yellow-600 border border-amber-200 rounded-md w-full px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-600 transition-all"},null,512),[[O,_.value]]),e("button",{onClick:V,class:"w-full mt-4 py-2 text-sm bg-amber-100 rounded-md text-yellow-600 font-semibold hover:bg-amber-200 transition-all active:scale-95"}," تطبيق "),e("button",{disabled:!d.value,onClick:h,class:"w-full mt-4 py-2 text-sm bg-gray-800 rounded-md text-white font-semibold hover:shadow-lg transition-all active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed"}," إتمام الشراء الكلي ",8,Ee)])])]),T(H(N))]))}},Me=M($e,[["__scopeId","data-v-48a47dc8"]]);export{Me as default};
