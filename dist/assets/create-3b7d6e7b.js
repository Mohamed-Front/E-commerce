import{_ as J,u as K,k as W,D as X,j as Y,r as d,l as Z,n as R,o as ee,Q as ae,a as u,c,x as te,f as a,t as i,e as o,E as y,h as g,g as re,B as p,v as I,w as oe,F as le,i as P,R as N,a1 as S,T as O,P as se}from"./index-5ecb99ce.js";import{l as ne}from"./lodash-ceb3546b.js";const ie={class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg"},de={class:"text-3xl font-bold text-center mb-8 text-gray-800"},ue={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ce={class:"space-y-2"},pe={for:"name_en",class:"block text-sm font-medium text-gray-700"},ge={class:"space-y-2"},me={for:"name_ar",class:"block text-sm font-medium text-gray-700"},ve={class:"space-y-2"},_e={for:"parent_id",class:"block text-sm font-medium text-gray-700"},be={class:"space-y-2"},ye={for:"store_id",class:"block text-sm font-medium text-gray-700"},fe={key:0,class:"space-y-2"},he={for:"market_id",class:"block text-sm font-medium text-gray-700"},xe={class:"space-y-2"},ke={class:"block text-sm font-medium text-gray-700"},we={class:"flex justify-center"},De={key:0,class:"p-4 w-full h-full"},Pe={class:"relative group w-full h-full"},Ve=["src","alt"],je={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 flex items-center justify-center transition-all duration-300 rounded-lg"},Ee={key:1,class:"p-4 flex flex-col items-center justify-center"},Ce={class:"text-sm text-center text-gray-600"},Te={class:"text-blue-500 font-medium"},$e={class:"space-y-2"},Ie={class:"block text-sm font-medium text-gray-700"},Se={class:"flex justify-center"},Le={key:0,class:"p-4 w-full h-full"},Ue={class:"relative group w-full h-full"},Be=["src","alt"],Fe={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 flex items-center justify-center transition-all duration-300 rounded-lg"},Me={key:1,class:"p-4 flex flex-col items-center justify-center"},Ae={class:"text-sm text-center text-gray-600"},Re={class:"text-blue-500 font-medium"},Ne={class:"space-y-2 md:col-span-2"},Oe={class:"block text-sm font-medium text-gray-700"},qe={class:"flex justify-center"},Qe={key:0,class:"p-4 w-full h-full"},ze={class:"relative group w-full h-full"},Ge=["src","alt"],He={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 flex items-center justify-center transition-all duration-300 rounded-lg"},Je={key:1,class:"p-4 flex flex-col items-center justify-center"},Ke={class:"text-sm text-center text-gray-600"},We={class:"text-blue-500 font-medium"},Xe={class:"pt-4 flex justify-center space-x-4"},Ye={key:0},Ze={key:1,class:"pi pi-spinner pi-spin"},ea={__name:"create",setup(aa){const q=K(),m=W(),v=X(),{t:r}=Y(),_=d(!1),V=d(""),C=Z(()=>localStorage.getItem("appLang")=="ar"?"name_ar":"name_en"),s=d({name_en:"",name_ar:"",linked_to_market:!1,market_id:null,parent_id:null,store_id:null,image:null,banner_one_image:null,banner_two_image:null}),f=d(null),h=d(null),x=d(null),L=d([]),U=d([]),B=d([]),k=d(!1),w=d(!1),D=d(!1),T=async()=>{try{const l=s.value.linked_to_market?"/api/market":"/api/category",e=await P.get(l,{params:{search:V.value||void 0}});L.value=e.data.data.data.map(n=>({...n,label:localStorage.getItem("appLang")=="ar"?n.name_ar:n.name_en,value:n.id}))}catch(l){console.error("Error fetching parent categories:",l),v.add({severity:"error",summary:r("error"),detail:s.value.linked_to_market?r("category.fetchMarketsError"):r("category.fetchParentError"),life:3e3})}},F=ne.debounce(T,300),Q=l=>{V.value=l.value,F()},M=async()=>{try{const l=await P.get("/api/market",{params:{search:V.value||void 0}});U.value=l.data.data.data.map(e=>({...e,label:localStorage.getItem("appLang")=="ar"?e.name_ar:e.name_en,value:e.id}))}catch(l){console.error("Error fetching markets:",l),v.add({severity:"error",summary:r("error"),detail:r("category.fetchMarketsError"),life:3e3})}},A=async()=>{try{const l=await P.get("/api/store");B.value=l.data.data.data.map(e=>({...e,label:localStorage.getItem("appLang")=="ar"?e.name_ar:e.name_en,value:e.id}))}catch(l){console.error("Error fetching stores:",l),v.add({severity:"error",summary:r("error"),detail:r("category.fetchStoresError"),life:3e3})}},z=async l=>{try{const n=(await P.get(`/api/category/${l}`)).data.data;s.value={name_en:n.name_en||"",name_ar:n.name_ar||"",linked_to_market:!!n.linked_to_market,market_id:n.market_id||null,parent_id:n.parent_id||null,store_id:n.store_id||null,image:null,banner_one_image:null,banner_two_image:null},n.media.forEach(t=>{t.name==="category_image"?f.value=t.url:t.name==="banner_one_image"?h.value=t.url:t.name==="banner_two_image"&&(x.value=t.url)})}catch(e){console.error("Error fetching category data:",e),v.add({severity:"error",summary:r("error"),detail:r("category.fetchError"),life:3e3})}},G=(l,e)=>{const n=new FileReader;n.onload=t=>{switch(e){case"image":s.value.image=l,f.value=t.target.result,k.value=!1;break;case"banner_one":s.value.banner_one_image=l,h.value=t.target.result,w.value=!1;break;case"banner_two":s.value.banner_two_image=l,x.value=t.target.result,D.value=!1;break}},n.readAsDataURL(l)},b=(l,e)=>{var t,j,E;const n=((t=l.target.files)==null?void 0:t[0])||((E=(j=l.dataTransfer)==null?void 0:j.files)==null?void 0:E[0]);n&&n.type.match("image.*")&&G(n,e)},$=l=>{switch(l){case"image":s.value.image=null,f.value=null;break;case"banner_one":s.value.banner_one_image=null,h.value=null;break;case"banner_two":s.value.banner_two_image=null,x.value=null;break}},H=async()=>{var e,n;_.value=!0;const l=new FormData;l.append("name_en",s.value.name_en),l.append("name_ar",s.value.name_ar),l.append("linked_to_market",s.value.linked_to_market?"1":"0"),l.append("market_id",s.value.market_id||""),l.append("parent_id",s.value.parent_id||""),l.append("store_id",s.value.store_id||""),s.value.image&&l.append("image",s.value.image),s.value.banner_one_image&&l.append("banner_one_image",s.value.banner_one_image),s.value.banner_two_image&&l.append("banner_two_image",s.value.banner_two_image);try{const t=m.params.id,j="post",E=t?`/api/category/${t}`:"/api/category";t&&l.append("_method","PUT");const ta=await P[j](E,l,{headers:{"Content-Type":"multipart/form-data"}});v.add({severity:"success",summary:r("success"),detail:r(t?"category.updateSuccess":"category.createSuccess"),life:3e3})}catch(t){console.error("Error:",t),v.add({severity:"error",summary:r("error"),detail:((n=(e=t.response)==null?void 0:e.data)==null?void 0:n.message)||(m.params.id?r("category.updateError"):r("category.createError")),life:3e3})}finally{_.value=!1}};return R([()=>s.value.linked_to_market,V],()=>{s.value.parent_id=null,F()}),R(()=>localStorage.getItem("appLang"),()=>{T(),M(),A()}),ee(async()=>{await Promise.all([M(),T(),A()]);const l=m.params.id;l&&await z(l)}),(l,e)=>{const n=ae("can");return u(),c(le,null,[te((u(),c("div",ie,[a("h1",de,i(o(m).params.id?o(r)("category.updateTitle"):o(r)("category.createTitle")),1),a("form",{onSubmit:p(H,["prevent"]),class:"space-y-6"},[a("div",ue,[a("div",ce,[a("label",pe,[y(i(o(r)("category.nameEn"))+" ",1),e[21]||(e[21]=a("span",{class:"text-red-500"},"*",-1))]),g(o(N),{id:"name_en",modelValue:s.value.name_en,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.name_en=t),placeholder:o(r)("category.nameEnPlaceholder"),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:""},null,8,["modelValue","placeholder"])]),a("div",ge,[a("label",me,[y(i(o(r)("category.nameAr"))+" ",1),e[22]||(e[22]=a("span",{class:"text-red-500"},"*",-1))]),g(o(N),{id:"name_ar",modelValue:s.value.name_ar,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.name_ar=t),placeholder:o(r)("category.nameArPlaceholder"),dir:"rtl",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:""},null,8,["modelValue","placeholder"])]),a("div",ve,[a("label",_e,i(s.value.linked_to_market?o(r)("category.market"):o(r)("category.parent")),1),g(o(S),{modelValue:s.value.parent_id,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.parent_id=t),options:L.value,optionLabel:C.value,optionValue:"id",placeholder:s.value.linked_to_market?o(r)("category.selectMarket"):o(r)("category.selectParent"),class:"w-full",filter:"",filterPlaceholder:s.value.linked_to_market?o(r)("category.searchMarkets"):o(r)("category.searchParent"),onFilter:Q},null,8,["modelValue","options","optionLabel","placeholder","filterPlaceholder"])]),a("div",be,[a("label",ye,i(o(r)("category.store")),1),g(o(S),{modelValue:s.value.store_id,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.store_id=t),options:B.value,optionLabel:C.value,optionValue:"id",placeholder:o(r)("category.selectStore"),class:"w-full",filter:"",filterPlaceholder:o(r)("category.searchStores")},null,8,["modelValue","options","optionLabel","placeholder","filterPlaceholder"])]),s.value.linked_to_market?(u(),c("div",fe,[a("label",he,[y(i(o(r)("category.market"))+" ",1),e[23]||(e[23]=a("span",{class:"text-red-500"},"*",-1))]),g(o(S),{modelValue:s.value.market_id,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.market_id=t),options:U.value,optionLabel:C.value,optionValue:"id",placeholder:o(r)("category.selectMarket"),class:"w-full",filter:"",filterPlaceholder:o(r)("category.searchMarkets")},null,8,["modelValue","options","optionLabel","placeholder","filterPlaceholder"])])):re("",!0),a("div",xe,[a("label",ke,i(o(r)("category.image")),1),a("div",we,[a("label",{onDragover:e[7]||(e[7]=p(t=>k.value=!0,["prevent"])),onDragleave:e[8]||(e[8]=t=>k.value=!1),onDrop:e[9]||(e[9]=p(t=>b(t,"image"),["prevent"])),class:I([{"border-blue-500 bg-blue-50":k.value,"border-gray-300":!k.value},"cursor-pointer w-full h-48 rounded-xl border-2 border-dashed transition-colors duration-300 flex items-center justify-center"])},[a("input",{type:"file",onChange:e[5]||(e[5]=t=>b(t,"image")),accept:"image/*",class:"hidden"},null,32),f.value?(u(),c("div",De,[a("div",Pe,[a("img",{src:f.value,alt:o(r)("category.imagePreview"),class:"w-full h-full object-contain rounded-lg shadow-md transition-transform duration-300 group-hover:scale-105"},null,8,Ve),a("div",je,[a("button",{type:"button",onClick:e[6]||(e[6]=p(t=>$("image"),["stop"])),class:"opacity-0 group-hover:opacity-100 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition"},e[24]||(e[24]=[a("i",{class:"pi pi-trash text-sm"},null,-1)]))])])])):(u(),c("div",Ee,[e[25]||(e[25]=a("div",{class:"bg-blue-100 p-3 rounded-full mb-2"},[a("i",{class:"pi pi-image text-blue-500 text-xl"})],-1)),a("p",Ce,[a("span",Te,i(o(r)("category.clickToUpload")),1),y(" "+i(o(r)("category.orDragAndDrop")),1)])]))],34)])]),a("div",$e,[a("label",Ie,i(o(r)("category.bannerOne")),1),a("div",Se,[a("label",{onDragover:e[12]||(e[12]=p(t=>w.value=!0,["prevent"])),onDragleave:e[13]||(e[13]=t=>w.value=!1),onDrop:e[14]||(e[14]=p(t=>b(t,"banner_one"),["prevent"])),class:I([{"border-blue-500 bg-blue-50":w.value,"border-gray-300":!w.value},"cursor-pointer w-full h-48 rounded-xl border-2 border-dashed transition-colors duration-300 flex items-center justify-center"])},[a("input",{type:"file",onChange:e[10]||(e[10]=t=>b(t,"banner_one")),accept:"image/*",class:"hidden"},null,32),h.value?(u(),c("div",Le,[a("div",Ue,[a("img",{src:h.value,alt:o(r)("category.bannerOnePreview"),class:"w-full h-full object-contain rounded-lg shadow-md transition-transform duration-300 group-hover:scale-105"},null,8,Be),a("div",Fe,[a("button",{type:"button",onClick:e[11]||(e[11]=p(t=>$("banner_one"),["stop"])),class:"opacity-0 group-hover:opacity-100 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition"},e[26]||(e[26]=[a("i",{class:"pi pi-trash text-sm"},null,-1)]))])])])):(u(),c("div",Me,[e[27]||(e[27]=a("div",{class:"bg-blue-100 p-3 rounded-full mb-2"},[a("i",{class:"pi pi-image text-blue-500 text-xl"})],-1)),a("p",Ae,[a("span",Re,i(o(r)("category.clickToUpload")),1),y(" "+i(o(r)("category.orDragAndDrop")),1)])]))],34)])]),a("div",Ne,[a("label",Oe,i(o(r)("category.bannerTwo")),1),a("div",qe,[a("label",{onDragover:e[17]||(e[17]=p(t=>D.value=!0,["prevent"])),onDragleave:e[18]||(e[18]=t=>D.value=!1),onDrop:e[19]||(e[19]=p(t=>b(t,"banner_two"),["prevent"])),class:I([{"border-blue-500 bg-blue-50":D.value,"border-gray-300":!D.value},"cursor-pointer w-full max-w-2xl h-48 rounded-xl border-2 border-dashed transition-colors duration-300 flex items-center justify-center"])},[a("input",{type:"file",onChange:e[15]||(e[15]=t=>b(t,"banner_two")),accept:"image/*",class:"hidden"},null,32),x.value?(u(),c("div",Qe,[a("div",ze,[a("img",{src:x.value,alt:o(r)("category.bannerTwoPreview"),class:"w-full h-full object-contain rounded-lg shadow-md transition-transform duration-300 group-hover:scale-105"},null,8,Ge),a("div",He,[a("button",{type:"button",onClick:e[16]||(e[16]=p(t=>$("banner_two"),["stop"])),class:"opacity-0 group-hover:opacity-100 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition"},e[28]||(e[28]=[a("i",{class:"pi pi-trash text-sm"},null,-1)]))])])])):(u(),c("div",Je,[e[29]||(e[29]=a("div",{class:"bg-blue-100 p-3 rounded-full mb-2"},[a("i",{class:"pi pi-image text-blue-500 text-xl"})],-1)),a("p",Ke,[a("span",We,i(o(r)("category.clickToUpload")),1),y(" "+i(o(r)("category.orDragAndDrop")),1)])]))],34)])])]),a("div",Xe,[g(o(O),{type:"button",label:o(r)("cancel"),icon:"pi pi-times",onClick:e[20]||(e[20]=t=>o(q).go(-1)),class:"px-6 py-3 mx-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:_.value},null,8,["label","disabled"]),g(o(O),{type:"submit",label:o(m).params.id?o(r)("category.updateButton"):o(r)("category.createButton"),icon:"pi pi-plus",loading:_.value,class:"px-8 mx-2 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:_.value},{default:oe(()=>[_.value?(u(),c("i",Ze)):(u(),c("span",Ye,i(o(m).params.id?o(r)("category.updateButton"):o(r)("category.createButton")),1))]),_:1},8,["label","loading","disabled"])])],32)])),[[n,"create categories"]]),g(o(se))],64)}}},la=J(ea,[["__scopeId","data-v-a679781a"]]);export{la as default};
