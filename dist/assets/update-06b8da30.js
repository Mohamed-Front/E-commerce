import{_ as te,l as $,k as se,u as oe,M as ae,j as re,r as _,n as k,o as le,a3 as v,a as i,c as n,f as o,t as a,h as p,w as P,v as de,F as ue,i as g,O as f,g as m,e as ie}from"./index-dfefc3a0.js";import{h as ne}from"./moment-fbc5633a.js";const ce={class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg"},pe={class:"text-3xl font-bold text-center mb-8 text-gray-800"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ye={class:"space-y-2"},_e={for:"type",class:"block text-sm font-medium text-gray-700"},ve={key:0,class:"text-red-500 text-xs"},ge={class:"space-y-2"},fe={for:"ids",class:"block text-sm font-medium text-gray-700"},be={key:0,class:"text-red-500 text-xs"},xe={key:0,class:"space-y-2"},he={for:"product_id",class:"block text-sm font-medium text-gray-700"},we={key:0,class:"text-red-500 text-xs"},Ve={class:"space-y-2"},$e={for:"discount_type",class:"block text-sm font-medium text-gray-700"},ke={key:0,class:"text-red-500 text-xs"},De={class:"space-y-2"},Ce={for:"discount_value",class:"block text-sm font-medium text-gray-700"},Fe={key:0,class:"text-gray-500 text-xs"},Ue={key:1,class:"text-red-500 text-xs"},Ee={class:"space-y-2"},Ie={for:"expires_at",class:"block text-sm font-medium text-gray-700"},Me={key:0,class:"text-red-500 text-xs"},qe={class:"pt-4 flex justify-center space-x-4"},Le={key:0},Ne={key:1,class:"pi pi-spinner pi-spin"},Be={__name:"update",setup(Se){const O=$(()=>localStorage.getItem("appLang")||"en"),D=$(()=>O.value==="en"?"name_en":"name_ar"),R=se(),w=oe(),b=ae(),{t:c}=re(),r=_(),l=_(!1),z=_([]),x=_([]),h=_([]),C=_(R.params.id),s=_({products:[],ids:[],type:"",discount_type:null,discount_value:"",expires_at:null}),G=$(()=>x.value.map(t=>({id:t.id,name:t[D.value]||t.name_en||t.name_ar||"Unnamed Category"}))),H=async()=>{try{const e=(await g.get(`/api/discount/${C.value}`)).data.data;s.value={ids:Array.isArray(e.ids)?e.ids:[],type:e.type||"",discount_type:e.discount_type||null,discount_value:parseFloat(e.discount_value)||"",expires_at:e.expires_at?new Date(e.expires_at):null,products:e.type==="product"?Array.isArray(e.ids)?e.ids:[]:[]},e.type==="product"&&e.ids.length>0?(await V(),await J(e.ids[0])):e.type==="category"&&(await V(),s.value.ids=e.ids.filter(u=>x.value.some(y=>y.id===u)))}catch(t){console.error("Error fetching discount:",t),b.add({severity:"error",summary:c("error"),detail:c("error_fetching_discount"),life:3e3}),w.push({name:"discount"})}},J=async t=>{try{const u=(await g.get(`/api/product/${t}`)).data.data;u.category_id&&(s.value.ids=[u.category_id],await F([u.category_id]))}catch(e){console.error("Error fetching product category:",e)}},V=async()=>{try{const t=await g.get("api/category");x.value=t.data.data.data||[]}catch(t){console.error("Error fetching categories:",t),b.add({severity:"error",summary:c("error"),detail:c("error_fetching_categories"),life:3e3})}},F=async t=>{try{const e=await g.post("api/category/products",{ids:t});h.value=e.data.data||[]}catch(e){console.error("Error fetching products:",e)}};k(()=>s.value.type,t=>{s.value.ids=[],s.value.products=[],h.value=[],(t==="category"||t==="product")&&V()}),k(()=>s.value.ids,t=>{s.value.type==="product"&&t.length>0?F(t):h.value=[]},{deep:!0}),k(x,()=>{s.value.type==="category"&&s.value.ids.length>0&&(s.value.ids=s.value.ids.filter(t=>x.value.some(e=>e.id===t)))},{deep:!0});const K=async()=>{try{const t=await g.get("api/model");z.value=t.data.data.data||[]}catch(t){console.error("Error fetching models:",t),b.add({severity:"error",summary:c("error"),detail:c("error_fetching_models"),life:3e3})}},Q=async()=>{var e,u;l.value=!0;const t={expires_at:s.value.expires_at?ne(s.value.expires_at).format("YYYY-MM-DD"):null,discount_value:s.value.discount_value,discount_type:s.value.discount_type,type:s.value.type,ids:s.value.type==="product"?s.value.products:s.value.ids,_method:"PUT"};try{await g.post(`/api/discount/${C.value}`,t),w.push({name:"discount"}),b.add({severity:"success",summary:c("success"),detail:c("discount.updated_successfully"),life:3e3})}catch(y){console.error("Error:",y),b.add({severity:"error",summary:c("error"),detail:((u=(e=y.response)==null?void 0:e.data)==null?void 0:u.message)||c("error_occurred"),life:3e3})}finally{l.value=!1}};return le(()=>{K(),H()}),(t,e)=>{const u=v("Dropdown"),y=v("MultiSelect"),W=v("InputNumber"),X=v("Calendar"),U=v("Button"),Z=v("Form"),ee=v("Toast");return i(),n(ue,null,[o("div",ce,[o("h1",pe,a(t.$t("discount.update_discount")),1),p(Z,{onSubmit:de(Q,["prevent"]),class:"space-y-6"},{default:P(()=>{var E,I,M,q,L,N,B,S,j,A,T,Y;return[o("div",me,[o("div",ye,[o("label",_e,[f(a(t.$t("discount.type"))+" ",1),e[7]||(e[7]=o("span",{class:"text-red-500"},"*",-1))]),p(u,{filter:"",id:"type",modelValue:s.value.type,"onUpdate:modelValue":e[0]||(e[0]=d=>s.value.type=d),options:["product","category"],placeholder:t.$t("discount.select_type"),class:"w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:"",disabled:l.value},null,8,["modelValue","placeholder","disabled"]),(I=(E=r.value)==null?void 0:E.errors)!=null&&I.type?(i(),n("small",ve,a(r.value.errors.type[0]),1)):m("",!0)]),o("div",ge,[o("label",fe,[f(a(t.$t(s.value.type==="product"?"discount.select_category":"discount.select_model"))+" ",1),e[8]||(e[8]=o("span",{class:"text-red-500"},"*",-1))]),p(y,{filter:"",id:"ids",modelValue:s.value.ids,"onUpdate:modelValue":e[1]||(e[1]=d=>s.value.ids=d),options:G.value,optionLabel:"name",optionValue:"id",placeholder:t.$t(s.value.type==="product"?"discount.select_category":"discount.select_model"),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:"",disabled:l.value||!s.value.type},null,8,["modelValue","options","placeholder","disabled"]),(q=(M=r.value)==null?void 0:M.errors)!=null&&q.ids?(i(),n("small",be,a(r.value.errors.ids[0]),1)):m("",!0)]),s.value.type==="product"?(i(),n("div",xe,[o("label",he,[f(a(t.$t("discount.select_product"))+" ",1),e[9]||(e[9]=o("span",{class:"text-red-500"},"*",-1))]),p(y,{filter:"",id:"product_id",modelValue:s.value.products,"onUpdate:modelValue":e[2]||(e[2]=d=>s.value.products=d),options:h.value,optionLabel:D.value,optionValue:"id",placeholder:t.$t("discount.select_product"),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:"",disabled:l.value||s.value.ids.length===0},null,8,["modelValue","options","optionLabel","placeholder","disabled"]),(N=(L=r.value)==null?void 0:L.errors)!=null&&N.products?(i(),n("small",we,a(r.value.errors.products[0]),1)):m("",!0)])):m("",!0),o("div",Ve,[o("label",$e,[f(a(t.$t("discount.discount_type"))+" ",1),e[10]||(e[10]=o("span",{class:"text-red-500"},"*",-1))]),p(u,{filter:"",id:"discount_type",modelValue:s.value.discount_type,"onUpdate:modelValue":e[3]||(e[3]=d=>s.value.discount_type=d),options:[{label:t.$t("discount.fixed_amount"),value:1},{label:t.$t("discount.percentage"),value:2}],optionLabel:"label",optionValue:"value",placeholder:t.$t("discount.select_discount_type"),class:"w-full border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:"",disabled:l.value},null,8,["modelValue","options","placeholder","disabled"]),(S=(B=r.value)==null?void 0:B.errors)!=null&&S.discount_type?(i(),n("small",ke,a(r.value.errors.discount_type[0]),1)):m("",!0)]),o("div",De,[o("label",Ce,[f(a(t.$t("discount.discount_value"))+" ",1),e[11]||(e[11]=o("span",{class:"text-red-500"},"*",-1))]),p(W,{id:"discount_value",modelValue:s.value.discount_value,"onUpdate:modelValue":e[4]||(e[4]=d=>s.value.discount_value=d),min:0,max:s.value.discount_type===2?100:null,placeholder:t.$t("discount.enter_discount_value"),class:"w-full px-4 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:"",disabled:l.value},null,8,["modelValue","max","placeholder","disabled"]),s.value.discount_type===2?(i(),n("small",Fe,a(t.$t("discount.percentage_note")),1)):m("",!0),(A=(j=r.value)==null?void 0:j.errors)!=null&&A.discount_value?(i(),n("small",Ue,a(r.value.errors.discount_value[0]),1)):m("",!0)]),o("div",Ee,[o("label",Ie,[f(a(t.$t("discount.expiration_date"))+" ",1),e[12]||(e[12]=o("span",{class:"text-red-500"},"*",-1))]),p(X,{id:"expires_at",modelValue:s.value.expires_at,"onUpdate:modelValue":e[5]||(e[5]=d=>s.value.expires_at=d),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:t.$t("discount.select_expiration_date"),class:"w-full border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:"",disabled:l.value,showIcon:!0,inputId:"expires_at_input"},null,8,["modelValue","minDate","placeholder","disabled"]),(Y=(T=r.value)==null?void 0:T.errors)!=null&&Y.expires_at?(i(),n("small",Me,a(r.value.errors.expires_at[0]),1)):m("",!0)])]),o("div",qe,[p(U,{type:"button",label:t.$t("discount.cancel"),icon:"pi pi-times",onClick:e[6]||(e[6]=d=>ie(w).go(-1)),class:"px-6 mx-2 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:l.value},null,8,["label","disabled"]),p(U,{type:"submit",label:t.$t("discount.update_discount"),icon:"pi pi-check",loading:l.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:l.value},{default:P(()=>[l.value?(i(),n("i",Ne)):(i(),n("span",Le,a(t.$t("discount.update_discount")),1))]),_:1},8,["label","loading","disabled"])])]}),_:1})]),p(ee)],64)}}},Te=te(Be,[["__scopeId","data-v-89dea64c"]]);export{Te as default};
