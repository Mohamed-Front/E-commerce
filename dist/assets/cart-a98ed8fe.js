import{_ as P,j as U,r as c,I as H,l as V,n as I,o as J,a as l,c as r,f as s,F as b,d as k,J as M,S as K,x as E,t as o,K as Q,h as G,e as R,i as f,g as W,L as X}from"./index-79de6106.js";const Y={class:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 font-inter"},Z={class:"flex lg:flex-row flex-col gap-10"},O={class:"flex-1 bg-white rounded-2xl shadow-lg p-6"},ee={key:0,class:"flex justify-center items-center py-4"},te={key:1},se={class:"mb-6"},ae={class:"flex flex-wrap gap-2 mb-4"},oe=["onClick"],le={class:"mb-6"},re=["value"],ie={class:"flex items-center gap-4 mb-6"},ne={key:0,class:"text-center text-gray-600 py-4"},de={key:1},ue=["src","alt"],ce={class:"flex flex-col mx-4 gap-2 flex-1"},_e={class:"text-lg font-bold text-gray-800"},me={class:"text-yellow-600 text-sm"},ve={class:"flex items-center justify-between"},ye={class:"text-yellow-600 text-sm"},fe={class:"border border-gray-300 p-2 rounded-md flex items-center gap-3"},pe=["onClick"],xe={class:"text-sm font-medium"},ge=["onClick"],he=["onClick"],we={class:"text-lg font-semibold text-gray-800 mb-4"},be={key:0,class:"mb-4 p-3 bg-yellow-100 text-yellow-800 rounded-md"},ke={class:"flex flex-col gap-4"},Ce={class:"flex justify-between items-center"},qe={class:"text-gray-700"},je={class:"flex justify-between items-center"},Ee={class:"text-gray-700"},$e={class:"flex justify-between items-center"},Se={class:"text-gray-700"},Fe={class:"flex justify-between items-center"},Ve={class:"text-gray-700"},Me=["disabled"],Be={class:"lg:w-1/4 w-full p-6 bg-white rounded-2xl shadow-lg"},Ne={class:"flex flex-col gap-4"},ze={class:"flex justify-between items-center"},Ae={class:"text-gray-700"},De={class:"flex justify-between items-center"},Te={class:"text-gray-700"},Le={class:"flex justify-between items-center"},Pe={class:"text-gray-700"},Ue={class:"flex flex-col mt-6"},He=["disabled"],Ie={__name:"cart",setup(Je){U();const p=c(""),v=c([]),C=c(!0),i=H(),h=c([]),d=c(null),y=c(!1),x=c([]),g=c([]),_=c([]),u=V(()=>_.value.length===0?[]:v.value.filter(a=>_.value.includes(a.store_id))),q=V(()=>x.value.length===0?{delivery:0,time:0,coupon:0,order_tax:0,order_without_tax:0,total:0}:x.value.reduce((a,e)=>({delivery:a.delivery+(e.delivery||0),time:Math.max(a.time,e.time||0),coupon:a.coupon+(e.coupon||0),order_tax:a.order_tax+(e.order_tax||0),order_without_tax:a.order_without_tax+(e.order_without_tax||0),total:a.total+(e.total||0)}),{delivery:0,time:0,coupon:0,order_tax:0,order_without_tax:0,total:0})),B=async()=>{try{const a=await f.get("/api/home/address");a.data.is_success&&(h.value=a.data.data,h.value.length>0&&(d.value=h.value[0].id))}catch(a){i.add({severity:"error",summary:"خطأ",detail:"فشل تحميل العناوين",life:3e3}),console.error("Error fetching addresses:",a)}},N=async()=>{try{C.value=!0;const a=await f.get("/api/cart");a.data.is_success&&(v.value=a.data.data.items.map(e=>{const t=e.variant&&e.variant.price?parseFloat(e.variant.price).toFixed(2):parseFloat(e.product.base_price).toFixed(2)||"0.00",n=e.product.media&&e.product.media.length>0?e.product.media[0].url:e.product.key_default_image||"/images/placeholder-product.png";return{id:`${e.product_id}-${e.variant_id||"no-variant"}`,product_id:e.product_id,variant_id:e.variant_id,name:e.product.name_ar||e.product.name_en,img:n,price:t,quantity:e.quantity,store_id:e.product.store_id}}),g.value=a.data.data.stores,g.value.length>0&&(_.value=[g.value[0].store_id]),await m())}catch(a){i.add({severity:"error",summary:"خطأ",detail:"فشل تحميل بيانات سلة التسوق",life:3e3}),console.error("Error fetching cart:",a)}finally{C.value=!1}},m=async()=>{try{if(!d.value||u.value.length===0){x.value=[];return}const a={is_expressed:y.value,address_id:d.value,view:!0,items:u.value.map(t=>({product_id:t.product_id,variant_id:t.variant_id,quantity:t.quantity}))};p.value&&(a.coupon=p.value);const e=await f.post("/api/order/view",a);e.data.is_success&&(x.value=e.data.data)}catch(a){i.add({severity:"error",summary:"خطأ",detail:"فشل تحميل إجمالي الطلب",life:3e3}),console.error("Error fetching order totals:",a)}},z=a=>{const e=g.value.find(t=>t.store_id===a);return e?e.store_name_ar||e.store_name_en:"متجر غير معروف"},A=async()=>{try{await m(),i.add({severity:"success",summary:"نجاح",detail:"تم تطبيق كود الخصم",life:3e3})}catch(a){i.add({severity:"error",summary:"خطأ",detail:"فشل تطبيق كود الخصم",life:3e3}),console.error("Error applying coupon:",a)}},$=async(a,e,t,n,F)=>{const w=v.value.find(j=>j.id===e);if(w)try{a==="plus"?(await f.post("/api/cart/update",{product_id:t,variant_id:n,quantity:F+1}),w.quantity+=1):a==="minus"&&w.quantity>1&&(await f.post("/api/cart/update",{product_id:t,variant_id:n,quantity:F-1}),w.quantity-=1),await m()}catch(j){i.add({severity:"error",summary:"خطأ",detail:`فشل ${a==="plus"?"زيادة":"تقليل"} الكمية`,life:3e3}),console.error(`Error ${a==="plus"?"increasing":"decreasing"} quantity:`,j)}},D=async(a,e,t)=>{try{await f.delete("/api/cart/clear",{data:{product_id:e,variant_id:t}}),v.value=v.value.filter(n=>n.id!==a),await m(),i.add({severity:"success",summary:"نجاح",detail:"تم إزالة المنتج من السلة",life:3e3})}catch(n){i.add({severity:"error",summary:"خطأ",detail:"فشل إزالة المنتج من السلة",life:3e3}),console.error("Error clearing product:",n)}},S=async()=>{if(!d.value){i.add({severity:"error",summary:"خطأ",detail:"يرجى اختيار عنوان للتوصيل",life:3e3});return}if(u.value.length===0){i.add({severity:"error",summary:"خطأ",detail:"سلة التسوق فارغة",life:3e3});return}try{const a={is_expressed:y.value,address_id:d.value,items:u.value.map(t=>({product_id:t.product_id,variant_id:t.variant_id,quantity:t.quantity}))};if(p.value&&(a.coupon=p.value),(await f.post("/api/order",a)).data.is_success)v.value=v.value.filter(t=>!u.value.includes(t)),x.value=[],i.add({severity:"success",summary:"نجاح",detail:"تم إرسال الطلب بنجاح",life:3e3});else throw new Error("Order submission failed")}catch(a){i.add({severity:"error",summary:"خطأ",detail:"فشل إرسال الطلب",life:3e3}),console.error("Error submitting order:",a)}},T=a=>{_.value.includes(a)?_.value=_.value.filter(e=>e!==a):_.value.push(a),m()},L=()=>{y.value=!y.value,m()};return I([d,y],()=>{m()}),J(()=>{B(),N()}),(a,e)=>(l(),r("div",Y,[s("div",Z,[s("section",O,[C.value?(l(),r("div",ee,e[2]||(e[2]=[s("svg",{class:"animate-spin h-8 w-8 text-yellow-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):(l(),r("div",te,[s("div",se,[e[3]||(e[3]=s("h3",{class:"text-lg font-semibold text-gray-800 mb-2"},"اختر المتجر",-1)),s("div",ae,[(l(!0),r(b,null,k(g.value,t=>(l(),r("button",{key:t.store_id,onClick:n=>T(t.store_id),class:E(["px-4 py-2 rounded-md text-sm font-medium transition-colors",_.value.includes(t.store_id)?"bg-yellow-600 text-white":"bg-amber-50 text-yellow-600"])},o(t.store_name_ar||t.store_name_en),11,oe))),128))])]),s("div",le,[e[5]||(e[5]=s("h3",{class:"text-lg font-semibold text-gray-800 mb-2"},"اختر عنوان التوصيل",-1)),M(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),onChange:m,class:"w-full bg-amber-50 border border-amber-200 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-600 transition-all"},[e[4]||(e[4]=s("option",{value:null,disabled:""},"اختر عنوان",-1)),(l(!0),r(b,null,k(h.value,t=>(l(),r("option",{key:t.id,value:t.id},o(t.name)+" - "+o(t.street)+", "+o(t.city),9,re))),128))],544),[[K,d.value]])]),s("div",ie,[e[6]||(e[6]=s("label",{class:"text-gray-800 font-medium"},"توصيل سريع",-1)),s("button",{onClick:L,class:E(["relative inline-flex items-center h-6 rounded-full w-11 transition-colors duration-200",y.value?"bg-yellow-600":"bg-gray-300"]),style:{direction:"ltr"}},[s("span",{class:E(["inline-block w-4 h-4 transform bg-white rounded-full transition-transform duration-200",y.value?"translate-x-6":"translate-x-1"])},null,2)],2)]),u.value.length===0?(l(),r("div",ne," سلة التسوق فارغة ")):(l(),r("div",de,[(l(!0),r(b,null,k(u.value,t=>(l(),r("div",{key:`${t.product_id}-${t.variant_id||"no-variant"}`,class:"flex items-center mt-6 bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300"},[s("img",{src:t.img,alt:t.name,class:"w-16 h-16 md:w-20 md:h-20 lg:w-28 lg:h-28 object-cover rounded-md border border-gray-800"},null,8,ue),s("div",ce,[s("h3",_e,o(t.name),1),s("p",me,"السعر: "+o(t.price)+" د.أ",1),s("div",ve,[s("p",ye,"الكمية: "+o(t.quantity),1),s("div",fe,[s("button",{onClick:n=>$("minus",t.id,t.product_id,t.variant_id,t.quantity),class:"text-lg font-semibold text-gray-700 hover:text-yellow-600 transition-colors"},"-",8,pe),s("span",xe,o(t.quantity),1),s("button",{onClick:n=>$("plus",t.id,t.product_id,t.variant_id,t.quantity),class:"text-lg font-semibold text-gray-700 hover:text-yellow-600 transition-colors"},"+",8,ge)]),s("button",{onClick:n=>D(t.id,t.product_id,t.variant_id),class:"text-white bg-yellow-600 px-3 py-1 text-sm rounded-md hover:bg-yellow-700 transition-all"},o(a.$t("remove")),9,he)])])]))),128)),(l(!0),r(b,null,k(x.value,t=>(l(),r("div",{key:t.store_id,class:"bg-gray-100 p-6 mt-6 rounded-lg shadow-inner"},[s("h3",we," طلب من "+o(z(t.store_id)),1),t.delivery_message?(l(),r("div",be,o(t.delivery_message),1)):W("",!0),s("div",ke,[s("span",Ce,[e[7]||(e[7]=s("h4",{class:"text-yellow-600 font-semibold"},"مدة الشحن",-1)),s("p",qe,o(t.time||"غير متوفر")+" ساعات",1)]),s("span",je,[e[8]||(e[8]=s("h4",{class:"text-yellow-600 font-semibold"},"المجموع الفرعي",-1)),s("p",Ee,o(t.order_without_tax)+" د.أ",1)]),s("span",$e,[e[9]||(e[9]=s("h4",{class:"text-yellow-600 font-semibold"},"الضريبة",-1)),s("p",Se,o(t.order_tax)+" د.أ",1)]),s("span",Fe,[e[10]||(e[10]=s("h4",{class:"text-yellow-600 font-semibold"},"الإجمالي",-1)),s("p",Ve,o(t.total)+" د.أ",1)])]),s("button",{disabled:!d.value||u.value.length===0,onClick:S,class:"w-full mt-6 py-3 text-sm sm:text-base lg:text-lg bg-gray-800 rounded-md text-white font-semibold transition-transform duration-150 hover:shadow-lg active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed"}," إتمام الشراء ",8,Me)]))),128))]))]))]),s("section",Be,[e[14]||(e[14]=s("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"ملخص الطلب الكلي",-1)),s("div",Ne,[s("span",ze,[e[11]||(e[11]=s("h4",{class:"text-yellow-600 font-semibold"},"المجموع الفرعي",-1)),s("p",Ae,o(q.value.order_without_tax)+" د.أ",1)]),s("span",De,[e[12]||(e[12]=s("h4",{class:"text-yellow-600 font-semibold"},"الضريبة",-1)),s("p",Te,o(q.value.order_tax)+" د.أ",1)]),s("span",Le,[e[13]||(e[13]=s("h4",{class:"text-yellow-600 font-semibold"},"الإجمالي",-1)),s("p",Pe,o(q.value.total)+" د.أ",1)])]),s("div",Ue,[M(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),type:"text",placeholder:"كود الخصم",class:"bg-amber-50 placeholder-yellow-600 border border-amber-200 rounded-md w-full px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-600 transition-all"},null,512),[[Q,p.value]]),s("button",{onClick:A,class:"w-full mt-4 py-2 text-sm bg-amber-100 rounded-md text-yellow-600 font-semibold hover:bg-amber-200 transition-all active:scale-95"}," تطبيق "),s("button",{disabled:!d.value||u.value.length===0,onClick:S,class:"w-full mt-4 py-2 text-sm bg-gray-800 rounded-md text-white font-semibold hover:shadow-lg transition-all active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed"}," إتمام الشراء الكلي ",8,He)])])]),G(R(X))]))}},Qe=P(Ie,[["__scopeId","data-v-11d4599f"]]);export{Qe as default};
