import{_ as O,l as w,u as G,k as N,G as H,j as J,r as n,q as R,o as K,R as W,z as X,a as p,c as v,f as u,t as d,e as o,p as h,h as y,y as x,g as f,D as Z,i as b,a2 as E,T as ee,ag as te,U,Q as se}from"./index-e06eb3e9.js";import{h as ae}from"./moment-fbc5633a.js";import{l as j}from"./lodash-abfd86c5.js";const oe=["dir"],le={class:"text-3xl font-bold text-center mb-8 text-gray-800"},re={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ie={class:"space-y-2 hidden"},ue={class:"block text-sm font-medium text-gray-700"},de={key:0,class:"p-error"},ce={class:"space-y-2 hidden"},ne={class:"block text-sm font-medium text-gray-700"},pe={key:0,class:"p-error"},ve={key:0,class:"space-y-2"},ye={class:"block text-sm font-medium text-gray-700"},_e={key:0,class:"p-error"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},fe={class:"space-y-2"},ge={class:"block text-sm font-medium text-gray-700"},he={key:0},xe={key:1},be={key:0,class:"p-error"},Ve={class:"space-y-2"},we={class:"block text-sm font-medium text-gray-700"},ke={key:0,class:"p-error"},De={class:"pt-4 flex justify-center space-x-4"},$e={__name:"update",setup(Le){const F=w(()=>localStorage.getItem("appLang")||"en"),S=w(()=>F.value==="en"?"name_en":"name_ar"),C=w(()=>F.value==="ar"),k=G(),D=N(),_=H(),{t:s}=J(),m=n(!1),i=n({}),V=w(()=>!!D.params.id),t=n({type:"category",ids:[],products:[],discount_type:1,discount_value:null,expires_at:null}),I=n([]),g=n([]),M=n(""),T=n(""),P=n(!1),$=n(!1);class Y{constructor(e,r){this.errors=e,this.t=r}required(e,r){return!e||Array.isArray(e)&&e.length===0?(this.errors.value[r]=this.t("validation.requiredFields",{field:this.t(`discount.${r}`)}),!1):!0}numericRange(e,r,a,c){return e==null||isNaN(e)?(this.errors.value[r]=this.t("validation.requiredFields",{field:this.t(`discount.${r}`)}),!1):a!==null&&e<a?(this.errors.value[r]=this.t("validation.minValue",{field:this.t(`discount.${r}`),min:a}),!1):c!==null&&e>c?(this.errors.value[r]=this.t("validation.maxValue",{field:this.t(`discount.${r}`),max:c}),!1):!0}validDate(e,r){return!e||!(e instanceof Date)||isNaN(e.getTime())?(this.errors.value[r]=this.t("validation.invalidDate",{field:this.t(`discount.${r}`)}),!1):!0}isValid(){return Object.keys(this.errors.value).length===0}}const L=async()=>{var l;P.value=!0;try{const{data:e}=await b.get("/api/category",{params:{search:M.value||void 0}});I.value=((l=e.data)==null?void 0:l.data)||[]}catch(e){console.error("Error fetching categories:",e),_.add({severity:"error",summary:s("error"),detail:s("error.categoryLoad"),life:3e3})}finally{P.value=!1}};j.debounce(L,300);const q=async()=>{var l;if(t.value.type!=="product"||t.value.ids.length===0){g.value=[];return}$.value=!0;try{const{data:e}=await b.get("/api/product",{params:{search:T.value||void 0,category_ids:t.value.ids.join(",")}});g.value=((l=e.data)==null?void 0:l.data)||[]}catch(e){console.error("Error fetching products:",e),_.add({severity:"error",summary:s("error"),detail:s("error.productLoad"),life:3e3})}finally{$.value=!1}},B=j.debounce(q,300),Q=l=>{T.value=l.value,B()},z=async()=>{var l,e;m.value=!0;try{const{data:r}=await b.get(`/api/discount/${D.params.id}`),a=r.data;t.value={type:a.type,ids:a.type==="category"?a.ids:[],products:a.type==="product"?a.ids:[],discount_type:a.discount_type,discount_value:parseFloat(a.discount_value),expires_at:a.expires_at?new Date(a.expires_at):null},await L(),a.type==="product"&&a.ids.length>0&&(t.value.ids=a.products.map(c=>c.category_id),setTimeout(()=>{t.value.products=a.ids,q()},100))}catch(r){console.error("Error loading discount:",r),_.add({severity:"error",summary:s("error"),detail:((e=(l=r.response)==null?void 0:l.data)==null?void 0:e.message)||s("error.loadError"),life:3e3}),k.push({name:"discount"})}finally{m.value=!1}};R(()=>t.value.type,l=>{t.value.ids=[],t.value.products=[],g.value=[],i.value={}}),R(()=>t.value.ids,l=>{t.value.type==="product"&&(t.value.products=[],l.length>0?q():g.value=[])},{deep:!0});const A=async()=>{var r,a;i.value={};const l=new Y(i,s);if(l.required(t.value.type,"type"),t.value.type==="category"?l.required(t.value.ids,"select_category"):t.value.type==="product"&&(l.required(t.value.ids,"select_category"),l.required(t.value.products,"select_product")),l.required(t.value.discount_type,"discount_type"),l.numericRange(t.value.discount_value,"discount_value",0,t.value.discount_type===2?100:null),l.validDate(t.value.expires_at,"expiration_date"),!l.isValid()){const c=Object.values(i.value)[0];_.add({severity:"error",summary:s("error"),detail:c,life:3e3});return}m.value=!0;const e={type:t.value.type,ids:t.value.type==="product"?t.value.products:t.value.ids,discount_type:t.value.discount_type,discount_value:t.value.discount_value,expires_at:ae(t.value.expires_at).format("YYYY-MM-DD")};try{V.value?(await b.put(`/api/discount/${D.params.id}`,e),_.add({severity:"success",summary:s("success"),detail:s("discount.updated_successfully"),life:3e3})):(await b.post("/api/discount",e),_.add({severity:"success",summary:s("success"),detail:s("discount.created_successfully"),life:3e3})),k.push({name:"discount"})}catch(c){_.add({severity:"error",summary:s("error"),detail:((a=(r=c.response)==null?void 0:r.data)==null?void 0:a.message)||s("error.saveError"),life:3e3})}finally{m.value=!1}};return K(()=>{L(),V.value&&z()}),(l,e)=>{const r=W("can");return X((p(),v("div",{class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg",dir:C.value?"rtl":"ltr"},[u("h1",le,d(V.value?o(s)("discount.edit_discount"):o(s)("discount.create_new_discount")),1),u("form",{onSubmit:Z(A,["prevent"]),class:"space-y-6"},[u("div",re,[u("div",ie,[u("label",ue,[h(d(o(s)("discount.discount_type"))+" ",1),e[6]||(e[6]=u("span",{class:"text-red-500"},"*",-1))]),y(o(E),{modelValue:t.value.type,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.type=a),options:[{label:o(s)("discount.category"),value:"category"},{label:o(s)("discount.product"),value:"product"}],optionLabel:"label",optionValue:"value",placeholder:o(s)("discount.select_type"),class:x(["w-full",{"p-invalid":i.value.type}])},null,8,["modelValue","options","placeholder","class"]),i.value.type?(p(),v("small",de,d(i.value.type),1)):f("",!0)]),u("div",ce,[u("label",ne,[h(d(o(s)("discount.discount_method"))+" ",1),e[7]||(e[7]=u("span",{class:"text-red-500"},"*",-1))]),y(o(E),{modelValue:t.value.discount_type,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.discount_type=a),options:[{label:o(s)("discount.fixed_amount"),value:1},{label:o(s)("discount.percentage"),value:2}],optionLabel:"label",optionValue:"value",placeholder:o(s)("discount.select_method"),class:x(["w-full",{"p-invalid":i.value.discount_type}])},null,8,["modelValue","options","placeholder","class"]),i.value.discount_type?(p(),v("small",pe,d(i.value.discount_type),1)):f("",!0)])]),t.value.type==="product"?(p(),v("div",ve,[u("label",ye,[h(d(o(s)("discount.select_product"))+" ",1),e[8]||(e[8]=u("span",{class:"text-red-500"},"*",-1))]),y(o(E),{modelValue:t.value.products[0],"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.products[0]=a),options:g.value,optionLabel:S.value,optionValue:"id",filter:"",filterPlaceholder:o(s)("discount.searchProducts"),placeholder:o(s)("discount.select_products"),loading:$.value,class:x(["w-full",{"p-invalid":i.value.select_product}]),onFilter:Q},null,8,["modelValue","options","optionLabel","filterPlaceholder","placeholder","loading","class"]),i.value.select_product?(p(),v("small",_e,d(i.value.select_product),1)):f("",!0)])):f("",!0),u("div",me,[u("div",fe,[u("label",ge,[h(d(o(s)("discount.discount_value"))+" ",1),t.value.discount_type===1?(p(),v("span",he,"("+d(o(s)("discount.fixed_amount"))+")",1)):(p(),v("span",xe,"(%)")),e[9]||(e[9]=u("span",{class:"text-red-500"},"*",-1))]),y(o(ee),{modelValue:t.value.discount_value,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.discount_value=a),min:0,max:t.value.discount_type===2?100:null,mode:"decimal",placeholder:o(s)("discount.enter_discount_value"),class:x(["w-full",{"p-invalid":i.value.discount_value}])},null,8,["modelValue","max","placeholder","class"]),i.value.discount_value?(p(),v("small",be,d(i.value.discount_value),1)):f("",!0)]),u("div",Ve,[u("label",we,[h(d(o(s)("discount.expiration_date"))+" ",1),e[10]||(e[10]=u("span",{class:"text-red-500"},"*",-1))]),y(o(te),{modelValue:t.value.expires_at,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.expires_at=a),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:o(s)("discount.select_expiration_date"),class:x(["w-full",{"p-invalid":i.value.expiration_date}]),showIcon:""},null,8,["modelValue","minDate","placeholder","class"]),i.value.expiration_date?(p(),v("small",ke,d(i.value.expiration_date),1)):f("",!0)])]),u("div",De,[y(o(U),{type:"button",label:o(s)("discount.cancel"),icon:"pi pi-times",onClick:e[5]||(e[5]=a=>o(k).go(-1)),class:"px-6 py-3 bg-gray-200 hover:bg-gray-300 mx-2 text-gray-700 rounded-lg shadow-md",disabled:m.value},null,8,["label","disabled"]),y(o(U),{type:"submit",label:V.value?o(s)("discount.update_discount"):o(s)("discount.create_discount"),icon:"pi pi-check",loading:m.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md"},null,8,["label","loading"])])],32),y(o(se))],8,oe)),[[r,"create discounts"]])}}},Te=O($e,[["__scopeId","data-v-2ece6469"]]);export{Te as default};
