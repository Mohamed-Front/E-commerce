import{_ as te,d as $,m as oe,b as se,H as le,u as ae,r as y,w as k,e as de,n as v,o as i,f as n,g as s,t as l,h as p,i as P,K as re,F as ue,a as g,x as f,s as m,j as ie}from"./index-ef259121.js";import{h as ne}from"./moment-fbc5633a.js";const ce={class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg"},pe={class:"text-3xl font-bold text-center mb-8 text-gray-800"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},_e={class:"space-y-2"},ye={for:"model_type",class:"block text-sm font-medium text-gray-700"},ve={key:0,class:"text-red-500 text-xs"},ge={class:"space-y-2"},fe={for:"model_ids",class:"block text-sm font-medium text-gray-700"},be={key:0,class:"text-red-500 text-xs"},xe={key:0,class:"space-y-2"},he={for:"product_id",class:"block text-sm font-medium text-gray-700"},we={key:0,class:"text-red-500 text-xs"},Ve={class:"space-y-2"},$e={for:"discount_type",class:"block text-sm font-medium text-gray-700"},ke={key:0,class:"text-red-500 text-xs"},De={class:"space-y-2"},Ce={for:"discount_value",class:"block text-sm font-medium text-gray-700"},Fe={key:0,class:"text-gray-500 text-xs"},Ue={key:1,class:"text-red-500 text-xs"},Ee={class:"space-y-2"},Ie={for:"expires_at",class:"block text-sm font-medium text-gray-700"},qe={key:0,class:"text-red-500 text-xs"},Le={class:"pt-4 flex justify-center space-x-4"},Me={key:0},Ne={key:1,class:"pi pi-spinner pi-spin"},Be={__name:"update",setup(Se){const R=$(()=>localStorage.getItem("appLang")||"en"),D=$(()=>R.value==="en"?"name_en":"name_ar"),H=oe(),w=se(),b=le(),{t:c}=ae(),a=y(),d=y(!1),K=y([]),x=y([]),h=y([]),C=y(H.params.id),o=y({products:[],model_ids:[],model_type:"",discount_type:null,discount_value:"",expires_at:null}),O=$(()=>x.value.map(t=>({id:t.id,name:t[D.value]||t.name_en||t.name_ar||"Unnamed Category"}))),z=async()=>{try{const e=(await g.get(`/api/discount/${C.value}`)).data.data;o.value={model_ids:Array.isArray(e.model_ids)?e.model_ids:[],model_type:e.model_type||"",discount_type:e.discount_type||null,discount_value:parseFloat(e.discount_value)||"",expires_at:e.expires_at?new Date(e.expires_at):null,products:e.model_type==="product"?Array.isArray(e.model_ids)?e.model_ids:[]:[]},e.model_type==="product"&&e.model_ids.length>0?(await V(),await G(e.model_ids[0])):e.model_type==="category"&&(await V(),o.value.model_ids=e.model_ids.filter(u=>x.value.some(_=>_.id===u)))}catch(t){console.error("Error fetching discount:",t),b.add({severity:"error",summary:c("error"),detail:c("error_fetching_discount"),life:3e3}),w.push({name:"discount"})}},G=async t=>{try{const u=(await g.get(`/api/product/${t}`)).data.data;u.category_id&&(o.value.model_ids=[u.category_id],await F([u.category_id]))}catch(e){console.error("Error fetching product category:",e)}},V=async()=>{try{const t=await g.get("api/category");x.value=t.data.data.data||[]}catch(t){console.error("Error fetching categories:",t),b.add({severity:"error",summary:c("error"),detail:c("error_fetching_categories"),life:3e3})}},F=async t=>{try{const e=await g.post("api/category/products",{ids:t});h.value=e.data.data||[]}catch(e){console.error("Error fetching products:",e)}};k(()=>o.value.model_type,t=>{o.value.model_ids=[],o.value.products=[],h.value=[],(t==="category"||t==="product")&&V()}),k(()=>o.value.model_ids,t=>{o.value.model_type==="product"&&t.length>0?F(t):h.value=[]},{deep:!0}),k(x,()=>{o.value.model_type==="category"&&o.value.model_ids.length>0&&(o.value.model_ids=o.value.model_ids.filter(t=>x.value.some(e=>e.id===t)))},{deep:!0});const J=async()=>{try{const t=await g.get("api/model");K.value=t.data.data.data||[]}catch(t){console.error("Error fetching models:",t),b.add({severity:"error",summary:c("error"),detail:c("error_fetching_models"),life:3e3})}},Q=async()=>{var e,u;d.value=!0;const t={expires_at:o.value.expires_at?ne(o.value.expires_at).format("YYYY-MM-DD"):null,discount_value:o.value.discount_value,discount_type:o.value.discount_type,model_type:o.value.model_type,model_ids:o.value.model_type==="product"?o.value.products:o.value.model_ids,_method:"PUT"};try{await g.post(`/api/discount/${C.value}`,t),w.push({name:"discount"}),b.add({severity:"success",summary:c("success"),detail:c("discount.updated_successfully"),life:3e3})}catch(_){console.error("Error:",_),b.add({severity:"error",summary:c("error"),detail:((u=(e=_.response)==null?void 0:e.data)==null?void 0:u.message)||c("error_occurred"),life:3e3})}finally{d.value=!1}};return de(()=>{J(),z()}),(t,e)=>{const u=v("Dropdown"),_=v("MultiSelect"),W=v("InputNumber"),X=v("Calendar"),U=v("Button"),Z=v("Form"),ee=v("Toast");return i(),n(ue,null,[s("div",ce,[s("h1",pe,l(t.$t("discount.update_discount")),1),p(Z,{onSubmit:re(Q,["prevent"]),class:"space-y-6"},{default:P(()=>{var E,I,q,L,M,N,B,S,j,A,T,Y;return[s("div",me,[s("div",_e,[s("label",ye,[f(l(t.$t("discount.model_type"))+" ",1),e[7]||(e[7]=s("span",{class:"text-red-500"},"*",-1))]),p(u,{filter:"",id:"model_type",modelValue:o.value.model_type,"onUpdate:modelValue":e[0]||(e[0]=r=>o.value.model_type=r),options:["product","category"],placeholder:t.$t("discount.select_model_type"),class:"w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:"",disabled:d.value},null,8,["modelValue","placeholder","disabled"]),(I=(E=a.value)==null?void 0:E.errors)!=null&&I.model_type?(i(),n("small",ve,l(a.value.errors.model_type[0]),1)):m("",!0)]),s("div",ge,[s("label",fe,[f(l(t.$t(o.value.model_type==="product"?"discount.select_category":"discount.select_model"))+" ",1),e[8]||(e[8]=s("span",{class:"text-red-500"},"*",-1))]),p(_,{filter:"",id:"model_ids",modelValue:o.value.model_ids,"onUpdate:modelValue":e[1]||(e[1]=r=>o.value.model_ids=r),options:O.value,optionLabel:"name",optionValue:"id",placeholder:t.$t(o.value.model_type==="product"?"discount.select_category":"discount.select_model"),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:"",disabled:d.value||!o.value.model_type},null,8,["modelValue","options","placeholder","disabled"]),(L=(q=a.value)==null?void 0:q.errors)!=null&&L.model_ids?(i(),n("small",be,l(a.value.errors.model_ids[0]),1)):m("",!0)]),o.value.model_type==="product"?(i(),n("div",xe,[s("label",he,[f(l(t.$t("discount.select_product"))+" ",1),e[9]||(e[9]=s("span",{class:"text-red-500"},"*",-1))]),p(_,{filter:"",id:"product_id",modelValue:o.value.products,"onUpdate:modelValue":e[2]||(e[2]=r=>o.value.products=r),options:h.value,optionLabel:D.value,optionValue:"id",placeholder:t.$t("discount.select_product"),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:"",disabled:d.value||o.value.model_ids.length===0},null,8,["modelValue","options","optionLabel","placeholder","disabled"]),(N=(M=a.value)==null?void 0:M.errors)!=null&&N.products?(i(),n("small",we,l(a.value.errors.products[0]),1)):m("",!0)])):m("",!0),s("div",Ve,[s("label",$e,[f(l(t.$t("discount.discount_type"))+" ",1),e[10]||(e[10]=s("span",{class:"text-red-500"},"*",-1))]),p(u,{filter:"",id:"discount_type",modelValue:o.value.discount_type,"onUpdate:modelValue":e[3]||(e[3]=r=>o.value.discount_type=r),options:[{label:t.$t("discount.fixed_amount"),value:1},{label:t.$t("discount.percentage"),value:2}],optionLabel:"label",optionValue:"value",placeholder:t.$t("discount.select_discount_type"),class:"w-full border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:"",disabled:d.value},null,8,["modelValue","options","placeholder","disabled"]),(S=(B=a.value)==null?void 0:B.errors)!=null&&S.discount_type?(i(),n("small",ke,l(a.value.errors.discount_type[0]),1)):m("",!0)]),s("div",De,[s("label",Ce,[f(l(t.$t("discount.discount_value"))+" ",1),e[11]||(e[11]=s("span",{class:"text-red-500"},"*",-1))]),p(W,{id:"discount_value",modelValue:o.value.discount_value,"onUpdate:modelValue":e[4]||(e[4]=r=>o.value.discount_value=r),min:0,max:o.value.discount_type===2?100:null,placeholder:t.$t("discount.enter_discount_value"),class:"w-full px-4 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:"",disabled:d.value},null,8,["modelValue","max","placeholder","disabled"]),o.value.discount_type===2?(i(),n("small",Fe,l(t.$t("discount.percentage_note")),1)):m("",!0),(A=(j=a.value)==null?void 0:j.errors)!=null&&A.discount_value?(i(),n("small",Ue,l(a.value.errors.discount_value[0]),1)):m("",!0)]),s("div",Ee,[s("label",Ie,[f(l(t.$t("discount.expiration_date"))+" ",1),e[12]||(e[12]=s("span",{class:"text-red-500"},"*",-1))]),p(X,{id:"expires_at",modelValue:o.value.expires_at,"onUpdate:modelValue":e[5]||(e[5]=r=>o.value.expires_at=r),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:t.$t("discount.select_expiration_date"),class:"w-full border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:"",disabled:d.value,showIcon:!0,inputId:"expires_at_input"},null,8,["modelValue","minDate","placeholder","disabled"]),(Y=(T=a.value)==null?void 0:T.errors)!=null&&Y.expires_at?(i(),n("small",qe,l(a.value.errors.expires_at[0]),1)):m("",!0)])]),s("div",Le,[p(U,{type:"button",label:t.$t("discount.cancel"),icon:"pi pi-times",onClick:e[6]||(e[6]=r=>ie(w).go(-1)),class:"px-6 mx-2 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:d.value},null,8,["label","disabled"]),p(U,{type:"submit",label:t.$t("discount.update_discount"),icon:"pi pi-check",loading:d.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:d.value},{default:P(()=>[d.value?(i(),n("i",Ne)):(i(),n("span",Me,l(t.$t("discount.update_discount")),1))]),_:1},8,["label","loading","disabled"])])]}),_:1})]),p(ee)],64)}}},Te=te(Be,[["__scopeId","data-v-64591aed"]]);export{Te as default};
